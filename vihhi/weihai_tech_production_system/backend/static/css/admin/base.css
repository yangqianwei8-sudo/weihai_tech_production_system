/* Admin 后台管理系统 - 基础样式 */

@import url('./variables.css');

/* ========== 样式隔离 - 确保前端样式不影响 Admin ========== */
/* 在 admin 页面中，阻止前端样式的影响 */
html[data-in-admin="1"],
html[data-in-admin="1"] body,
body.change-list,
body.change-form,
body.delete-confirmation,
body.add-form {
    /* 重置可能被前端样式影响的属性 */
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif !important;
}

/* 确保 admin 页面不继承前端样式的全局设置 */
html[data-in-admin="1"] * {
    /* 确保前端样式不会意外覆盖 admin 样式 */
    box-sizing: border-box;
}

/* 阻止前端样式中的全局选择器影响 admin */
html[data-in-admin="1"] .workspace,
html[data-in-admin="1"] .workspace-content,
html[data-in-admin="1"] .customer-content,
html[data-in-admin="1"] .app-wrapper {
    /* 这些是前端专用的容器，在 admin 中不应该存在 */
    display: none !important;
}

/* ========== 样式隔离结束 ========== */

/* 全局重置 */
* {
    box-sizing: border-box;
}

html {
    margin: 0 !important;
    padding: 0 !important;
    margin-left: 0 !important;
    padding-left: 0 !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
    overflow-x: hidden !important;
}

html body,
body {
    margin: 0 !important;
    padding: 0 !important;
    margin-left: 0 !important;
    padding-left: 0 !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
    overflow-x: hidden !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
    background-color: var(--admin-bg);
    color: var(--admin-text);
    font-size: var(--admin-font-base);
    line-height: 1.5;
}

/* 容器重置 */
html body #container,
body #container,
#container {
    margin: 0 !important;
    padding: 0 !important;
    margin-left: 0 !important;
    padding-left: 0 !important;
}

/* 确保没有任何父元素影响 */
body > div,
#main,
#wrapper {
    margin-left: 0 !important;
    padding-left: 0 !important;
}

/* 隐藏Django Admin默认元素 */
#header #user-tools {
    display: none !important;
}

#header a[href*="view_on_site"],
#header a[href="/"],
#header .viewlink,
#user-tools a[href="/"],
.object-tools a[href*="view_on_site"],
.object-tools .viewlink {
    display: none !important;
}

/* 隐藏创建表单页面顶部的标题文字 */
.center-hero,
.center-hero.mb-4,
.center-hero h1.hero-title,
.center-hero h1,
.center-hero p,
.workspace-content > .d-flex.justify-content-between.align-items-center.mb-4:first-child,
.container-fluid .center-hero.mb-4,
.container .d-flex.justify-content-between.align-items-center.mb-3:first-child h2,
.container-fluid .center-hero:first-child {
    display: none !important;
}

/* 卡片上移 - 减少表单卡片的上边距 */
.form-card:first-of-type,
.info-card:first-of-type,
.workspace-content > .info-card:first-child,
.workspace-content > form:first-child,
.container-fluid .form-card:first-child,
form.form-card:first-child,
.workspace-content > .info-card.info-card-fade-in:first-child {
    margin-top: 0 !important;
}

/* 调整容器上下边距 */
.container-fluid.py-4:has(.center-hero),
.workspace-content:has(.d-flex.justify-content-between.align-items-center.mb-4:first-child) {
    padding-top: 8px !important;
    padding-bottom: 8px !important;
}

/* 如果标题区域被隐藏，减少其后的第一个元素的margin-top */
.center-hero + .form-card,
.center-hero + form,
.center-hero + .info-card,
.d-flex.justify-content-between.align-items-center.mb-4:first-child + form,
.d-flex.justify-content-between.align-items-center.mb-4:first-child + .info-card {
    margin-top: 0 !important;
}

/* ========== 强制隐藏业务导航（兜底保护） ========== */
/* 只要在 admin 页面，就强制隐藏业务系统的侧边栏/顶部栏 */
/* 这是兜底方案，即使 JS 注入也能隐藏 */
html[data-in-admin="1"] .vh-sb,
html[data-in-admin="1"] .workspace-nav,
html[data-in-admin="1"] .workspace-sidebar,
html[data-in-admin="1"] .sidebar-nav,
html[data-in-admin="1"] .module-sidebar,
html[data-in-admin="1"] .topbar,
html[data-in-admin="1"] .top-nav,
html[data-in-admin="1"] .full-top-nav,
html[data-in-admin="1"] [class*="sidebar"],
html[data-in-admin="1"] [class*="topbar"],
html[data-in-admin="1"] [class*="workspace-nav"],
html[data-in-admin="1"] [id*="sidebar"],
html[data-in-admin="1"] [id*="topbar"],
/* 隐藏 Bootstrap navbar（业务系统的顶部导航栏）- 最高优先级 */
html[data-in-admin="1"] .navbar,
html[data-in-admin="1"] .navbar-expand-lg,
html[data-in-admin="1"] .navbar-dark,
html[data-in-admin="1"] nav.navbar,
html[data-in-admin="1"] nav[class*="navbar"],
html[data-in-admin="1"] .container-fluid:has(.navbar),
html[data-in-admin="1"] body > nav.navbar,
html[data-in-admin="1"] body > .navbar,
/* 隐藏业务系统的容器和布局 */
html[data-in-admin="1"] .workspace,
html[data-in-admin="1"] .workspace-content,
html[data-in-admin="1"] .app-wrapper {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    height: 0 !important;
    width: 0 !important;
    overflow: hidden !important;
    position: absolute !important;
    left: -9999px !important;
    pointer-events: none !important;
}

/* 额外保护：直接针对 body 的直接子元素中的 navbar */
body[class*="admin"] > nav.navbar,
body[class*="admin"] > .navbar,
body.change-list > nav.navbar,
body.change-list > .navbar,
body.change-form > nav.navbar,
body.change-form > .navbar {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    height: 0 !important;
    width: 0 !important;
    overflow: hidden !important;
    position: absolute !important;
    left: -9999px !important;
    pointer-events: none !important;
}

/* 最强制规则：在 admin 页面隐藏所有业务系统的 navbar（排除 Django admin 的 #header） */
body:has(#header) nav.navbar:not(#header):not(#header *),
body:has(#header) > nav.navbar:not(#header),
body:has(#header) .navbar:not(#header):not(#header *) {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    height: 0 !important;
    width: 0 !important;
    overflow: hidden !important;
    position: absolute !important;
    left: -9999px !important;
    pointer-events: none !important;
}

/* 如果 body 有 admin 相关 class，也隐藏业务导航 */
body.change-list .vh-sb,
body.change-list .workspace-nav,
body.change-list .workspace-sidebar,
body.change-list .sidebar-nav,
body.change-list .module-sidebar,
body.change-list .topbar,
body.change-list .top-nav,
body.change-list .full-top-nav,
body.change-list .navbar,
body.change-list .workspace,
body.change-list .workspace-content {
    display: none !important;
    visibility: hidden !important;
}
/* ========== 强制隐藏业务导航结束 ========== */

/* 全局强制样式 - 确保所有卡片都是直角 */
.card,
.info-card,
.form-card,
#content .module,
#result_list,
#changelist-search,
#changelist-filter {
    border-radius: 0 !important;
}

/* 隐藏"跳到主要内容"链接，避免刷新时闪现 */
.skip-to-content-link {
    position: absolute !important;
    left: -9999px !important;
    width: 1px !important;
    height: 1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
}

/* 当链接获得焦点时显示（用于无障碍访问） */
.skip-to-content-link:focus {
    position: fixed !important;
    top: 10px !important;
    left: 10px !important;
    z-index: 9999 !important;
    width: auto !important;
    height: auto !important;
    padding: 8px 16px !important;
    background-color: var(--admin-primary, #007bff) !important;
    color: white !important;
    text-decoration: none !important;
    border-radius: 4px !important;
    clip: auto !important;
    overflow: visible !important;
}



/* ========== 恢复 Django 默认样式 ========== */
/* 确保 changelist 使用 Django 默认的 flex 布局 - 使用最高优先级选择器 */
#content #changelist.module,
#content #changelist.module.filtered,
#content #changelist,
#changelist.module,
#changelist.module.filtered,
#changelist {
    display: flex !important; /* Django 默认使用 flex 布局 */
    align-items: flex-start !important;
    justify-content: flex-start !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    overflow: visible !important; /* 确保不会被 components.css 的 overflow: hidden 覆盖 */
    gap: 0 !important;
}

/* 确保表单容器占据左侧空间 */
#content #changelist .changelist-form-container,
#changelist .changelist-form-container {
    flex: 1 1 auto !important;
    min-width: 0 !important;
    max-width: calc(100% - 270px) !important;
    order: 0 !important;
    margin-right: 0 !important;
}

/* 确保过滤器显示在右侧（Django 默认行为） */
#content #changelist-filter,
#changelist-filter {
    flex: 0 0 240px !important;
    min-width: 240px !important;
    max-width: 240px !important;
    order: 2 !important;
    margin-left: 30px !important;
    margin-right: 0 !important;
    position: relative !important;
    align-self: flex-start !important;
}
