{% extends "shared/list_page_base.html" %}
{% comment %}
å®¡æ‰¹æµç¨‹åˆ—è¡¨é¡µé¢æ¨¡æ¿ (Workflow List Template)

åŠŸèƒ½è¯´æ˜ï¼š
- å±•ç¤ºå®¡æ‰¹æµç¨‹æ¨¡æ¿çš„åˆ—è¡¨é¡µé¢
- æ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰
- æ”¯æŒæœç´¢æµç¨‹åç§°ã€ä»£ç ã€æè¿°
- æ”¯æŒæŸ¥çœ‹è¯¦æƒ…ã€ç¼–è¾‘æ“ä½œ

ä¸»è¦åŠŸèƒ½ï¼š
1. ç­›é€‰åŠŸèƒ½ï¼š
   - æœç´¢ï¼šæµç¨‹åç§°ã€ä»£ç ã€æè¿°
   - çŠ¶æ€ç­›é€‰ï¼šä¸‹æ‹‰é€‰æ‹©çŠ¶æ€ï¼ˆè‰ç¨¿ã€æ¿€æ´»ã€åœç”¨ï¼‰
2. è¡¨æ ¼å±•ç¤ºï¼šæµç¨‹åç§°ã€ä»£ç ã€çŠ¶æ€ã€èŠ‚ç‚¹æ•°ã€å®ä¾‹æ•°ã€åˆ›å»ºæ—¶é—´ã€æ“ä½œ
3. æ“ä½œåŠŸèƒ½ï¼šæŸ¥çœ‹è¯¦æƒ…ã€ç¼–è¾‘

JavaScriptåŠŸèƒ½ï¼š
- ç­›é€‰å­—æ®µè®¾ç½®åŠŸèƒ½ï¼ˆç»§æ‰¿è‡ªlist_page_base.htmlï¼‰
{% endcomment %}
{% load static %}

{% block list_page_title %}å®¡æ‰¹å¼•æ“ ----æµç¨‹æ¨¡æ¿{% endblock %}

{% block list_page_actions %}
<a href="{% url 'workflow_engine:workflow_create' %}" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> åˆ›å»ºæµç¨‹
</a>
{% endblock %}

{% block search_placeholder %}æœç´¢æµç¨‹åç§°ã€ä»£ç ã€æè¿°...{% endblock %}

{% block list_page_filter_fields %}
<!-- çŠ¶æ€ç­›é€‰ -->
<div class="filter-row" data-filter-key="status">
    <label class="filter-label">çŠ¶æ€:</label>
    <div class="filter-control">
        <select name="status" class="form-control form-control-sm" id="statusSelect">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            {% for value, label in status_choices %}
            <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>
</div>
{% endblock %}

{% block list_table_checkbox_header %}
<th style="width: 50px;">
    <input type="checkbox" id="selectAll" class="form-check-input" title="å…¨é€‰">
</th>
{% endblock list_table_checkbox_header %}

{% block list_page_table_headers %}
<th style="width: 20%;">æµç¨‹åç§°</th>
<th style="width: 12%;">æµç¨‹ä»£ç </th>
<th style="width: 8%;">çŠ¶æ€</th>
<th style="width: 8%;">èŠ‚ç‚¹æ•°</th>
<th style="width: 8%;">å®ä¾‹æ•°</th>
<th style="width: 12%;">åˆ›å»ºæ—¶é—´</th>
{% endblock %}

{% block list_page_table_actions_header %}
<th style="width: 10%;">
    æ“ä½œ
    <span id="columnSettingsBtn"
          data-bs-toggle="modal"
          data-bs-target="#columnSettingsModal"
          aria-label="è®¾ç½®è¡¨æ ¼å­—æ®µ"
          title="è®¾ç½®è¡¨æ ¼å­—æ®µ"
          style="cursor: pointer; color: #000000 !important; font-size: 16px; vertical-align: middle; margin-left: 8px; display: inline-block;">
        <i class="bi bi-gear" style="color: #000000 !important;"></i>
    </span>
</th>
{% endblock %}

{% block list_table_rows %}
{% for item in workflows %}
<tr>
{% block list_page_table_checkbox_cell %}
<td>
    <input type="checkbox" class="form-check-input row-checkbox" name="item_ids" value="{{ item.id }}" id="item_{{ item.id }}">
</td>
{% endblock list_page_table_checkbox_cell %}

{% block list_page_table_row_content %}
<td>
    <div>
        <strong>{{ item.name }}</strong>
        {% if item.description %}
        <div class="small text-muted mt-1">{{ item.description|truncatewords:15 }}</div>
        {% endif %}
    </div>
</td>
<td>
    <code class="small">{{ item.code }}</code>
</td>
<td>
    {% if item.status == 'active' %}
    <span class="badge bg-success">{{ item.get_status_display }}</span>
    {% elif item.status == 'draft' %}
    <span class="badge bg-warning">{{ item.get_status_display }}</span>
    {% elif item.status == 'inactive' %}
    <span class="badge bg-danger">{{ item.get_status_display }}</span>
    {% else %}
    <span class="badge bg-secondary">{{ item.get_status_display }}</span>
    {% endif %}
</td>
<td class="small">{{ item.nodes.count }}</td>
<td class="small">{{ item.instances.count }}</td>
<td class="small text-muted">{{ item.created_time|date:"Y-m-d H:i" }}</td>
{% endblock %}

{% block list_page_table_actions_cell %}
<td>
    <div class="list-page-table-actions">
        <a href="{% url 'workflow_engine:workflow_detail' item.id %}" 
           class="action-view" 
           title="æŸ¥çœ‹è¯¦æƒ…">
            <i class="bi bi-eye"></i>
        </a>
        <span class="action-separator">|</span>
        <a href="{% url 'workflow_engine:workflow_edit' item.id %}" 
           class="action-edit" 
           title="ç¼–è¾‘">
            <i class="bi bi-pencil"></i>
        </a>
    </div>
</td>
{% endblock %}
</tr>
{% empty %}
<tr>
    <td colspan="8" class="list-empty">
        <div class="list-empty-icon">ğŸ“‹</div>
        <div class="list-empty-text">æš‚æ— æµç¨‹æ¨¡æ¿</div>
        <div class="list-empty-hint">è¯·åˆ›å»ºç¬¬ä¸€ä¸ªæµç¨‹æ¨¡æ¿å¼€å§‹ä½¿ç”¨</div>
    </td>
</tr>
{% endfor %}
{% endblock list_table_rows %}

{% block empty_colspan %}8{% endblock %}

{% block empty_message %}æš‚æ— æµç¨‹æ¨¡æ¿{% endblock %}

{% block empty_create_url %}{% url 'workflow_engine:workflow_create' %}{% endblock %}

{% block list_page_custom_js %}
// é…ç½®ç­›é€‰å­—æ®µè®¾ç½®åŠŸèƒ½ï¼ˆç»§æ‰¿è‡ª list_page_base.htmlï¼‰
window.listPageFilterFieldsSettingsConfig = {
    enableFieldsSettings: true,
    storageKey: 'workflow_list_filter_fields',
    defaultEnabledFields: ['status'],
    maxEnabledFields: 10,
    requiredFields: [],
    containerId: 'filterFieldsContainer',
    modalId: 'filterFieldsSettingsModal',
    settingsBtnId: 'settingsFilterFieldsBtn'
};
{% endblock %}