{% extends "shared/detail_base.html" %}
{% load static %}

{% block detail_title %}用印记录详情{% endblock %}
{% block detail_subtitle %}{{ usage.usage_number }}{% endblock %}

{% block detail_header_actions %}
<a href="{% url 'admin_pages:seal_usage_list' %}" class="btn btn-secondary">
  <i class="bi bi-arrow-left"></i>
  返回列表
</a>
<a href="{% url 'admin_pages:seal_detail' seal.id %}" class="btn btn-outline-primary">
  <i class="bi bi-shield-lock"></i>
  查看印章详情
</a>
{% endblock %}

{# 基本信息卡片由基础模板自动提供，包含：所属部门、负责人、表单编号（用印单号） #}

{% block detail_detail_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-detail-info">
  <div class="detail-card detail-card-detail-info">
    <div class="detail-card-header">
      <h3 class="detail-card-title">
        <i class="fas fa-list-alt"></i>
        详细信息
      </h3>
    </div>
    <div class="detail-card-body">
      {% block detail_detail_info_rows %}
      {# 第一排：印章名称、用印类型、用印日期（使用标准栅格：col-md-4，一行3个字段） #}
      <div class="row mb-3">
        {% block detail_detail_info_row1 %}
        {# 印章名称 #}
        <div class="col-md-4 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">印章名称</label>
            <div class="detail-field-value">
              <a href="{% url 'admin_pages:seal_detail' seal.id %}" class="text-decoration-none">
                {{ seal.seal_name }}
              </a>
            </div>
          </div>
        </div>
        {# 用印类型 #}
        <div class="col-md-4 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印类型</label>
            <div class="detail-field-value">
              {{ usage.get_usage_type_display }}
            </div>
          </div>
        </div>
        {# 用印日期 #}
        <div class="col-md-4 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印日期</label>
            <div class="detail-field-value">
              {{ usage.usage_date|date:"Y-m-d" }}
            </div>
          </div>
        </div>
        {% endblock detail_detail_info_row1 %}
      </div>

      {# 第二排：用印时间、用印数量（使用标准栅格：col-md-6，一行2个字段） #}
      <div class="row mb-3">
        {% block detail_detail_info_row2 %}
        {# 用印时间 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印时间</label>
            <div class="detail-field-value">
              {{ usage.usage_time|date:"Y-m-d H:i:s" }}
            </div>
          </div>
        </div>
        {# 用印数量 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印数量</label>
            <div class="detail-field-value">
              {{ usage.usage_count }}
            </div>
          </div>
        </div>
        {% endblock detail_detail_info_row2 %}
      </div>

      {# 第三排：用印人、见证人（使用标准栅格：col-md-6，一行2个字段） #}
      <div class="row mb-3">
        {% block detail_detail_info_row3 %}
        {# 用印人 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印人</label>
            <div class="detail-field-value">
              {{ usage.used_by.get_full_name|default:usage.used_by.username }}
            </div>
          </div>
        </div>
        {# 见证人 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">见证人</label>
            <div class="detail-field-value">
              {% if usage.witness %}
                {{ usage.witness.get_full_name|default:usage.witness.username }}
              {% else %}
                未指定
              {% endif %}
            </div>
          </div>
        </div>
        {% endblock detail_detail_info_row3 %}
      </div>

      {# 多行文本字段：用印事由（使用标准栅格：col-md-12，一行1个字段） #}
      <div class="row mb-3">
        {% block detail_detail_info_reason %}
        <div class="col-md-12 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印事由</label>
            <div class="detail-field-value" style="white-space: pre-wrap; line-height: 1.6;">
              {{ usage.usage_reason }}
            </div>
          </div>
        </div>
        {% endblock detail_detail_info_reason %}
      </div>

      {# 第四排：文件名称、用印文件（使用标准栅格：col-md-6，一行2个字段） #}
      {% if usage.document_name or usage.document_file %}
      <div class="row mb-3">
        {% block detail_detail_info_row4 %}
        {% if usage.document_name %}
        {# 文件名称 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">文件名称</label>
            <div class="detail-field-value">
              {{ usage.document_name }}
            </div>
          </div>
        </div>
        {% endif %}
        {% if usage.document_file %}
        {# 用印文件 #}
        <div class="col-md-6 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">用印文件</label>
            <div class="detail-field-value">
              <a href="{{ usage.document_file.url }}" target="_blank" class="text-decoration-none">
                <i class="bi bi-file-earmark"></i> 查看文件
              </a>
            </div>
          </div>
        </div>
        {% endif %}
        {% endblock detail_detail_info_row4 %}
      </div>
      {% endif %}

      {# 多行文本字段：备注（使用标准栅格：col-md-12，一行1个字段） #}
      {% if usage.notes %}
      <div class="row mb-3">
        {% block detail_detail_info_notes %}
        <div class="col-md-12 detail-field-wrapper">
          <div class="detail-field">
            <label class="detail-field-label">备注信息</label>
            <div class="detail-field-value" style="white-space: pre-wrap; line-height: 1.6;">
              {{ usage.notes }}
            </div>
          </div>
        </div>
        {% endblock detail_detail_info_notes %}
      </div>
      {% endif %}
      {% endblock detail_detail_info_rows %}
    </div>
  </div>
</div>
{% endblock detail_detail_info_card %}

{# 状态信息卡片由基础模板自动提供 #}

{% block detail_related_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-related-info">
  <div class="detail-card detail-card-related-info">
    <div class="detail-card-header">
      <h3 class="detail-card-title">
        <i class="fas fa-link"></i>
        其他信息
      </h3>
    </div>
    <div class="detail-card-body">
      <table class="detail-table">
        <tbody>
          <tr>
            <th>创建时间</th>
            <td>{{ usage.created_time|date:"Y-m-d H:i:s" }}</td>
          </tr>
          {% if usage.borrowing %}
          <tr>
            <th>关联借用</th>
            <td>
              <a href="/admin/administrative_management/sealborrowing/{{ usage.borrowing.id }}/" class="text-decoration-none">
                {{ usage.borrowing.borrowing_number }}
              </a>
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock detail_related_info_card %}
