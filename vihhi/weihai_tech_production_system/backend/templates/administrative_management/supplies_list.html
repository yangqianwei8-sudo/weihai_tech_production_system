{% extends "shared/list_page_base.html" %}
{% comment %}
办公用品列表页面模板 (Office Supply List Template)

功能说明：
- 展示办公用品记录的列表页面
- 支持按分类、状态、低库存等多维度筛选
- 支持办公用品的查看、编辑操作
- 包含复选框功能，支持批量操作

主要功能：
1. 筛选功能：
   - 分类筛选：根据用品分类筛选
   - 状态筛选：全部、启用、停用
   - 低库存筛选：仅显示低库存用品
2. 表格展示：编码、名称、分类、单位、当前库存、最低库存、最高库存、单价、库存状态、状态、操作
3. 复选框功能：支持全选和批量操作（继承自list_page_base.html）
4. 操作功能：查看详情、编辑
{% endcomment %}
{% load static %}

{% block list_page_title %}办公用品管理{% endblock %}

{% block list_page_actions %}
{% if can_create %}
<a href="{% url 'admin_pages:supply_create' %}" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> 新增用品
</a>
{% endif %}
{% endblock %}

{% block search_placeholder %}搜索编码、名称、品牌、供应商...{% endblock %}

{% block reset_url %}{% url 'admin_pages:supplies_management' %}{% endblock %}

<!-- 表格复选框列 -->
{% block list_page_table_checkbox_header %}
<th style="width: 40px;">
    <input type="checkbox" id="selectAll" title="全选/取消全选">
</th>
{% endblock %}

{% block list_page_table_headers %}
<th style="width: 8%;">编码</th>
<th style="width: 12%;">名称</th>
<th style="width: 8%;">分类</th>
<th style="width: 5%;">单位</th>
<th style="width: 7%;">当前库存</th>
<th style="width: 7%;">最低库存</th>
<th style="width: 7%;">最高库存</th>
<th style="width: 7%;">单价</th>
<th style="width: 8%;">库存状态</th>
<th style="width: 6%;">状态</th>
{% endblock %}

{% block list_page_table_checkbox_cell %}
<td>
    <input type="checkbox" class="row-checkbox" value="{{ item.id }}" title="选择此项">
</td>
{% endblock %}

{% block list_page_table_row_content %}
<td><code>{{ item.code }}</code></td>
<td>{{ item.name }}</td>
<td>{{ item.supply_category.name|default:"-" }}</td>
<td>{{ item.unit }}</td>
<td>{{ item.current_stock }}</td>
<td>{{ item.min_stock }}</td>
<td>{{ item.max_stock }}</td>
<td>¥{{ item.purchase_price|floatformat:2 }}</td>
<td>
    {% if item.is_low_stock %}
        <span class="badge bg-danger">低库存</span>
    {% elif item.max_stock > 0 and item.current_stock >= item.max_stock %}
        <span class="badge bg-warning">库存充足</span>
    {% else %}
        <span class="badge bg-success">正常</span>
    {% endif %}
</td>
<td>
    {% if item.is_active %}
        <span class="badge bg-success">启用</span>
    {% else %}
        <span class="badge bg-secondary">停用</span>
    {% endif %}
</td>
<td>
    <div class="list-page-table-actions">
        <a href="{% url 'admin_pages:supply_detail' item.id %}" class="action-view" title="查看详情">
            <i class="bi bi-eye"></i>
        </a>
        {% if can_create %}
        <span class="action-separator">|</span>
        <a href="{% url 'admin_pages:supply_update' item.id %}" class="action-edit" title="编辑">
            <i class="bi bi-pencil"></i>
        </a>
        {% endif %}
    </div>
</td>
{% endblock %}

{% block empty_colspan %}12{% endblock %}

{% block empty_table_message %}暂无数据{% endblock %}

{% block empty_message %}暂无数据{% endblock %}

{% block empty_create_url %}{% url 'admin_pages:supply_create' %}{% endblock %}

{% block list_page_batch_delete_js %}
// 批量删除功能
document.addEventListener('DOMContentLoaded', function() {
    const batchDeleteBtn = document.getElementById('batchDeleteBtn');
    if (batchDeleteBtn) {
        batchDeleteBtn.addEventListener('click', function() {
            const checked = document.querySelectorAll('.row-checkbox:checked');
            if (checked.length === 0) {
                showError('请先选择要删除的数据');
                return;
            }
            
            if (!confirm(`确定要删除选中的 ${checked.length} 条办公用品吗？此操作不可撤销。`)) {
                return;
            }
            
            const ids = Array.from(checked).map(cb => cb.value);
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{% url "admin_pages:supplies_management" %}';
            
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfToken) {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken.value;
                form.appendChild(csrfInput);
            }
            
            ids.forEach(id => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'delete_ids';
                input.value = id;
                form.appendChild(input);
            });
            
            document.body.appendChild(form);
            form.submit();
        });
    }
});
{% endblock %}

{% block list_page_batch_export_js %}
// 批量导出功能
document.addEventListener('DOMContentLoaded', function() {
    const batchExportBtn = document.getElementById('batchExportBtn');
    if (batchExportBtn) {
        batchExportBtn.addEventListener('click', function() {
            const checked = document.querySelectorAll('.row-checkbox:checked');
            if (checked.length === 0) {
                showError('请先选择要导出的数据');
                return;
            }
            
            const ids = Array.from(checked).map(cb => cb.value);
            const format = this.dataset.exportFormat || 'excel';
            const url = '{% url "admin_pages:supplies_management" %}?export=1&format=' + format + '&ids=' + ids.join(',');
            window.location.href = url;
        });
    }
});
{% endblock %}