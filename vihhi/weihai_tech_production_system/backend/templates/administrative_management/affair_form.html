{% extends "shared/create_form_base.html" %}
{% load static %}

{% block form_title %}{% if is_create %}创建行政事务{% else %}编辑行政事务{% endif %}{% endblock form_title %}
{% block form_subtitle %}{% if is_create %}请填写行政事务信息{% else %}{% if affair %}{{ affair.affair_number }}{% endif %}{% endif %}{% endblock form_subtitle %}

{% block form_first_row_extra_fields %}
  {# 第一排额外字段：事务标题 #}
  <div class="col-md-12 form-field-wrapper">
    <label for="{{ form.title.id_for_label }}" class="form-label">
      {{ form.title.label }}
      {% if form.title.field.required %}<span class="text-danger">*</span>{% endif %}
    </label>
    {{ form.title }}
    {% if form.title.errors %}
    <div class="text-danger small">{{ form.title.errors }}</div>
    {% endif %}
    {% if form.title.help_text %}
    <div class="form-text">{{ form.title.help_text }}</div>
    {% endif %}
  </div>
{% endblock form_first_row_extra_fields %}

{% block form_fields %}
  {# 事务类型、优先级、负责人 #}
  <div class="row mb-3">
    <div class="col-md-4 form-field-wrapper">
      <label for="{{ form.affair_type.id_for_label }}" class="form-label">
        {{ form.affair_type.label }}
        {% if form.affair_type.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.affair_type }}
      {% if form.affair_type.errors %}
      <div class="text-danger small">{{ form.affair_type.errors }}</div>
      {% endif %}
      {% if form.affair_type.help_text %}
      <div class="form-text">{{ form.affair_type.help_text }}</div>
      {% endif %}
    </div>
    <div class="col-md-4 form-field-wrapper">
      <label for="{{ form.priority.id_for_label }}" class="form-label">
        {{ form.priority.label }}
        {% if form.priority.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.priority }}
      {% if form.priority.errors %}
      <div class="text-danger small">{{ form.priority.errors }}</div>
      {% endif %}
      {% if form.priority.help_text %}
      <div class="form-text">{{ form.priority.help_text }}</div>
      {% endif %}
    </div>
    <div class="col-md-4 form-field-wrapper">
      <label for="{{ form.responsible_user.id_for_label }}" class="form-label">
        {{ form.responsible_user.label }}
        {% if form.responsible_user.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.responsible_user }}
      {% if form.responsible_user.errors %}
      <div class="text-danger small">{{ form.responsible_user.errors }}</div>
      {% endif %}
      {% if form.responsible_user.help_text %}
      <div class="form-text">{{ form.responsible_user.help_text }}</div>
      {% endif %}
    </div>
  </div>

  {# 事务内容（多行文本，占整行） #}
  <div class="row mb-3">
    <div class="col-12 form-field-wrapper">
      <label for="{{ form.content.id_for_label }}" class="form-label">
        {{ form.content.label }}
        {% if form.content.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.content }}
      {% if form.content.errors %}
      <div class="text-danger small">{{ form.content.errors }}</div>
      {% endif %}
      {% if form.content.help_text %}
      <div class="form-text">{{ form.content.help_text }}</div>
      {% endif %}
    </div>
  </div>

  {# 参与人员（多选字段，占整行） #}
  <div class="row mb-3">
    <div class="col-12 form-field-wrapper">
      <label for="{{ form.participants.id_for_label }}" class="form-label">
        {{ form.participants.label }}
        {% if form.participants.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.participants }}
      {% if form.participants.errors %}
      <div class="text-danger small">{{ form.participants.errors }}</div>
      {% endif %}
      {% if form.participants.help_text %}
      <div class="form-text">{{ form.participants.help_text }}</div>
      {% endif %}
      <small class="text-muted">按住Ctrl键可多选</small>
    </div>
  </div>

  {# 时间安排 #}
  <div class="row mb-3">
    <div class="col-md-6 form-field-wrapper">
      <label for="{{ form.planned_start_time.id_for_label }}" class="form-label">
        {{ form.planned_start_time.label }}
        {% if form.planned_start_time.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.planned_start_time }}
      {% if form.planned_start_time.errors %}
      <div class="text-danger small">{{ form.planned_start_time.errors }}</div>
      {% endif %}
      {% if form.planned_start_time.help_text %}
      <div class="form-text">{{ form.planned_start_time.help_text }}</div>
      {% endif %}
    </div>
    <div class="col-md-6 form-field-wrapper">
      <label for="{{ form.planned_end_time.id_for_label }}" class="form-label">
        {{ form.planned_end_time.label }}
        {% if form.planned_end_time.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.planned_end_time }}
      {% if form.planned_end_time.errors %}
      <div class="text-danger small">{{ form.planned_end_time.errors }}</div>
      {% endif %}
      {% if form.planned_end_time.help_text %}
      <div class="form-text">{{ form.planned_end_time.help_text }}</div>
      {% endif %}
    </div>
  </div>

  {# 附件 #}
  <div class="row mb-3">
    <div class="col-12 form-field-wrapper">
      <label for="{{ form.attachment.id_for_label }}" class="form-label">
        {{ form.attachment.label }}
        {% if form.attachment.field.required %}<span class="text-danger">*</span>{% endif %}
      </label>
      {{ form.attachment }}
      {% if form.attachment.errors %}
      <div class="text-danger small">{{ form.attachment.errors }}</div>
      {% endif %}
      {% if form.attachment.help_text %}
      <div class="form-text">{{ form.attachment.help_text }}</div>
      {% endif %}
      {% if not is_create and affair.attachment %}
      <div class="mt-2">
        <small class="text-muted">当前附件：</small>
        <a href="{{ affair.attachment.url }}" target="_blank" class="ms-2">
          <i class="bi bi-file-earmark"></i> {{ affair.attachment.name|slice:"20:" }}
        </a>
      </div>
      {% endif %}
      <small class="text-muted">支持 PDF、Word、Excel、图片等格式</small>
    </div>
  </div>
{% endblock form_fields %}

{% block form_actions %}
  <button type="button" id="headerSubmitButton" class="btn btn-primary">
    <i class="bi bi-check-circle"></i> 保存
  </button>
  <a href="{% if list_url_name %}{% url list_url_name %}{% else %}{% url 'admin_pages:affair_list' %}{% endif %}" class="btn btn-secondary">
    <i class="bi bi-x-circle"></i> 取消
  </a>
{% endblock form_actions %}
