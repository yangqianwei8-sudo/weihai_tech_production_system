{% extends "shared/three_column_layout_base.html" %}
{% load static %}

{% block title %}三栏布局模板示例 - 维海科技信息化管理平台{% endblock %}

{% block main_content %}
{% block detail_basic_info_card %}
{{ block.super }}
{% endblock detail_basic_info_card %}

{# 详细信息卡片 - 继承基础模板的详细信息卡片，并添加示例内容 #}
{% block detail_detail_info_card %}
{{ block.super }}
{% endblock detail_detail_info_card %}

{% block detail_detail_info_rows %}
<div class="row mb-3">
    {% block detail_detail_info_row1 %}
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">项目名称</label>
            <div class="detail-field-value">示例项目名称</div>
        </div>
    </div>
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">项目类型</label>
            <div class="detail-field-value">研发项目</div>
        </div>
    </div>
    {% endblock detail_detail_info_row1 %}
</div>

<div class="row mb-3">
    {% block detail_detail_info_row2 %}
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">开始日期</label>
            <div class="detail-field-value">2026-01-25</div>
        </div>
    </div>
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">结束日期</label>
            <div class="detail-field-value">2026-12-31</div>
        </div>
    </div>
    {% endblock detail_detail_info_row2 %}
</div>

<div class="row mb-3">
    {% block detail_detail_info_row3 %}
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">预算金额</label>
            <div class="detail-field-value">¥100,000.00</div>
        </div>
    </div>
    <div class="col-md-6 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">优先级</label>
            <div class="detail-field-value">
                <span class="badge bg-warning">高</span>
            </div>
        </div>
    </div>
    {% endblock detail_detail_info_row3 %}
</div>

<div class="row mb-3">
    {% block detail_detail_info_content %}
    <div class="col-md-12 detail-field-wrapper">
        <div class="detail-field">
            <label class="detail-field-label">项目描述</label>
            <div class="detail-field-value">
                这是一个示例项目的详细描述信息。项目描述可以包含多行文本内容，用于详细说明项目的目标、范围和要求。
            </div>
        </div>
    </div>
    {% endblock detail_detail_info_content %}
</div>
{% endblock detail_detail_info_rows %}

<div class="three-column-main__section">
    <h3 class="three-column-main__section-title">
        <i class="fas fa-code"></i> 使用方法
    </h3>
    <div class="three-column-main__section-content">
        <p>继承基础模板并覆盖相应的块：</p>
        <pre class="bg-light p-3 rounded"><code>{% verbatim %}{% extends "shared/three_column_layout_base.html" %}

{% block header_title %}页面标题{% endblock %}
{% block header_subtitle_text %}页面副标题{% endblock %}

{% block sidebar_content %}
{% endblock %}

{% block main_content %}
{% endblock %}

{% block actions_content %}
{% endblock %}{% endverbatim %}</code></pre>
    </div>
</div>

<div class="three-column-main__section">
    <h3 class="three-column-main__section-title">
        <i class="fas fa-palette"></i> 样式特性
    </h3>
    <div class="three-column-main__section-content">
        <ul>
            <li>响应式设计，适配不同屏幕尺寸</li>
            <li>侧边栏状态保存到 localStorage</li>
            <li>平滑的折叠/展开动画</li>
            <li>使用项目统一的CSS变量系统</li>
            <li>支持暗色主题（通过CSS变量）</li>
        </ul>
    </div>
</div>

<div class="three-column-main__section">
    <h3 class="three-column-main__section-title">
        <i class="fas fa-list"></i> 可用的块（Blocks）
    </h3>
    <div class="three-column-main__section-content">
        <h5>顶部栏块：</h5>
        <ul>
            <li><code>header_title</code> - 页面标题</li>
            <li><code>header_subtitle_text</code> - 页面副标题</li>
            <li><code>header_left</code> - 左侧内容（可完全自定义）</li>
            <li><code>header_right</code> - 右侧操作按钮</li>
        </ul>
        
        <h5>左侧边栏块：</h5>
        <ul>
            <li><code>sidebar_title</code> - 边栏标题</li>
            <li><code>sidebar_content</code> - 边栏内容</li>
        </ul>
        
        <h5>中间详情区块：</h5>
        <ul>
            <li><code>main_content</code> - 主要内容</li>
        </ul>
        
        <h5>右侧操作区块：</h5>
        <ul>
            <li><code>actions_title</code> - 操作区标题</li>
            <li><code>actions_content</code> - 操作区内容</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block approval_title %}审批栏{% endblock %}

{% block approval_content %}
{% block approval_status %}
<div class="three-column-actions__group">
    <div class="three-column-actions__group-title">审批状态</div>
    <div class="three-column-actions__info-item">
        <div class="three-column-actions__info-label">当前状态</div>
        <div class="three-column-actions__info-value">
            <span class="badge bg-warning">审批中</span>
        </div>
    </div>
    <div class="three-column-actions__info-item">
        <div class="three-column-actions__info-label">当前节点</div>
        <div class="three-column-actions__info-value">部门经理审批</div>
    </div>
    <div class="three-column-actions__info-item">
        <div class="three-column-actions__info-label">申请人</div>
        <div class="three-column-actions__info-value">张三</div>
    </div>
    <div class="three-column-actions__info-item">
        <div class="three-column-actions__info-label">申请时间</div>
        <div class="three-column-actions__info-value">2026-01-25 10:00</div>
    </div>
</div>
{% endblock approval_status %}

{% block approval_form %}
<div class="three-column-actions__group">
    <div class="three-column-actions__group-title">审批操作</div>
    <form method="post" id="approvalForm" class="approval-form" onsubmit="handleApprovalSubmit(event); return false;">
        {% csrf_token %}
        <div class="mb-3">
            <label for="approval_comment" class="form-label small">审批意见</label>
            <textarea 
                id="approval_comment" 
                name="comment" 
                class="form-control form-control-sm" 
                rows="4" 
                placeholder="请输入审批意见..."
                style="resize: vertical; min-height: 80px;"></textarea>
        </div>
        <div class="d-grid gap-2">
            <button type="submit" name="action" value="approve" class="btn btn-success btn-sm">
                <i class="fas fa-check"></i> 通过
            </button>
            <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm">
                <i class="fas fa-times"></i> 驳回
            </button>
            <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#transferModal">
                <i class="fas fa-exchange-alt"></i> 转交
            </button>
        </div>
    </form>
</div>
{% endblock approval_form %}

{% block approval_history %}
<div class="three-column-actions__group">
    <div class="three-column-actions__group-title">审批历史</div>
    <div class="approval-history-list">
        <div class="approval-history-item">
            <div class="approval-history-item-header">
                <span class="approval-history-item-name">张三</span>
                <span class="approval-history-item-time">2026-01-25 10:00</span>
            </div>
            <div>
                <span class="approval-history-item-result pending">待审批</span>
            </div>
            <div class="approval-history-item-comment">提交申请</div>
        </div>
    </div>
</div>
{% endblock approval_history %}
{% endblock approval_content %}

{% block approval_transfer_modal %}
<div class="modal fade" id="transferModal" tabindex="-1" aria-labelledby="transferModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="transferModalLabel">
                    <i class="fas fa-exchange-alt"></i> 转交审批
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" id="transferForm" onsubmit="handleTransferSubmit(event); return false;">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="transferred_to" class="form-label">转交给</label>
                        <select id="transferred_to" name="transferred_to" class="form-select" required>
                            <option value="">请选择用户</option>
                            <option value="1">李四</option>
                            <option value="2">王五</option>
                            <option value="3">赵六</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="transfer_comment" class="form-label">转交说明</label>
                        <textarea id="transfer_comment" name="comment" class="form-control" rows="3" placeholder="请输入转交说明"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" name="action" value="transfer" class="btn btn-primary">确认转交</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock approval_transfer_modal %}

{% block extra_js %}
{{ block.super }}
<script>
function handleApprovalSubmit(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const action = formData.get('action');
    const comment = formData.get('comment');
    
    if (!comment || comment.trim() === '') {
        alert('请输入审批意见');
        return false;
    }
    
    if (action === 'approve') {
        if (confirm('确认通过此审批吗？')) {
            alert('审批通过操作（示例）');
        }
    } else if (action === 'reject') {
        if (confirm('确认驳回此审批吗？')) {
            alert('审批驳回操作（示例）');
        }
    }
    
    return false;
}

function handleTransferSubmit(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const transferredTo = formData.get('transferred_to');
    const comment = formData.get('comment');
    
    if (!transferredTo) {
        alert('请选择转交对象');
        return false;
    }
    
    if (confirm('确认转交此审批吗？')) {
        alert('审批转交操作（示例）');
        const modal = bootstrap.Modal.getInstance(document.getElementById('transferModal'));
        if (modal) {
            modal.hide();
        }
    }
    
    return false;
}
</script>
{% endblock %}
