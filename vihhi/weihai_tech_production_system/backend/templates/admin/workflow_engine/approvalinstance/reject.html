{% extends "admin/base.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:workflow_engine_approvalinstance_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<div style="margin: 20px 0; padding: 20px; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 8px;">
    <h2 style="color: #e65100;">⚠️ 确认驳回审批</h2>
    <p style="margin-top: 10px; color: #666;">驳回后，审批流程将立即结束，无法恢复。请确认您的操作。</p>
</div>

<div style="margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 8px;">
    <h2>审批实例信息</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 8px; font-weight: bold; width: 150px;">审批编号：</td>
            <td style="padding: 8px;">{{ instance.instance_number }}</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">流程名称：</td>
            <td style="padding: 8px;">{{ instance.workflow.name }}</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">申请人：</td>
            <td style="padding: 8px;">{{ instance.applicant.username }}</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">当前节点：</td>
            <td style="padding: 8px;">{{ instance.current_node.name|default:"-" }}</td>
        </tr>
        {% if instance.apply_comment %}
        <tr>
            <td style="padding: 8px; font-weight: bold;">申请说明：</td>
            <td style="padding: 8px;">{{ instance.apply_comment }}</td>
        </tr>
        {% endif %}
    </table>
</div>

<form method="post" style="margin-top: 20px;">
    {% csrf_token %}
    <div style="margin-bottom: 20px;">
        <label for="comment" style="display: block; margin-bottom: 8px; font-weight: bold; color: #c62828;">驳回意见：<span style="color: #f44336;">*</span></label>
        <textarea name="comment" id="comment" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="请填写驳回原因（必填）" required></textarea>
        <small style="color: #666; display: block; margin-top: 4px;">驳回时必须填写审批意见，说明驳回原因。</small>
    </div>
    
    <div style="margin-top: 20px;">
        <button type="submit" style="background: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;" onclick="return confirm('确定要驳回此审批吗？驳回后无法恢复。');">确认驳回</button>
        <a href="{% url 'admin:workflow_engine_approvalinstance_changelist' %}" style="margin-left: 10px; padding: 10px 20px; background: #9e9e9e; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">取消</a>
    </div>
</form>
{% endblock %}
