{% extends "project_center/base.html" %}
{% block title %}核图确认 - {{ project.name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="mb-0">核图确认</h3>
            <div class="text-muted small">项目：{{ project.project_number }} {{ project.name }}</div>
        </div>
        <a class="btn btn-outline-primary" href="{% url 'production_pages:project_detail' project.id %}">返回项目</a>
    </div>

    {% if can_verify %}
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white">
            <h5 class="mb-0">核图流程</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label">核图结果</label>
                    <select name="result" class="form-select">
                        <option value="approved">全部修改完成</option>
                        <option value="changes">仍需设计方修改</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">核图说明</label>
                    <textarea name="note" class="form-control" rows="4" placeholder="可记录关键问题、未闭合项、需设计方补充的信息。"></textarea>
                </div>
                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">提交核图结果</button>
                </div>
            </form>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info border-0 shadow-sm">当前账号仅可查看记录，如需核图请联系项目经理或技术负责人。</div>
    {% endif %}

    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0">最近的设计文件</h5>
        </div>
        <div class="card-body">
            {% if design_documents %}
            <ul class="list-group list-group-flush">
                {% for doc in design_documents %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-semibold">{{ doc.name }}</div>
                        <div class="text-muted small">{{ doc.description|default:"无说明" }}</div>
                        <div class="text-muted small">上传：{{ doc.uploaded_by.get_full_name|default:doc.uploaded_by.username }} · {{ doc.uploaded_time|date:"Y-m-d H:i" }}</div>
                    </div>
                    <a class="btn btn-sm btn-outline-primary" href="{{ doc.file.url }}" target="_blank">查看</a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-muted mb-0">尚未上传改图文件。</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

