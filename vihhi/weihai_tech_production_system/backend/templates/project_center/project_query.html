{% extends "project_center/base.html" %}
{% load static %}

{% block title %}项目信息查询 - 维海科技生产信息化管理系统{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">项目查询</li>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- 查询条件区域 -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">查询条件</h5>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">项目编号</label>
                    <input type="text" name="project_number" class="form-control" value="{{ request.GET.project_number }}" placeholder="支持模糊查询">
                </div>
                <div class="col-md-3">
                    <label class="form-label">项目名称</label>
                    <input type="text" name="project_name" class="form-control" value="{{ request.GET.project_name }}" placeholder="支持模糊查询">
                </div>
                <div class="col-md-3">
                    <label class="form-label">客户名称</label>
                    <input type="text" name="client_name" class="form-control" value="{{ request.GET.client_name }}" placeholder="支持模糊查询">
                </div>
                <div class="col-md-3">
                    <label class="form-label">服务类型</label>
                    <select name="service_type" class="form-select" multiple>
                        {% for service_type in service_types %}
                        <option value="{{ service_type.id }}" {% if selected_service_type_ids and service_type.id|stringformat:"s" in selected_service_type_ids %}selected{% endif %}>{{ service_type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">时间范围</label>
                    <div class="input-group">
                        <input type="date" name="date_from" class="form-control" value="{{ request.GET.date_from }}">
                        <span class="input-group-text">至</span>
                        <input type="date" name="date_to" class="form-control" value="{{ request.GET.date_to }}">
                    </div>
                </div>
                <div class="col-md-12">
                    <button type="submit" class="btn btn-primary">查询</button>
                    <a href="{% url 'project_pages:project_query' %}" class="btn btn-secondary">重置</a>
                </div>
            </form>
        </div>
    </div>

    <!-- 查询结果列表 -->
    <div class="card">
        <div class="card-header bg-light">
            <h5 class="mb-0">查询结果</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>项目编号</th>
                            <th>项目名称</th>
                            <th>客户名称</th>
                            <th>服务类型</th>
                            <th>项目状态</th>
                            <th>负责人</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr>
                            <td>{{ project.project_number }}</td>
                            <td>{{ project.name }}</td>
                            <td>{{ project.client_company_name|default:"-" }}</td>
                            <td>{{ project.service_type.name|default:"-" }}</td>
                            <td>
                                <span class="badge bg-{% if project.status == 'in_progress' %}success{% elif project.status == 'completed' %}info{% else %}secondary{% endif %}">
                                    {{ project.get_status_display }}
                                </span>
                            </td>
                            <td>
                                {% if project.project_manager %}
                                    {{ project.project_manager.get_full_name|default:project.project_manager.username|default:"未分配" }}
                                {% else %}
                                    未分配
                                {% endif %}
                            </td>
                            <td>{{ project.created_time|date:"Y-m-d H:i" }}</td>
                            <td>
                                <a href="{% url 'project_pages:project_detail' project.id %}" class="btn btn-sm btn-outline-primary">查看详情</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="text-center text-muted">暂无查询结果</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

