{% extends "project_center/base.html" %}
{% load static %}

{% block title %}项目归档 - {{ project.name }}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'project_pages:project_detail' project.id %}">{{ project.name }}</a></li>
<li class="breadcrumb-item active">项目归档</li>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">{{ project.name }} - 项目归档</h4>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                <!-- 归档信息区域 -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">归档信息</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">归档编号</label>
                                <input type="text" class="form-control" value="系统自动生成" readonly>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">归档时间</label>
                                <input type="text" class="form-control" value="系统自动记录" readonly>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">归档人</label>
                                <input type="text" class="form-control" value="{{ user.get_full_name|default:user.username }}" readonly>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">归档版本</label>
                                <input type="text" class="form-control" value="{% if archives %}{{ archives.0.archive_version|add:1 }}{% else %}1{% endif %}" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 归档内容区域 -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">归档内容</h5>
                    </div>
                    <div class="card-body">
                        <div class="tree-view">
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <i class="bi bi-folder"></i> 项目基础信息
                                    <ul class="list-group mt-2">
                                        <li class="list-group-item">项目编号：{{ project.project_number }}</li>
                                        <li class="list-group-item">项目名称：{{ project.name }}</li>
                                        <li class="list-group-item">项目状态：{{ project.get_status_display }}</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-folder"></i> 过程文件
                                    <ul class="list-group mt-2">
                                        <li class="list-group-item">意见书</li>
                                        <li class="list-group-item">报告</li>
                                        <li class="list-group-item">会议纪要</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-folder"></i> 成果文件
                                    <ul class="list-group mt-2">
                                        <li class="list-group-item">最终确认的成果文件</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-folder"></i> 结算数据
                                    <ul class="list-group mt-2">
                                        <li class="list-group-item">产值分配</li>
                                        <li class="list-group-item">费用结算数据</li>
                                    </ul>
                                </li>
                                <li class="list-group-item">
                                    <i class="bi bi-folder"></i> 客户反馈
                                    <ul class="list-group mt-2">
                                        <li class="list-group-item">满意度调查</li>
                                        <li class="list-group-item">客户评价</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 权限设置区域 -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">权限设置</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">查看权限</label>
                                <select name="view_permissions[]" class="form-select" multiple size="5">
                                    <option value="admin">管理员</option>
                                    <option value="project_manager">项目负责人</option>
                                    <option value="business_manager">商务经理</option>
                                    <option value="team_member">团队成员</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">下载权限</label>
                                <select name="download_permissions[]" class="form-select" multiple size="5">
                                    <option value="admin">管理员</option>
                                    <option value="project_manager">项目负责人</option>
                                    <option value="business_manager">商务经理</option>
                                    <option value="team_member">团队成员</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">修改权限</label>
                                <select name="modify_permissions[]" class="form-select" multiple size="5">
                                    <option value="admin">管理员</option>
                                    <option value="project_manager">项目负责人</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">备注</label>
                                <textarea name="notes" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                    <a href="{% url 'project_pages:project_detail' project.id %}" class="btn btn-secondary">取消</a>
                    <button type="submit" class="btn btn-primary">确认归档</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 历史归档记录 -->
    {% if archives %}
    <div class="card mt-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">历史归档记录</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>归档编号</th>
                            <th>归档版本</th>
                            <th>归档时间</th>
                            <th>归档人</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for archive in archives %}
                        <tr>
                            <td>{{ archive.archive_number }}</td>
                            <td>v{{ archive.archive_version }}</td>
                            <td>{{ archive.archive_time|date:"Y-m-d H:i" }}</td>
                            <td>{{ archive.archived_by.get_full_name|default:archive.archived_by.username }}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary">查看</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

