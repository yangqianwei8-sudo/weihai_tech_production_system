{% extends "personnel_management/base.html" %}

{% block title %}{{ page_title }} - ç»´æµ·ç§‘æŠ€ä¿¡æ¯åŒ–ç®¡ç†å¹³å°{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'personnel_pages:employee_management' %}">å‘˜å·¥æ¡£æ¡ˆ</a></li>
<li class="breadcrumb-item active">{% if employee %}{{ employee.name }}{% else %}å‘˜å·¥è¯¦æƒ…{% endif %}</li>
{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/common.css' %}">
<style>
    /* center-hero é¡µé¢æ ‡é¢˜æ ·å¼ */
    .center-hero {
        background: linear-gradient(135deg, rgba(20,47,91,0.95), rgba(31,62,124,0.92));
        border-radius: var(--radius-lg);
        padding: var(--spacing-xl);
        color: #fff;
        box-shadow: 0 24px 60px rgba(20, 47, 91, 0.18);
        position: relative;
        overflow: hidden;
        margin-bottom: var(--spacing-xl);
    }
    
    .center-hero::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top right, rgba(255,255,255,0.25), transparent 60%);
        pointer-events: none;
    }
    
    .hero-icon {
        width: 56px;
        height: 56px;
        border-radius: var(--radius-md);
        background: rgba(255,255,255,0.18);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        margin-bottom: var(--spacing-sm);
    }
    
    .hero-title {
        font-size: var(--font-size-2xl);
        font-weight: 700;
        margin-bottom: var(--spacing-sm);
        color: #fff;
    }
    
    .hero-subtitle {
        font-size: var(--font-size-base);
        color: rgba(255,255,255,0.9);
        margin: 0;
    }
    
    .hero-actions {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
        flex-wrap: wrap;
    }
    
    .info-row {
        display: flex;
        padding: var(--spacing-sm) 0;
        border-bottom: 2px solid var(--vh-primary);
    }
    
    .info-row:last-child {
        border-bottom: none;
    }
    
    .info-text-content {
        color: var(--vh-text);
        line-height: 1.6;
        margin: 0;
        white-space: pre-wrap;
    }
    
    /* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
    }
    
    .stat-card {
        background: var(--vh-card-bg);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--vh-border);
        transition: transform var(--transition-base), box-shadow var(--transition-base);
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }
    
    .stat-card-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-md);
    }
    
    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-md);
        background: linear-gradient(135deg, rgba(20,47,91,0.1), rgba(31,62,124,0.08));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    .stat-label {
        font-size: var(--font-size-sm);
        color: var(--vh-text-muted);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--vh-primary);
        line-height: 1.2;
        margin-bottom: var(--spacing-xs);
    }
    
    .stat-hint {
        font-size: var(--font-size-sm);
        color: var(--vh-text-muted);
        margin: 0;
    }
    
    /* å¤´åƒæ ·å¼ */
    .employee-avatar {
        width: 120px;
        height: 120px;
        border-radius: var(--radius-lg);
        object-fit: cover;
        border: 4px solid rgba(255,255,255,0.3);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .avatar-placeholder {
        width: 120px;
        height: 120px;
        border-radius: var(--radius-lg);
        background: rgba(255,255,255,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        border: 4px solid rgba(255,255,255,0.3);
    }
</style>
{% endblock %}

{% block personnel_content %}
{% if employee %}
<div class="container-fluid py-4">
    <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
    <div class="center-hero">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div class="d-flex align-items-start gap-3 flex-grow-1">
                <div>
                    {% if employee.avatar %}
                    <img src="{{ employee.avatar.url }}" alt="{{ employee.name }}" class="employee-avatar">
                    {% else %}
                    <div class="avatar-placeholder">ğŸ‘¤</div>
                    {% endif %}
                </div>
                <div class="flex-grow-1">
                    <div class="hero-icon" style="display: none;"></div>
                    <h1 class="hero-title">{{ employee.name }} - å‘˜å·¥è¯¦æƒ…</h1>
                    <p class="hero-subtitle">å‘˜å·¥ç¼–å·ï¼š{{ employee.employee_number }} | {% if employee.department %}{{ employee.department.name }}{% endif %} | {{ employee.position }}</p>
                </div>
            </div>
            <div class="hero-actions">
                <a href="{% url 'personnel_pages:employee_management' %}" class="btn btn-light btn-sm">
            <i class="bi bi-arrow-left"></i> è¿”å›åˆ—è¡¨
        </a>
        {% if employee %}
                <a href="{% url 'personnel_pages:employee_update' employee.id %}" class="btn btn-light btn-sm">
            <i class="bi bi-pencil"></i> ç¼–è¾‘
        </a>
        {% endif %}
            </div>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    {% if summary_cards %}
    <div class="stats-grid">
        {% for card in summary_cards %}
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="flex-grow-1">
                    <div class="stat-label">{{ card.label }}</div>
                    <div class="stat-value">{{ card.value }}</div>
                    {% if card.hint %}
                    <div class="stat-hint">{{ card.hint }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid">
            <div class="info-item">
                <span class="info-label">å‘˜å·¥ç¼–å·</span>
                <span class="info-value"><code>{{ employee.employee_number }}</code></span>
            </div>
            <div class="info-item">
                <span class="info-label">å§“å</span>
                    <span class="info-value info-value-bold">{{ employee.name }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ€§åˆ«</span>
                <span class="info-value">{{ employee.get_gender_display }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">èº«ä»½è¯å·</span>
                <span class="info-value">{{ employee.id_number }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">å‡ºç”Ÿæ—¥æœŸ</span>
                    <span class="info-value">{% if employee.birthday %}{{ employee.birthday|date:"Y-m-d" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ‰‹æœºå·</span>
                <span class="info-value">{{ employee.phone }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">é‚®ç®±</span>
                    <span class="info-value">{% if employee.email %}{{ employee.email }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç³»ç»Ÿè´¦å·</span>
                <span class="info-value">
                    {% if employee.user %}
                        <a href="/admin/system_management/user/{{ employee.user.id }}/change/" class="text-decoration-none">{{ employee.user.username }}</a>
                    {% else %}
                        <span class="info-value-empty">-</span>
                    {% endif %}
                </span>
            </div>
            </div>
        </div>
    </div>

    <!-- å·¥ä½œä¿¡æ¯ -->
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ’¼ å·¥ä½œä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid">
            <div class="info-item">
                <span class="info-label">éƒ¨é—¨</span>
                    <span class="info-value">{% if employee.department %}{{ employee.department.name }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">èŒä½</span>
                    <span class="info-value info-value-bold">{{ employee.position }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">èŒç§°</span>
                    <span class="info-value">{% if employee.job_title %}{{ employee.job_title }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">å…¥èŒæ—¥æœŸ</span>
                    <span class="info-value">{% if employee.entry_date %}{{ employee.entry_date|date:"Y-m-d" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">çŠ¶æ€</span>
                <span class="info-value">
                    <span class="status-badge {{ employee.status }}">{{ employee.get_status_display }}</span>
                </span>
            </div>
            {% if employee.resignation_date %}
            <div class="info-item">
                <span class="info-label">ç¦»èŒæ—¥æœŸ</span>
                <span class="info-value">{{ employee.resignation_date|date:"Y-m-d" }}</span>
            </div>
            {% endif %}
            </div>
        </div>
    </div>

    <!-- è”ç³»ä¿¡æ¯ -->
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ“ è”ç³»ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid">
                <div class="info-item" style="grid-column: 1 / -1;">
                <span class="info-label">ä½å€</span>
                    <span class="info-value">{% if employee.address %}{{ employee.address }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç´§æ€¥è”ç³»äºº</span>
                    <span class="info-value">{% if employee.emergency_contact %}{{ employee.emergency_contact }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç´§æ€¥è”ç³»ç”µè¯</span>
                    <span class="info-value">{% if employee.emergency_phone %}{{ employee.emergency_phone }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            </div>
        </div>
    </div>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    {% if employee.notes %}
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ“ å¤‡æ³¨ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <p class="info-text-content">{{ employee.notes }}</p>
        </div>
    </div>
    {% endif %}

    <!-- æœ€è¿‘é¡¹ç›®å‚ä¸ -->
    {% if recent_projects %}
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ’¼ æœ€è¿‘å‚ä¸çš„é¡¹ç›®</h5>
        </div>
        <div class="info-card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>é¡¹ç›®ç¼–å·</th>
                            <th>é¡¹ç›®åç§°</th>
                            <th>é¡¹ç›®çŠ¶æ€</th>
                            <th>å‚ä¸è§’è‰²</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in recent_projects %}
                        <tr>
                            <td><code>{{ project.project_number|default:"å¾…ç”Ÿæˆ" }}</code></td>
                            <td>
                                <a href="{% url 'production_pages:project_detail' project.id %}" class="text-decoration-none">
                                    {{ project.name }}
                                </a>
                            </td>
                            <td>
                                <span class="status-badge {{ project.status }}">
                                    {{ project.get_status_display }}
                                </span>
                            </td>
                            <td>
                                {% for team in recent_project_teams %}
                                    {% if team.project.id == project.id %}
                                        {{ team.get_role_display }}
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- æœ€è¿‘è€ƒå‹¤è®°å½• -->
    {% if recent_attendances %}
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ“… æœ€è¿‘è€ƒå‹¤è®°å½•</h5>
        </div>
        <div class="info-card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>ä¸Šç­æ—¶é—´</th>
                            <th>ä¸‹ç­æ—¶é—´</th>
                            <th>å·¥ä½œæ—¶é•¿</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for attendance in recent_attendances %}
                        <tr>
                            <td>{{ attendance.attendance_date|date:"Y-m-d" }}</td>
                            <td>{% if attendance.check_in_time %}{{ attendance.check_in_time|time:"H:i" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</td>
                            <td>{% if attendance.check_out_time %}{{ attendance.check_out_time|time:"H:i" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</td>
                            <td>{{ attendance.work_hours }} å°æ—¶</td>
                            <td>
                                {% if attendance.is_late %}
                                <span class="badge bg-warning">è¿Ÿåˆ°</span>
                                {% elif attendance.is_early_leave %}
                                <span class="badge bg-warning">æ—©é€€</span>
                                {% elif attendance.is_absent %}
                                <span class="badge bg-danger">ç¼ºå‹¤</span>
                                {% else %}
                                <span class="badge bg-success">æ­£å¸¸</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- æœ€è¿‘è¯·å‡è®°å½• -->
    {% if recent_leaves %}
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ–ï¸ æœ€è¿‘è¯·å‡è®°å½•</h5>
        </div>
        <div class="info-card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>è¯·å‡å•å·</th>
                            <th>è¯·å‡ç±»å‹</th>
                            <th>å¼€å§‹æ—¥æœŸ</th>
                            <th>ç»“æŸæ—¥æœŸ</th>
                            <th>å¤©æ•°</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for leave in recent_leaves %}
                        <tr>
                            <td><code>{{ leave.leave_number }}</code></td>
                            <td>{{ leave.get_leave_type_display }}</td>
                            <td>{{ leave.start_date|date:"Y-m-d" }}</td>
                            <td>{{ leave.end_date|date:"Y-m-d" }}</td>
                            <td>{{ leave.days }} å¤©</td>
                            <td>
                                <span class="status-badge {{ leave.status }}">
                                    {{ leave.get_status_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- æœ€è¿‘åŸ¹è®­è®°å½• -->
    {% if recent_trainings %}
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">ğŸ“š æœ€è¿‘åŸ¹è®­è®°å½•</h5>
        </div>
        <div class="info-card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>åŸ¹è®­æ ‡é¢˜</th>
                            <th>åŸ¹è®­æ—¥æœŸ</th>
                            <th>åŸ¹è®­æ—¶é•¿</th>
                            <th>æˆç»©</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for training_participant in recent_trainings %}
                        <tr>
                            <td>{{ training_participant.training.title }}</td>
                            <td>{% if training_participant.training.training_date %}{{ training_participant.training.training_date|date:"Y-m-d" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</td>
                            <td>{{ training_participant.training.duration }} å°æ—¶</td>
                            <td>{% if training_participant.score %}{{ training_participant.score }}{% else %}<span class="info-value-empty">-</span>{% endif %}</td>
                            <td>
                                <span class="status-badge {{ training_participant.training.status }}">
                                    {{ training_participant.training.get_status_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å…¶ä»–ä¿¡æ¯ -->
    <div class="info-card">
        <div class="info-card-header">
            <h5 class="info-card-title">â„¹ï¸ å…¶ä»–ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid">
            <div class="info-item">
                <span class="info-label">åˆ›å»ºäºº</span>
                    <span class="info-value">{% if employee.created_by %}{{ employee.created_by.get_full_name|default:employee.created_by.username }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">åˆ›å»ºæ—¶é—´</span>
                    <span class="info-value">{% if employee.created_time %}{{ employee.created_time|date:"Y-m-d H:i:s" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ›´æ–°æ—¶é—´</span>
                    <span class="info-value">{% if employee.updated_time %}{{ employee.updated_time|date:"Y-m-d H:i:s" }}{% else %}<span class="info-value-empty">-</span>{% endif %}</span>
            </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="container-fluid py-4">
    <div class="info-card info-card-danger">
        <div class="info-card-header">
            <h5 class="info-card-title">âŒ é”™è¯¯</h5>
        </div>
        <div class="info-card-body">
            <p class="mb-3">æ— æ³•åŠ è½½å‘˜å·¥ä¿¡æ¯ï¼Œè¯·è¿”å›åˆ—è¡¨é¡µé¢é‡è¯•ã€‚</p>
            <a href="{% url 'personnel_pages:employee_management' %}" class="btn btn-primary">
                <i class="bi bi-arrow-left"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

