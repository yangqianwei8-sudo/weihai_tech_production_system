{% extends "customer_management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - 维海科技信息化管理平台{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_list' %}">客户管理</a></li>
<li class="breadcrumb-item"><a href="{% url 'business_pages:visit_checkin' %}">拜访签到</a></li>
<li class="breadcrumb-item active" aria-current="page">签到详情</li>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-end gap-2 mb-3">
    <a href="{% url 'business_pages:visit_checkin' %}" class="btn btn-outline-secondary">返回列表</a>
</div>

<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">签到信息</h5>
    </div>
    <div class="info-card-body">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">客户</span>
                <span class="info-value">
                    <a href="{% url 'business_pages:customer_detail' checkin.client.id %}" class="text-decoration-none">
                        {{ checkin.client.name }}
                    </a>
                </span>
            </div>
            <div class="info-item">
                <span class="info-label">签到时间</span>
                <span class="info-value">{{ checkin.checkin_time|date:"Y-m-d H:i:s" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">签到地点</span>
                <span class="info-value">{{ checkin.checkin_location }}</span>
            </div>
            {% if checkin.visit_plan %}
            <div class="info-item">
                <span class="info-label">关联计划</span>
                <span class="info-value">
                    <a href="{% url 'business_pages:visit_plan_detail' checkin.visit_plan.id %}" class="text-decoration-none">
                        {{ checkin.visit_plan.plan_title }}
                    </a>
                </span>
            </div>
            {% endif %}
            {% if checkin.latitude and checkin.longitude %}
            <div class="info-item">
                <span class="info-label">位置坐标</span>
                <span class="info-value">{{ checkin.latitude }}, {{ checkin.longitude }}</span>
            </div>
            {% endif %}
            <div class="info-item">
                <span class="info-label">签到人</span>
                <span class="info-value">{{ checkin.created_by.get_full_name|default:checkin.created_by.username }}</span>
            </div>
        </div>
    </div>
</div>

{% if checkin.notes %}
<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">备注</h5>
    </div>
    <div class="info-card-body">
        <p class="info-value" style="white-space: pre-wrap;">{{ checkin.notes }}</p>
    </div>
</div>
{% endif %}

{% if checkin.latitude and checkin.longitude %}
<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">位置地图</h5>
    </div>
    <div class="info-card-body">
        <div id="map" style="height: 400px; border-radius: var(--radius-md); overflow: hidden;"></div>
    </div>
</div>

<script src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_BAIDU_MAP_AK"></script>
<script>
    // 百度地图显示（需要配置API Key）
    var map = new BMap.Map("map");
    var point = new BMap.Point({{ checkin.longitude }}, {{ checkin.latitude }});
    map.centerAndZoom(point, 15);
    var marker = new BMap.Marker(point);
    map.addOverlay(marker);
    map.enableScrollWheelZoom(true);
</script>
{% endif %}

<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">创建信息</h5>
    </div>
    <div class="info-card-body">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">创建时间</span>
                <span class="info-value">{{ checkin.created_time|date:"Y-m-d H:i:s" }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
