{% extends "customer_management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - 维海科技信息化管理平台{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/common.css' %}">
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_list' %}">客户管理</a></li>
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_list' %}">客户线索</a></li>
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_lead_detail' lead.id %}">{{ lead.contact_name }}</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ page_title }}</li>
{% endblock %}

{% block content %}
<div class="info-card info-card-compact">
    <div class="info-card-header">
        <h5 class="info-card-title">{{ page_title }}</h5>
    </div>
    <div class="info-card-body">
        <form method="post">
            {% csrf_token %}
            
            <div class="info-section">
                <h6 class="info-section-title">跟进信息</h6>
                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label info-label-required">跟进日期</label>
                        <input type="date" name="follow_date" class="form-control" value="{% if followup %}{{ followup.follow_date|date:'Y-m-d' }}{% else %}{% now 'Y-m-d' %}{% endif %}" required>
                    </div>
                    <div class="info-item">
                        <label class="info-label info-label-required">跟进时间</label>
                        <input type="time" name="follow_time" class="form-control" value="{% if followup %}{{ followup.follow_date|date:'H:i' }}{% else %}{% now 'H:i' %}{% endif %}" required>
                    </div>
                    <div class="info-item">
                        <label class="info-label info-label-required">跟进方式</label>
                        <select name="follow_type" class="form-select" required>
                            {% for value, label in follow_type_choices %}
                            <option value="{{ value }}" {% if followup and followup.follow_type == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="info-item">
                        <label class="info-label info-label-required">跟进内容</label>
                        <textarea name="content" class="form-control" rows="4" required>{% if followup %}{{ followup.content }}{% endif %}</textarea>
                    </div>
                    <div class="info-item">
                        <label class="info-label">客户反馈</label>
                        <textarea name="customer_feedback" class="form-control" rows="3">{% if followup %}{{ followup.customer_feedback }}{% endif %}</textarea>
                    </div>
                    <div class="info-item">
                        <label class="info-label">下一步计划</label>
                        <textarea name="next_plan" class="form-control" rows="3">{% if followup %}{{ followup.next_plan }}{% endif %}</textarea>
                    </div>
                    <div class="info-item">
                        <label class="info-label">预计下次跟进日期</label>
                        <input type="date" name="next_follow_date" class="form-control" value="{% if followup and followup.next_follow_date %}{{ followup.next_follow_date|date:'Y-m-d' }}{% endif %}">
                    </div>
                    <div class="info-item">
                        <label class="info-label">预计下次跟进时间</label>
                        <input type="time" name="next_follow_time" class="form-control" value="{% if followup and followup.next_follow_date %}{{ followup.next_follow_date|date:'H:i' }}{% endif %}">
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-end gap-2 mt-4">
                <a href="{% url 'business_pages:customer_lead_detail' lead.id %}" class="btn btn-outline-secondary">取消</a>
                <button type="submit" class="btn btn-primary">{% if followup %}更新{% else %}保存{% endif %}</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

