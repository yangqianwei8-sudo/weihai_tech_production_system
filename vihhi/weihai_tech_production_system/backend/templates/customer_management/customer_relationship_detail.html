{% extends "customer_management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - 维海科技信息化管理平台{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_list' %}">客户管理</a></li>
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_relationship' %}">客户关系</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ relationship.title }}</li>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-end gap-2 mb-3">
    {% if can_edit %}
    <a href="{% url 'business_pages:customer_relationship_edit' relationship.id %}" class="btn btn-primary">编辑</a>
    {% endif %}
    <a href="{% url 'business_pages:customer_relationship' %}" class="btn btn-outline-secondary">返回列表</a>
</div>

<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">基本信息</h5>
    </div>
    <div class="info-card-body">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">客户</span>
                <span class="info-value">
                    <a href="{% url 'business_pages:customer_detail' relationship.client.id %}" class="text-decoration-none">
                        {{ relationship.client.name }}
                    </a>
                </span>
            </div>
            <div class="info-item">
                <span class="info-label">关系类型</span>
                <span class="info-value">{{ relationship.get_relationship_type_display }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">关系标题</span>
                <span class="info-value">{{ relationship.title }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">关系日期</span>
                <span class="info-value">{{ relationship.relationship_date|date:"Y-m-d H:i" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">地点</span>
                <span class="info-value">{{ relationship.location|default:"—" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">参与人员</span>
                <span class="info-value">{{ relationship.participants|default:"—" }}</span>
            </div>
            {% if relationship.related_opportunity %}
            <div class="info-item">
                <span class="info-label">关联商机</span>
                <span class="info-value">
                    <a href="{% url 'business_pages:opportunity_detail' relationship.related_opportunity.id %}" class="text-decoration-none">
                        {{ relationship.related_opportunity.name }}
                    </a>
                </span>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">关系内容</h5>
    </div>
    <div class="info-card-body">
        <p class="info-value" style="white-space: pre-wrap;">{{ relationship.content }}</p>
    </div>
</div>

{% if relationship.next_action %}
<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">下一步行动</h5>
    </div>
    <div class="info-card-body">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">下一步行动</span>
                <span class="info-value" style="white-space: pre-wrap;">{{ relationship.next_action }}</span>
            </div>
            {% if relationship.next_action_date %}
            <div class="info-item">
                <span class="info-label">下次行动日期</span>
                <span class="info-value">{{ relationship.next_action_date|date:"Y-m-d" }}</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<div class="info-card">
    <div class="info-card-header">
        <h5 class="info-card-title">创建信息</h5>
    </div>
    <div class="info-card-body">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">创建人</span>
                <span class="info-value">{{ relationship.created_by.get_full_name|default:relationship.created_by.username }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">创建时间</span>
                <span class="info-value">{{ relationship.created_time|date:"Y-m-d H:i" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">更新时间</span>
                <span class="info-value">{{ relationship.updated_time|date:"Y-m-d H:i" }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
