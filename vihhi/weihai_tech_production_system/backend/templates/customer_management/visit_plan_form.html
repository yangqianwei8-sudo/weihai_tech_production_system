{% extends "customer_management/base.html" %}
{% load static %}

{% block title %}{{ page_title }} - 维海科技信息化管理平台{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/common.css' %}">
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'business_pages:customer_list' %}">客户管理</a></li>
<li class="breadcrumb-item"><a href="{% url 'business_pages:visit_plan' %}">拜访计划</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ page_title }}</li>
{% endblock %}

{% block content %}
<div class="info-card info-card-compact">
    <div class="info-card-header">
        <h5 class="info-card-title">{{ page_title }}</h5>
    </div>
    <div class="info-card-body">
        <form method="post">
            {% csrf_token %}
            
            <div class="info-section">
                <h6 class="info-section-title">基本信息</h6>
                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label info-label-required">客户</label>
                        <select name="client_id" class="form-select" required>
                            <option value="">请选择客户</option>
                            {% for client in clients %}
                            <option value="{{ client.id }}" {% if plan.client_id == client.id %}selected{% endif %}>{{ client.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="info-item">
                        <label class="info-label info-label-required">计划日期</label>
                        <input type="date" name="plan_date" class="form-control" value="{{ plan.plan_date|date:'Y-m-d'|default:'' }}" required>
                    </div>
                    <div class="info-item">
                        <label class="info-label">计划时间</label>
                        <input type="time" name="plan_time" class="form-control" value="{{ plan.plan_date|time:'H:i'|default:'' }}">
                    </div>
                    <div class="info-item">
                        <label class="info-label">状态</label>
                        <select name="status" class="form-select">
                            {% for value, label in status_choices %}
                            <option value="{{ value }}" {% if plan.status == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="info-item">
                        <label class="info-label info-label-required">计划标题</label>
                        <input type="text" name="plan_title" class="form-control" value="{{ plan.plan_title|default:'' }}" required>
                    </div>
                    <div class="info-item">
                        <label class="info-label">地点</label>
                        <input type="text" name="location" class="form-control" value="{{ plan.location|default:'' }}">
                    </div>
                    <div class="info-item">
                        <label class="info-label">参与人员</label>
                        <input type="text" name="participants" class="form-control" value="{{ plan.participants|default:'' }}" placeholder="用逗号分隔">
                    </div>
                    <div class="info-item">
                        <label class="info-label">关联商机</label>
                        <select name="related_opportunity_id" class="form-select">
                            <option value="">无</option>
                            {% for opp in opportunities %}
                            <option value="{{ opp.id }}" {% if plan.related_opportunity_id == opp.id %}selected{% endif %}>{{ opp.client.name }} - {{ opp.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="info-section">
                <h6 class="info-section-title">拜访目的</h6>
                <div class="info-item">
                    <label class="info-label info-label-required">拜访目的</label>
                    <textarea name="plan_purpose" class="form-control" rows="5" required>{{ plan.plan_purpose|default:'' }}</textarea>
                </div>
            </div>
            
            <div class="d-flex justify-content-end gap-2 mt-4">
                <a href="{% if plan %}{% url 'business_pages:visit_plan_detail' plan.id %}{% else %}{% url 'business_pages:visit_plan' %}{% endif %}" class="btn btn-outline-secondary">取消</a>
                <button type="submit" class="btn btn-primary">保存</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

