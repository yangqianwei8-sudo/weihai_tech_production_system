{% extends "shared/list_page_base.html" %}
{% load static %}

{% comment %}
è·Ÿè¿›è®°å½•åˆ—è¡¨é¡µé¢æ¨¡æ¿ (Opportunity Followup List Template)

åŠŸèƒ½è¯´æ˜ï¼š
- å±•ç¤ºå•†æœºè·Ÿè¿›è®°å½•çš„åˆ—è¡¨é¡µé¢
- æ”¯æŒæŒ‰å…³è”å•†æœºã€è·Ÿè¿›æ–¹å¼ç­‰ç­›é€‰
- æ”¯æŒæŸ¥çœ‹å…³è”å•†æœºçš„æ“ä½œ
{% endcomment %}

{# ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ #}
{% block pm_title %}{{ page_title|default:"è·Ÿè¿›è®°å½•" }}{% endblock pm_title %}
{% block pm_subtitle %}{{ description|default:"å•†æœºè·Ÿè¿›è®°å½•ç®¡ç†" }}{% endblock pm_subtitle %}

{# ç­›é€‰å™¨åŒºåŸŸ #}
{% block list_filters_content %}
  <div class="list-page-filter-item">
    <label class="list-page-filter-label">å…³è”å•†æœº</label>
    <select name="opportunity_id" class="form-select">
      <option value="">å…¨éƒ¨å•†æœº</option>
      {% for opp in opportunities %}
      <option value="{{ opp.id }}" {% if opportunity_id == opp.id|stringformat:"s" %}selected{% endif %}>
        {{ opp.name }} ({{ opp.opportunity_number|default:'æœªç¼–å·' }})
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="list-page-filter-item">
    <label class="list-page-filter-label">è·Ÿè¿›æ–¹å¼</label>
    <select name="follow_type" class="form-select">
      <option value="">å…¨éƒ¨</option>
      {% for value, label in follow_type_choices %}
      <option value="{{ value }}" {% if follow_type == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
{% endblock list_filters_content %}

{# è¡¨æ ¼å¤´éƒ¨ #}
{% block list_table_headers %}
  <th>è·Ÿè¿›æ—¥æœŸ</th>
  <th>å…³è”å•†æœº</th>
  <th>è·Ÿè¿›æ–¹å¼</th>
  <th>è·Ÿè¿›å†…å®¹</th>
  <th>è·Ÿè¿›äºº</th>
  <th>åˆ›å»ºæ—¶é—´</th>
  <th>æ“ä½œ</th>
{% endblock list_table_headers %}

{# è¡¨æ ¼è¡Œ #}
{% block list_table_rows %}
  {% if page_obj %}
    {% for followup in page_obj %}
    <tr>
      <td>{{ followup.follow_date|date:'Y-m-d' }}</td>
      <td>
        <a href="{% url 'opportunity_pages:opportunity_detail' followup.opportunity.id %}" class="text-dark text-decoration-none fw-medium">
          {{ followup.opportunity.name }}
        </a>
      </td>
      <td>
        <span class="badge bg-info">{{ followup.get_follow_type_display }}</span>
      </td>
      <td>{{ followup.content|truncatewords:20 }}</td>
      <td>{{ followup.created_by.get_full_name|default:followup.created_by.username }}</td>
      <td>{{ followup.created_time|date:'Y-m-d H:i' }}</td>
      <td>
        <div class="list-page-table-actions">
          <a href="{% url 'opportunity_pages:opportunity_detail' followup.opportunity.id %}" class="action-view" title="æŸ¥çœ‹å•†æœº">
            <i class="bi bi-eye"></i>
          </a>
        </div>
      </td>
      {# åˆ—è®¾ç½®å•å…ƒæ ¼ - ä¿æŒåˆ—å¯¹é½ #}
      {% if column_settings_btn|default:False %}<td></td>{% endif %}
    </tr>
    {% empty %}
    <tr>
      <td colspan="{% if column_settings_btn|default:False %}8{% else %}7{% endif %}" class="list-empty">
        <div class="list-empty-icon">ğŸ“</div>
        <div class="list-empty-text">æš‚æ— è·Ÿè¿›è®°å½•</div>
        {% block list_empty_hint %}
        <div class="list-empty-hint">è¯·åˆ›å»ºç¬¬ä¸€ä¸ªè·Ÿè¿›è®°å½•å¼€å§‹ä½¿ç”¨</div>
        {% endblock list_empty_hint %}
      </td>
    </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="{% if column_settings_btn|default:False %}8{% else %}7{% endif %}" class="list-empty">
        <div class="list-empty-icon">ğŸ“</div>
        <div class="list-empty-text">æš‚æ— æ•°æ®</div>
      </td>
    </tr>
  {% endif %}
{% endblock list_table_rows %}
