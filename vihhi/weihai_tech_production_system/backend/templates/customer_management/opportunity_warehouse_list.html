{% extends "shared/list_page_base.html" %}
{% load static %}

{% comment %}
å…¥åº“åˆ—è¡¨é¡µé¢æ¨¡æ¿ (Opportunity Warehouse List Template)

åŠŸèƒ½è¯´æ˜ï¼š
- å±•ç¤ºå…¥åº“ç”³è¯·è®°å½•çš„åˆ—è¡¨é¡µé¢
- æ”¯æŒæŒ‰å…³è”å•†æœºã€çŠ¶æ€ç­‰ç­›é€‰
- æ”¯æŒå…¥åº“ç”³è¯·çš„æŸ¥çœ‹æ“ä½œ
{% endcomment %}

{# ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ #}
{% block pm_title %}{{ page_title|default:"å…¥åº“åˆ—è¡¨" }}{% endblock pm_title %}
{% block pm_subtitle %}{{ description|default:"ç®¡ç†æ‰€æœ‰å…¥åº“ç”³è¯·è®°å½•" }}{% endblock pm_subtitle %}

{# ç­›é€‰å™¨åŒºåŸŸ #}
{% block list_filters_content %}
  <div class="list-page-filter-item">
    <label class="list-page-filter-label">å…³è”å•†æœº</label>
    <select name="opportunity_id" class="form-select" id="opportunitySelect">
      <option value="">å…¨éƒ¨å•†æœº</option>
      {% for opp in opportunities %}
      <option value="{{ opp.id }}" {% if opportunity_id == opp.id|stringformat:"s" %}selected{% endif %}>{{ opp.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="list-page-filter-item">
    <label class="list-page-filter-label">çŠ¶æ€</label>
    <select name="status" class="form-select" id="statusSelect">
      <option value="">å…¨éƒ¨çŠ¶æ€</option>
      <option value="pending" {% if status == 'pending' %}selected{% endif %}>å¾…å®¡æ‰¹</option>
      <option value="approved" {% if status == 'approved' %}selected{% endif %}>å·²å®¡æ‰¹</option>
      <option value="rejected" {% if status == 'rejected' %}selected{% endif %}>å·²æ‹’ç»</option>
    </select>
  </div>
{% endblock list_filters_content %}

{# è¡¨æ ¼å¤´éƒ¨ #}
{% block list_table_headers %}
  <th>#</th>
  <th>å…¥åº“ç”³è¯·ç¼–å·</th>
  <th>å…³è”å•†æœº</th>
  <th>å®¢æˆ·</th>
  <th>ç”³è¯·æ—¥æœŸ</th>
  <th>çŠ¶æ€</th>
  <th>ç”³è¯·äºº</th>
  <th>æ“ä½œ</th>
{% endblock list_table_headers %}

{# è¡¨æ ¼è¡Œ #}
{% block list_table_rows %}
  {% if page_obj %}
    {% for item in page_obj %}
    <tr>
      <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
      <td><code>{{ item.application_number|default:"-" }}</code></td>
      <td>
        {% if item.opportunity %}
        <a href="{% url 'opportunity_pages:opportunity_detail' item.opportunity.id %}" class="text-dark text-decoration-none">
          {{ item.opportunity.name }}
        </a>
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
      </td>
      <td>
        {% if item.opportunity and item.opportunity.client %}
        {{ item.opportunity.client.name }}
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
      </td>
      <td>{{ item.application_date|date:"Y-m-d"|default:"-" }}</td>
      <td>
        {% if item.status == 'pending' %}
        <span class="badge bg-warning text-dark">å¾…å®¡æ‰¹</span>
        {% elif item.status == 'approved' %}
        <span class="badge bg-success">å·²å®¡æ‰¹</span>
        {% elif item.status == 'rejected' %}
        <span class="badge bg-danger">å·²æ‹’ç»</span>
        {% else %}
        <span class="badge bg-secondary">{{ item.status|default:"-" }}</span>
        {% endif %}
      </td>
      <td>{{ item.created_by.get_full_name|default:item.created_by.username|default:"-" }}</td>
      <td>
        <div class="list-page-table-actions">
          <a href="#" class="action-view" title="æŸ¥çœ‹è¯¦æƒ…">
            <i class="bi bi-eye"></i>
          </a>
        </div>
      </td>
      {# åˆ—è®¾ç½®å•å…ƒæ ¼ - ä¿æŒåˆ—å¯¹é½ #}
      {% if column_settings_btn|default:False %}<td></td>{% endif %}
    </tr>
    {% empty %}
    <tr>
      <td colspan="{% if column_settings_btn|default:False %}9{% else %}8{% endif %}" class="list-empty">
        <div class="list-empty-icon">ğŸ“¥</div>
        <div class="list-empty-text">æš‚æ— å…¥åº“ç”³è¯·è®°å½•</div>
        {% block list_empty_hint %}
        <div class="list-empty-hint">è¯·åˆ›å»ºç¬¬ä¸€ä¸ªå…¥åº“ç”³è¯·å¼€å§‹ä½¿ç”¨</div>
        {% endblock list_empty_hint %}
      </td>
    </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="{% if column_settings_btn|default:False %}9{% else %}8{% endif %}" class="list-empty">
        <div class="list-empty-icon">ğŸ“¥</div>
        <div class="list-empty-text">æš‚æ— æ•°æ®</div>
      </td>
    </tr>
  {% endif %}
{% endblock list_table_rows %}
