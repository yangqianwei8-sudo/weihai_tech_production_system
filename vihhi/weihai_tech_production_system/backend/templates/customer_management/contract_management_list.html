{% extends "customer_management/_base.html" %}
{% load static %}

{% block cm_title %}{{ page_title }}{% endblock %}
{% block cm_subtitle %}<span class="pm-subtitle">查看和管理所有合同</span>{% endblock %}

{% block cm_actions %}
{% if can_create %}
<a href="{% url 'contract_pages:contract_create' %}" class="list-btn list-btn-primary">
  新增合同
</a>
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/list_layout.css' %}">
<style>
  /* 合同状态badge样式 */
  .list-badge-draft { background: #F5F5F5; color: #666666; border-color: #E0E0E0; }
  .list-badge-pending_review { background: #E8E8E8; color: #333333; border-color: #CCCCCC; }
  .list-badge-reviewing { background: #E8E8E8; color: #333333; border-color: #CCCCCC; }
  .list-badge-signed { background: #E8E8E8; color: #1A1A1A; border-color: #CCCCCC; }
  .list-badge-effective { background: #E8E8E8; color: #333333; border-color: #CCCCCC; }
  .list-badge-executing { background: #E8E8E8; color: #333333; border-color: #CCCCCC; }
  .list-badge-completed { background: #E8E8E8; color: #1A1A1A; border-color: #CCCCCC; }
  .list-badge-terminated { background: #F5F5F5; color: #999999; border-color: #E0E0E0; }
  .list-badge-cancelled { background: #F5F5F5; color: #666666; border-color: #E0E0E0; }
</style>
{% endblock %}

{% block cm_content %}
  {% include "customer_management/_partials/_contract_management_filters.html" %}
  {% include "customer_management/_partials/_contract_management_table.html" %}
{% endblock %}

{% block extra_js %}
<div class="modal fade" id="deleteContractModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">确认删除</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>确定要删除此合同吗？此操作不可恢复。</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <form id="deleteContractForm" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">确认删除</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const deleteButtons = document.querySelectorAll('.btn-delete-contract');
  deleteButtons.forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const contractId = this.dataset.contractId;
      const form = document.getElementById('deleteContractForm');
      form.action = '/contracts/' + contractId + '/delete/';
      const modal = new bootstrap.Modal(document.getElementById('deleteContractModal'));
      modal.show();
    });
  });
});
</script>
{% endblock %}
