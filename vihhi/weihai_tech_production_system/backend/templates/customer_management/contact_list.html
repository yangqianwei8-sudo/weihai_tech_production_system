{% extends "shared/list_page_base.html" %}
{% load static %}





{% block list_table_rows %}
{% for contact in page_obj %}
      <tr>
        <td>
          <input type="checkbox" name="contact_ids" value="{{ contact.id }}" class="form-check-input row-checkbox">
        </td>
        <td>
          <a href="{% url 'business_pages:customer_detail' contact.client.id %}">
            {{ contact.client.name }}
          </a>
        </td>
        <td>
          <a href="{% url 'business_pages:contact_detail' contact.id %}">
            {{ contact.name }}
          </a>
        </td>
        <td>
          {% if contact.role %}
          <span class="list-badge">{{ contact.get_role_display }}</span>
          {% else %}
          <span style="color: #999999;">未设置</span>
          {% endif %}
        </td>
        <td>
          <span class="list-badge">{{ contact.get_relationship_level_display }}</span>
        </td>
        <td>{{ contact.position|default:"未填写" }}</td>
        <td>{{ contact.phone|default:"未填写" }}</td>
        <td style="color: #666666;">{{ contact.email|default:"未填写" }}</td>
        <td style="color: #666666;">{{ contact.created_time|date:"Y-m-d" }}</td>
        <td>
          <div class="list-actions">
            <a href="{% url 'business_pages:contact_detail' contact.id %}" class="list-btn" title="查看">查看</a>
            {% if can_create %}
            <a href="{% url 'business_pages:contact_edit' contact.id %}" class="list-btn" title="编辑">编辑</a>
            {% endif %}
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="10" class="list-empty">
          <div class="list-empty-icon">▢</div>
          <div class="list-empty-text">暂无联系人数据</div>
          <div class="list-empty-hint">请创建第一个联系人开始使用</div>
        </td>
      </tr>
      {% endfor %}
{% endblock list_table_rows %}
{% block list_table_headers %}
<th><input type="checkbox" id="selectAll" class="form-check-input"></th>
<th>客户名称</th>
<th>联系人姓名</th>
<th>人员角色</th>
<th>关系等级</th>
<th>职务</th>
<th>电话</th>
<th>邮箱</th>
<th>创建时间</th>
<th>操作</th>
{% endblock list_table_headers %}
{% block list_page_title %}人员关系管理{% endblock list_page_title %}
{% block list_page_subtitle_content %}<span class="pm-subtitle">查看和管理所有联系人</span>{% endblock list_page_subtitle_content %}

{% block pm_actions %}
{% if can_create %}
<a href="{% url 'business_pages:contact_create' %}" class="list-btn list-btn-primary">
  新增联系人
</a>
{% endif %}
{% endblock pm_actions %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/layouts/list-layout.css' %}">
{% endblock extra_css %}



{% block extra_js %}
<script>
// 全选/取消全选
document.getElementById('selectAll')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.row-checkbox');
    checkboxes.forEach(cb => cb.checked = this.checked);
    updateSelectedCount();
});

// 行复选框变化
document.querySelectorAll('.row-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        updateSelectedCount();
        updateSelectAllState();
    });
});

// 更新选中数量
function updateSelectedCount() {
    const selected = document.querySelectorAll('.row-checkbox:checked').length;
    const countEl = document.getElementById('selectedCount');
    if (countEl) {
        countEl.textContent = selected;
    }

    // 启用/禁用批量操作按钮
    const batchButtons = document.querySelectorAll('#batchEditBtn, #batchExportBtn, .dropdown-toggle');
    batchButtons.forEach(btn => {
        btn.disabled = selected === 0;
    });
}

// 更新全选状态
function updateSelectAllState() {
    const checkboxes = document.querySelectorAll('.row-checkbox');
    const selectAll = document.getElementById('selectAll');
    if (checkboxes.length > 0 && selectAll) {
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        const someChecked = Array.from(checkboxes).some(cb => cb.checked);
        selectAll.checked = allChecked;
        selectAll.indeterminate = someChecked && !allChecked;
    }
}

// 初始化
updateSelectedCount();
</script>
{% endblock extra_js %}
