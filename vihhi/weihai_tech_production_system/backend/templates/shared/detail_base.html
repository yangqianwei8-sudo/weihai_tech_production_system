{% extends "shared/module_base.html" %}
{% load static %}
{# 
共享详情页面模板 - 固定模板供复用
继承 module_base.html，提供统一的详情页面结构

使用说明：
  {# 1. 在子模板中继承此模板：{% extends "shared/detail_base.html" %} #}
2. 覆盖相应的 block 来自定义内容
3. 通过 context 传递对象数据（object 或自定义变量名）
4. 使用 permission_codes 控制权限显示

主要可覆盖的 block：
- detail_title: 页面标题（默认：详情页面）
- detail_subtitle: 页面副标题（默认：查看详细信息）
- detail_header_actions: 页面头部操作按钮
- detail_edit_url: 编辑按钮的URL（默认：#）
- detail_delete_url: 删除按钮的URL（默认：#）
- detail_approval_url: 审批按钮的URL（默认：#）
- detail_basic_info_card: 基本信息卡片（包含完整的卡片结构）
  - detail_basic_info_row1: 第一排字段（5个字段，使用 form-row-5）
  - detail_basic_info_row2: 第二排字段（5个字段，使用 form-row-5）
  - detail_basic_info_row3: 第三排字段（5个字段，使用 form-row-5）
  - detail_basic_info_content: 计划内容（多行文本，使用 row）
  - detail_basic_info_objective: 计划目标（多行文本，使用 row）
  - detail_basic_info_collaboration: 协作计划（多行文本，使用 row）
  - detail_basic_info_participants: 协作人员（多行文本，使用 row）
- detail_status_info_card: 状态信息卡片
- detail_related_info_card: 关联信息卡片
- detail_audit_info_card: 审计信息卡片
- detail_statistics_card: 数据与统计信息卡片
- detail_attachments_card: 附件与文件信息卡片
- detail_system_info_card: 系统信息卡片

布局说明：
- form-row-5: 使用 CSS Grid 布局，自动排列为5列（响应式调整）
- row: 使用 Bootstrap row，配合 col-12 用于多行文本字段
- 所有卡片使用直角设计（border-radius: 0）
- 所有样式使用黑白灰主题

样式变量：
- --color-black: #000000
- --color-dark: #333333
- --color-gray-dark: #555555
- --color-gray: #777777
- --color-gray-light: #aaaaaa
- --color-light: #dddddd
- --color-lighter: #f0f0f0
- --color-lightest: #f8f8f8
- --color-white: #ffffff
#}
{# 
模板使用指南：

1. 基本继承：
  {#    {% extends "shared/detail_base.html" %} #}

2. 覆盖标题：
   - form-row-5: 5列网格布局，自动响应式
   - row + col-12: 多行文本字段
   - 所有字段必须在 detail_basic_info_card block 内

5. 样式说明：
   - 黑白灰主题，直角设计
   - 使用 CSS 变量定义颜色
   - form-row-5 强制使用 grid 布局（!important）
#}

{% block module_styles %}
  {{ block.super }}
  <style>
    /* ==================== 黑白灰主题样式 ==================== */
    
    /* 页面基础颜色 */
    :root {
      --color-black: #000000;
      --color-dark: #333333;
      --color-gray-dark: #555555;
      --color-gray: #777777;
      --color-gray-light: #aaaaaa;
      --color-light: #dddddd;
      --color-lighter: #f0f0f0;
      --color-lightest: #f8f8f8;
      --color-white: #ffffff;
    }
    
    /* 卡片包裹容器样式 */
    .detail-card-wrapper {
      margin-bottom: 20px;
    }
    
    /* 详情页面容器 */
    .detail-page-container {
      max-width: 100%;
      width: 100%;
    }
    
    /* 详情卡片基础样式 - 直角设计 */
    .detail-card {
      background: var(--color-white);
      border: 1px solid var(--color-light);
      border-radius: 0;
      overflow: hidden;
    }
    
    .detail-card-header {
      background: var(--color-lightest);
      padding: 16px 20px;
      border-bottom: 1px solid var(--color-light);
    }
    
    .detail-card-title {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--color-dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .detail-card-body {
      padding: 20px;
    }
    
    /* 字段布局 */
    .detail-field-wrapper {
      margin-bottom: 16px;
    }
    
    .detail-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .detail-field-label {
      font-size: 13px;
      color: var(--color-gray-dark);
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .detail-field-value {
      font-size: 14px;
      color: var(--color-black);
      line-height: 1.5;
      min-height: 20px;
    }
    
    /* 多行文本样式 */
    .detail-field-value.multiline {
      white-space: pre-wrap;
      line-height: 1.5;
      background: var(--color-lightest);
      padding: 12px;
      border: 1px solid var(--color-lighter);
      border-radius: 0;
    }
    
    /* 黑白灰徽章样式 */
    .badge-status {
      padding: 4px 8px;
      border-radius: 0;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid transparent;
    }
    
    .badge-draft { 
      background-color: var(--color-lighter);
      color: var(--color-gray-dark);
      border-color: var(--color-light);
    }
    .badge-pending { 
      background-color: var(--color-light);
      color: var(--color-dark);
      border-color: var(--color-gray-light);
    }
    .badge-approved { 
      background-color: var(--color-white);
      color: var(--color-dark);
      border: 1px solid var(--color-gray);
    }
    .badge-rejected { 
      background-color: var(--color-gray-light);
      color: var(--color-white);
      border-color: var(--color-gray);
    }
    .badge-active { 
      background-color: var(--color-lighter);
      color: var(--color-dark);
      border: 1px solid var(--color-dark);
    }
    .badge-inactive { 
      background-color: var(--color-lightest);
      color: var(--color-gray);
      border: 1px solid var(--color-light);
    }
    .badge-completed { 
      background-color: var(--color-white);
      color: var(--color-dark);
      border: 1px solid var(--color-black);
    }
    
    /* 操作按钮栏 */
    .detail-actions-bar {
      background: var(--color-white);
      padding: 16px;
      border: 1px solid var(--color-light);
      margin-bottom: 20px;
    }
    
    .detail-actions-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    /* 黑白灰按钮样式 */
    .btn-outline-black {
      color: var(--color-black);
      border-color: var(--color-black);
      background-color: transparent;
    }
    
    .btn-outline-black:hover {
      color: var(--color-white);
      background-color: var(--color-black);
      border-color: var(--color-black);
    }
    
    .btn-gray {
      color: var(--color-white);
      background-color: var(--color-gray);
      border-color: var(--color-gray);
    }
    
    .btn-gray:hover {
      color: var(--color-white);
      background-color: var(--color-gray-dark);
      border-color: var(--color-gray-dark);
    }
    
    .btn-light {
      color: var(--color-dark);
      background-color: var(--color-lighter);
      border-color: var(--color-light);
    }
    
    .btn-light:hover {
      color: var(--color-black);
      background-color: var(--color-light);
      border-color: var(--color-gray-light);
    }
    
    /* 附件卡片样式 */
    .attachment-card {
      border: 1px solid var(--color-light);
      border-radius: 0;
      transition: all 0.2s;
      height: 100%;
    }
    
    .attachment-card:hover {
      border-color: var(--color-gray);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .attachment-icon {
      font-size: 28px;
      text-align: center;
      margin-bottom: 10px;
      color: var(--color-gray);
    }
    
    .attachment-name {
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 6px;
      word-break: break-all;
      color: var(--color-dark);
    }
    
    .attachment-meta {
      text-align: center;
      margin-bottom: 10px;
      color: var(--color-gray);
      font-size: 12px;
    }
    
    .attachment-actions {
      display: flex;
      gap: 6px;
      justify-content: center;
    }
    
    /* 子标题样式 */
    .detail-subsection-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-dark);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--color-light);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* 表格样式 */
    .detail-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .detail-table th {
      background-color: var(--color-lightest);
      border: 1px solid var(--color-light);
      padding: 8px 12px;
      text-align: left;
      font-weight: 600;
      color: var(--color-dark);
      font-size: 13px;
    }
    
    .detail-table td {
      border: 1px solid var(--color-light);
      padding: 8px 12px;
      color: var(--color-gray-dark);
      font-size: 13px;
    }
    
    .detail-table tr:hover {
      background-color: var(--color-lightest);
    }
    
    /* 图标颜色 */
    .fa-info-circle { color: var(--color-gray-dark); }
    .fa-toggle-on { color: var(--color-gray-dark); }
    .fa-link { color: var(--color-gray-dark); }
    .fa-file-alt { color: var(--color-gray-dark); }
    .fa-chart-bar { color: var(--color-gray-dark); }
    .fa-paperclip { color: var(--color-gray-dark); }
    .fa-cog { color: var(--color-gray-dark); }
    .fa-history { color: var(--color-gray); }
    .fa-object-group { color: var(--color-gray); }
    .fa-exchange-alt { color: var(--color-gray); }
    .fa-clock { color: var(--color-gray); }
    .fa-database { color: var(--color-gray); }
    .fa-external-link-alt { color: var(--color-gray); }
    .fa-edit { color: var(--color-gray); }
    
    /* 进度条样式 */
    .detail-progress {
      height: 20px;
      border-radius: 0;
      background-color: var(--color-lightest);
      border: 1px solid var(--color-light);
      overflow: hidden;
    }
    
    .detail-progress-bar {
      background-color: var(--color-gray);
      border-radius: 0;
      line-height: 20px;
      font-size: 11px;
      color: var(--color-white);
    }
    
    /* 统计卡片 */
    .stat-card {
      border: 1px solid var(--color-light);
      border-radius: 0;
      padding: 15px;
      text-align: center;
      background: var(--color-white);
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-black);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--color-gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* 网格布局 */
    .form-row-5 {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
    }
    
    /* 响应式调整 */
    @media (max-width: 1200px) {
      .form-row-5 {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .detail-card-wrapper {
        margin-bottom: 16px;
      }
      
      .detail-card-body {
        padding: 16px;
      }
      
      .detail-card-header {
        padding: 12px 16px;
      }
      
      .detail-actions-container {
        gap: 8px;
      }
      
      .detail-actions-bar {
        padding: 12px;
      }
      
      .form-row-5 {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 576px) {
      .form-row-5 {
        grid-template-columns: 1fr;
      }
    }
    
    /* 分隔线 */
    .divider {
      height: 1px;
      background-color: var(--color-light);
      margin: 20px 0;
    }
    
    /* 空状态提示 */
    .detail-empty-state {
      text-align: center;
      padding: 30px 20px;
      color: var(--color-gray);
      font-style: italic;
      background-color: var(--color-lightest);
      border: 1px dashed var(--color-light);
    }
  </style>
{% endblock module_styles %}
{% block pm_title %}{% block detail_title %}详情页面{% endblock detail_title %}{% endblock pm_title %}
{% block pm_subtitle %}{% block detail_subtitle %}查看详细信息{% endblock detail_subtitle %}{% endblock pm_subtitle %}
{% block pm_actions %}{% block detail_header_actions %}{% endblock detail_header_actions %}{% endblock pm_actions %}
{% block pm_content %}
<div class="detail-page-container">
  
    {# ==================== 操作按钮区域（位于标题栏下方）==================== #}
  <div class="detail-actions-bar mb-3">
    <div class="detail-actions-container">
      {% block detail_actions %}
      {# 编辑按钮 #}
      {% block detail_edit_button %}
      {% if can_edit %}
      <a href="{% block detail_edit_url %}#{% endblock %}" class="btn btn-light">
        <i class="fas fa-edit"></i>
        编辑
      </a>
      {% endif %}
      {% endblock detail_edit_button %}
      {# 删除按钮 #}
      {% block detail_delete_button %}
      {% if can_delete %}
      <button type="button" class="btn btn-gray" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">
        <i class="fas fa-trash"></i>
        删除
      </button>
      {% endif %}
      {% endblock detail_delete_button %}
      {# 审批按钮 #}
      {% block detail_approval_button_header %}
      {% if can_approve %}
      <a href="{% block detail_approval_url %}#{% endblock %}" class="btn btn-outline-black">
        <i class="fas fa-check-circle"></i>
        审批
      </a>
      {% endif %}
      {% endblock detail_approval_button_header %}
      {# 其他动作按钮 #}
      {% block detail_other_actions_header %}{% endblock %}
      {% block detail_other_actions %}{% endblock %}
      {% endblock detail_actions %}
    </div>
  </div>


{# ==================== 卡片1：基本信息 ==================== #}
{% block detail_basic_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-basic-info">
  <div class="detail-card detail-card-basic-info">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-info-circle"></i>
      基本信息
    </h3>
  </div>
  <div class="detail-card-body">
    {# 第一排：计划编号、计划名称、计划层级、计划周期、计划状态（5个字段） #}
    <div class="form-row-5 mb-3">
      {% block detail_basic_info_row1 %}
      {# 计划编号 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划编号</label>
          <div class="detail-field-value">
            {% if object.plan_number %}{{ object.plan_number }}{% elif object.id %}{{ object.id }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 计划名称 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划名称</label>
          <div class="detail-field-value">
            {% if object.name %}{{ object.name }}{% elif object.title %}{{ object.title }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 计划层级 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划层级</label>
          <div class="detail-field-value">
            {% if object.level %}{{ object.get_level_display|default:object.level }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 计划周期 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划周期</label>
          <div class="detail-field-value">
            {% if object.plan_period %}{{ object.get_plan_period_display|default:object.plan_period }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 计划状态 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划状态</label>
          <div class="detail-field-value">
            {% if object.status %}
              <span class="badge badge-status badge-{{ object.status }}">
                {{ object.get_status_display|default:object.status }}
              </span>
            {% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {% endblock detail_basic_info_row1 %}
    </div>
    
    {# 第二排：关联战略目标、父计划、关联项目（3个字段 + 2个空占位符 = 5个位置） #}
    <div class="form-row-5 mb-3">
      {% block detail_basic_info_row2 %}
      {# 关联战略目标 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">关联战略目标</label>
          <div class="detail-field-value">
            {% if object.related_goal %}{{ object.related_goal.name }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 父计划 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">父计划</label>
          <div class="detail-field-value">
            {% if object.parent_plan %}{{ object.parent_plan.name }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 关联项目 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">关联项目</label>
          <div class="detail-field-value">
            {% if object.related_project %}{{ object.related_project }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 空占位符，凑满5个字段 #}
      <div class="col-5-fields detail-field-wrapper"></div>
      <div class="col-5-fields detail-field-wrapper"></div>
      {% endblock detail_basic_info_row2 %}
    </div>
    
    {# 第三排：开始时间、结束时间（2个字段 + 3个空占位符 = 5个位置） #}
    <div class="form-row-5 mb-3">
      {% block detail_basic_info_row3 %}
      {# 开始时间 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划开始时间</label>
          <div class="detail-field-value">
            {% if object.start_time %}{{ object.start_time|date:"Y-m-d H:i" }}{% elif object.start_date %}{{ object.start_date|date:"Y-m-d" }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 结束时间 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划结束时间</label>
          <div class="detail-field-value">
            {% if object.end_time %}{{ object.end_time|date:"Y-m-d H:i" }}{% elif object.end_date %}{{ object.end_date|date:"Y-m-d" }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 空占位符，凑满5个字段 #}
      <div class="col-5-fields detail-field-wrapper"></div>
      <div class="col-5-fields detail-field-wrapper"></div>
      <div class="col-5-fields detail-field-wrapper"></div>
      {% endblock detail_basic_info_row3 %}
    </div>
    
    {# 多行文本字段：计划内容（整行，使用 col-12） #}
    <div class="row mb-3">
      {% block detail_basic_info_content %}
      <div class="col-12 detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划内容</label>
          <div class="detail-field-value" style="white-space: pre-wrap; line-height: 1.6;">
            {% if object.content %}{{ object.content }}{% else %}暂无内容{% endif %}
          </div>
        </div>
      </div>
      {% endblock detail_basic_info_content %}
    </div>
    
    {# 多行文本字段：计划目标（整行，使用 col-12） #}
    <div class="row mb-3">
      {% block detail_basic_info_objective %}
      <div class="col-12 detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">计划目标</label>
          <div class="detail-field-value" style="white-space: pre-wrap; line-height: 1.6;">
            {% if object.plan_objective %}{{ object.plan_objective }}{% else %}暂无目标{% endif %}
          </div>
        </div>
      </div>
      {% endblock detail_basic_info_objective %}
    </div>
    
    {# 多行文本字段：协作计划（整行，使用 col-12） #}
    <div class="row mb-3">
      {% block detail_basic_info_collaboration %}
      <div class="col-12 detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">协作计划</label>
          <div class="detail-field-value" style="white-space: pre-wrap; line-height: 1.6;">
            {% if object.collaboration_plan %}{{ object.collaboration_plan }}{% else %}暂无协作计划{% endif %}
          </div>
        </div>
      </div>
      {% endblock detail_basic_info_collaboration %}
    </div>
    
    {# 多选字段：协作人员（整行，使用 col-12） #}
    <div class="row mb-3">
      {% block detail_basic_info_participants %}
      <div class="col-12 detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">协作人员</label>
          <div class="detail-field-value">
            {% if object.participants.all %}
              {% for participant in object.participants.all %}
                <span class="badge badge-secondary">{{ participant.get_full_name|default:participant.username }}</span>
              {% endfor %}
            {% else %}
              暂无协作人员
            {% endif %}
          </div>
        </div>
      </div>
      {% endblock detail_basic_info_participants %}
    </div>
  </div>
</div>
</div>
{% endblock detail_basic_info_card %}

{# ==================== 卡片2：状态信息 ==================== #}
{% block detail_status_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-status-info">
  <div class="detail-card detail-card-status-info">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-toggle-on"></i>
      状态信息
    </h3>
  </div>
  <div class="detail-card-body">
    {# 当前状态 #}
    {% block detail_current_status %}
    <div class="mb-3">
      <label class="detail-field-label">当前状态</label>
      <div class="detail-field-value">
        {% if object.status %}
          <span class="badge badge-status badge-{{ object.status }}">
            {{ object.get_status_display|default:object.status }}
          </span>
        {% else %}N/A{% endif %}
      </div>
    </div>
    {% endblock detail_current_status %}
    
    {# 状态变更历史 #}
    {% block detail_status_history %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-exchange-alt"></i>
        状态变更记录
      </h5>
      <div class="detail-history-list">
        {% block detail_status_history_content %}
        <div class="detail-empty-state">暂无状态变更记录</div>
        {% endblock detail_status_history_content %}
      </div>
    </div>
    {% endblock detail_status_history %}
    
    {# 状态时间戳 #}
    {% block detail_status_timestamps %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-clock"></i>
        状态时间戳
      </h5>
      <div class="row">
        {% block detail_status_timestamps_content %}
        {# 子模板可以在这里添加状态时间戳字段 #}
        {% endblock detail_status_timestamps_content %}
      </div>
    </div>
    {% endblock detail_status_timestamps %}
  </div>
</div>
</div>
{% endblock detail_status_info_card %}

{# ==================== 卡片3：关联信息 ==================== #}
{% block detail_related_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-related-info">
  <div class="detail-card detail-card-related-info">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-link"></i>
      关联信息
    </h3>
  </div>
  <div class="detail-card-body">
    {# 关联记录 #}
    {% block detail_related_records %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-database"></i>
        关联记录
      </h5>
      <div class="detail-related-list">
        {% block detail_related_records_content %}
        <div class="detail-empty-state">暂无关联记录</div>
        {% endblock detail_related_records_content %}
      </div>
    </div>
    {% endblock detail_related_records %}
    
    {# 关联链接按钮 #}
    {% block detail_related_links %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-external-link-alt"></i>
        相关链接
      </h5>
      <div class="detail-related-links">
        {% block detail_related_links_content %}
        <div class="detail-empty-state">暂无相关链接</div>
        {% endblock detail_related_links_content %}
      </div>
    </div>
    {% endblock detail_related_links %}
  </div>
</div>
</div>
{% endblock detail_related_info_card %}

{# ==================== 卡片4：审计信息 ==================== #}
{% block detail_audit_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-audit-info">
  <div class="detail-card detail-card-audit-info">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-file-alt"></i>
      审计信息
    </h3>
  </div>
  <div class="detail-card-body">
    {# 审计日志 #}
    {% block detail_audit_log %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-file-alt"></i>
        审计日志
      </h5>
      <div class="detail-history-list">
        {% block detail_audit_log_content %}
        <div class="detail-empty-state">暂无审计日志</div>
        {% endblock detail_audit_log_content %}
      </div>
    </div>
    {% endblock detail_audit_log %}
    
    {# 修改记录 #}
    {% block detail_modification_history %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">
        <i class="fas fa-edit"></i>
        修改记录
      </h5>
      <div class="detail-history-list">
        {% block detail_modification_history_content %}
        <div class="detail-empty-state">暂无修改记录</div>
        {% endblock detail_modification_history_content %}
      </div>
    </div>
    {% endblock detail_modification_history %}
  </div>
</div>
</div>
{% endblock detail_audit_info_card %}

{# ==================== 卡片5：数据与统计信息 ==================== #}
{% block detail_statistics_card %}
<div class="detail-card-wrapper detail-card-wrapper-statistics">
  <div class="detail-card detail-card-statistics">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-chart-bar"></i>
      数据与统计信息
    </h3>
  </div>
  <div class="detail-card-body">
    {% block detail_statistics_content %}
    {# 进度条示例 #}
    {% if progress_percentage %}
    <div class="mb-4">
      <h5 class="detail-subsection-title">进度</h5>
      <div class="detail-progress" style="height: 25px;">
        <div class="detail-progress-bar" role="progressbar" 
             style="width: {{ progress_percentage }}%;" 
             aria-valuenow="{{ progress_percentage }}" 
             aria-valuemin="0" 
             aria-valuemax="100">
          {{ progress_percentage }}%
        </div>
      </div>
    </div>
    {% endif %}
    {# 图表和报告区域 #}
    {% block detail_charts %}
    <div class="detail-charts">
      {# 子模板可以在这里添加图表 #}
      {% block detail_charts_content %}{% endblock %}
    </div>
    {% endblock detail_charts %}
    {# 统计信息卡片 #}
    {% block detail_statistics_cards %}
    <div class="row">
      {% block detail_statistics_cards_content %}{% endblock %}
    </div>
    {% endblock detail_statistics_cards %}
    {% endblock detail_statistics_content %}
  </div>
</div>
</div>
{% endblock detail_statistics_card %}

{# ==================== 卡片6：附件与文件信息 ==================== #}
{% block detail_attachments_card %}
<div class="detail-card-wrapper detail-card-wrapper-attachments">
  <div class="detail-card detail-card-attachments">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-paperclip"></i>
      附件与文件信息
    </h3>
  </div>
  <div class="detail-card-body">
    {% block detail_attachments_content %}
    <div class="detail-attachments-list">
      {# 附件列表 #}
      {% if attachments %}
      <div class="row">
        {% for attachment in attachments %}
        <div class="col-md-3 col-sm-6 mb-3">
          <div class="attachment-card" style="padding: 15px;">
              <div class="attachment-icon">
                {% if attachment.file_type == 'pdf' %}
                  <i class="fas fa-file-pdf "></i>
                {% elif attachment.file_type == 'image' %}
                  <i class="fas fa-file-image "></i>
                {% elif attachment.file_type == 'video' %}
                  <i class="fas fa-file-video "></i>
                {% elif attachment.file_type == 'word' %}
                  <i class="fas fa-file-word "></i>
                {% elif attachment.file_type == 'excel' %}
                  <i class="fas fa-file-excel "></i>
                {% else %}
                  <i class="fas fa-file "></i>
                {% endif %}
              </div>
              <h6 class="attachment-name">{{ attachment.name|truncatechars:20 }}</h6>
              <p class="attachment-meta">
                <i class="fas fa-calendar"></i>
                {{ attachment.uploaded_at|date:"Y-m-d" }}
              </p>
              <div class="attachment-actions">
                <a href="{{ attachment.file.url }}" class="btn btn-sm btn-light" download>
                  <i class="fas fa-download"></i>
                  下载
                </a>
                {% if attachment.file_type == 'image' %}
                <button type="button" class="btn btn-sm btn-light" onclick="previewImage('{{ attachment.file.url }}')">
                  <i class="fas fa-eye"></i>
                  预览
                </button>
                {% endif %}
              </div>
          </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="detail-empty-state">暂无附件</div>
      {% endif %}
    </div>
    {% endblock detail_attachments_content %}
  </div>
</div>
</div>
{% endblock detail_attachments_card %}

{# ==================== 卡片7：系统信息 ==================== #}
{% block detail_system_info_card %}
<div class="detail-card-wrapper detail-card-wrapper-system-info">
  <div class="detail-card detail-card-system-info">
  <div class="detail-card-header">
    <h3 class="detail-card-title">
      <i class="fas fa-cog"></i>
      系统信息
    </h3>
  </div>
  <div class="detail-card-body">
    <div class="row">
      {# 创建时间 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">创建时间</label>
          <div class="detail-field-value">
            {% if object.created_time %}{{ object.created_time|date:"Y-m-d H:i:s" }}{% elif object.created_at %}{{ object.created_at|date:"Y-m-d H:i:s" }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 更新时间 #}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">更新时间</label>
          <div class="detail-field-value">
            {% if object.updated_time %}{{ object.updated_time|date:"Y-m-d H:i:s" }}{% elif object.updated_at %}{{ object.updated_at|date:"Y-m-d H:i:s" }}{% else %}N/A{% endif %}
          </div>
        </div>
      </div>
      {# 创建人 #}
      {% if object.created_by %}
      <div class="col-5-fields detail-field-wrapper">
        <div class="detail-field">
          <label class="detail-field-label">创建人</label>
          <div class="detail-field-value">
            {{ object.created_by.get_full_name|default:object.created_by.username }}
          </div>
        </div>
      </div>
      {% endif %}
      {# 空占位符 #}
      <div class="col-5-fields detail-field-wrapper"></div>
      <div class="col-5-fields detail-field-wrapper"></div>
    </div>
  </div>
</div>
</div>
{% endblock detail_system_info_card %}
</div>
{% endblock pm_content %}
{% block module_extra_js %}
{{ block.super }}
<script>
  // 图片预览功能
  function previewImage(imageUrl) {
    // 创建模态框显示图片
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
      <div class="modal-dialog modal-lg modal-dialog-centered" style="border-radius: 0;">
        <div class="modal-content" style="border-radius: 0; border: 1px solid #ddd;">
          <div class="modal-header" style="background-color: #f8f8f8; border-bottom: 1px solid #ddd;">
            <h5 class="modal-title" style="color: #333;">图片预览</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body text-center" style="background-color: #f0f0f0;">
            <img src="${imageUrl}" class="img-fluid" alt="预览图片" style="max-height: 70vh;">
          </div>
          <div class="modal-footer" style="background-color: #f8f8f8; border-top: 1px solid #ddd;">
            <a href="${imageUrl}" download class="btn btn-light">
              <i class="fas fa-download"></i> 下载图片
            </a>
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">关闭</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    modal.addEventListener('hidden.bs.modal', function() {
      document.body.removeChild(modal);
    });
  }
  
  // 页面加载完成后的初始化
  document.addEventListener('DOMContentLoaded', function() {
    // 可以在这里添加其他初始化逻辑
  });
</script>
{% endblock module_extra_js %}