{% load static %}

<aside class="vh-sb" aria-label="左侧栏（全屏固定）">
  <div class="vh-sb__top">
    <div class="vh-sb__topInner">
      <div class="vh-sb__titleWrap">
        <div class="vh-sb__title">{{ sidebar_title|default:"计划管理" }}</div>
        <div class="vh-sb__sub">{{ sidebar_subtitle|default:"Plan Management" }}</div>
      </div>

      {% block sidebar_top_extra %}{% endblock %}
    </div>
  </div>

  <nav class="vh-sb__nav">
    {% with menu_items=sidebar_nav|default:sidebar_menu|default:None %}
      {% if menu_items %}
        {% for item in menu_items %}
          {% if item.children %}
            <div class="vh-sb__parent" data-sb-parent data-sb-key="{{ forloop.counter }}-{{ item.label }}">
              <button type="button"
                      class="vh-sb__item vh-sb__item--parent {% if item.active %}is-active{% endif %}"
                      data-sb-toggle
                      aria-expanded="false">
                <span class="vh-sb__icon">
                  {% if item.icon and item.icon|slice:":3" == "fa-" %}
                    <i class="fas {{ item.icon }}"></i>
                  {% elif item.icon %}
                    {{ item.icon|default:"▢" }}
                  {% else %}
                    ▢
                  {% endif %}
                </span>
                <span class="vh-sb__label">{{ item.label }}</span>
                <span class="vh-sb__chev" aria-hidden="true">▸</span>
              </button>

              <div class="vh-sb__children" data-sb-children>
                {% for child in item.children %}
                  <a href="{{ child.url|default:'#' }}" class="vh-sb__child {% if child.active %}is-active{% endif %}">
                    <span class="vh-sb__icon">
                      {% if child.icon and child.icon|slice:":3" == "fa-" %}
                        <i class="fas {{ child.icon }}"></i>
                      {% elif child.icon %}
                        {{ child.icon|default:"·" }}
                      {% else %}
                        ·
                      {% endif %}
                    </span>
                    <span class="vh-sb__label">{{ child.label }}</span>
                  </a>
                {% endfor %}
              </div>
            </div>
          {% else %}
            <a href="{{ item.url|default:'#' }}" class="vh-sb__item {% if item.active %}is-active{% endif %}">
              <span class="vh-sb__icon">
                {% if item.icon and item.icon|slice:":3" == "fa-" %}
                  <i class="fas {{ item.icon }}"></i>
                {% elif item.icon %}
                  {{ item.icon|default:"▢" }}
                {% else %}
                  ▢
                {% endif %}
              </span>
              <span class="vh-sb__label">{{ item.label }}</span>
              {% if item.badge %}
                <span class="vh-sb__badge {% if item.badge == 'dot' %}vh-sb__badge--dot{% endif %}">
                  {{ item.badge }}
                </span>
              {% endif %}
            </a>
          {% endif %}
        {% endfor %}
      {% else %}
        <a href="/" class="vh-sb__item is-active">
          <span class="vh-sb__icon">▣</span>
          <span class="vh-sb__label">首页</span>
        </a>
      {% endif %}
    {% endwith %}

    {% block sidebar_nav_extra %}{% endblock %}
  </nav>

  <div class="vh-sb__bottom">
    <div class="vh-sb__mini">帮助</div>
    <div class="vh-sb__mini">设置</div>
    <div class="vh-sb__mini" onclick="if(typeof bootstrap !== 'undefined') { const modal = document.getElementById('feedbackModal'); if(modal) new bootstrap.Modal(modal).show(); }" style="cursor: pointer;">反馈</div>

    {% block sidebar_bottom_extra %}{% endblock %}
  </div>
</aside>

{% block sidebar_feedback_modal %}
  {% include 'system_management/feedback_form_modal.html' %}
{% endblock %}
