
{% load static %}

<aside class="vh-sb" aria-label="左侧栏（全屏固定）">

  <div class="vh-sb__top">
    <div class="vh-sb__topInner">
      <div class="vh-sb__titleWrap">
        <div class="vh-sb__title">计划管理</div>
        <div class="vh-sb__sub">Plan Management</div>
      </div>
    </div>
  </div>

  <nav class="vh-sb__nav">
    <div class="vh-sb__group">
      <div class="vh-sb__gtitle">概览</div>
      <div class="vh-sb__item is-active">
        <span class="vh-sb__icon">▣</span>
        <span class="vh-sb__label">计划首页</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">我的工作</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">待我处理</span>
        <span class="vh-sb__badge">1</span>
      </div>
    </div>

    <div class="vh-sb__group">
      <div class="vh-sb__gtitle">目标</div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">我的目标</span>
      </a>
      <div class="vh-sb__parent is-open">
        <div class="vh-sb__item vh-sb__item--parent">
          <span class="vh-sb__icon">▢</span>
          <span class="vh-sb__label">目标分解</span>
          <span class="vh-sb__chev">▾</span>
        </div>
        <div class="vh-sb__children">
          <div class="vh-sb__child is-active">· 结构编辑</div>
          <div class="vh-sb__child">· 分解记录</div>
        </div>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">目标跟踪</span>
      </div>
    </div>

    <div class="vh-sb__group">
      <div class="vh-sb__gtitle">计划</div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">计划列表</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">我的计划</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">即将到期</span>
        <span class="vh-sb__badge">2</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">已逾期</span>
        <span class="vh-sb__badge vh-sb__badge--dot">●</span>
      </div>
    </div>

    <div class="vh-sb__group">
      <div class="vh-sb__gtitle">分析</div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">完成度分析</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">目标达成分析</span>
      </div>
      <a href="{% url 'plan_pages:strategic_goal_list' %}" class="vh-sb__item">
        <span class="vh-sb__icon">▢</span>
        <span class="vh-sb__label">统计报表</span>
      </div>
    </div>
  </nav>

  <div class="vh-sb__bottom">
    <div class="vh-sb__mini">帮助</div>
    <div class="vh-sb__mini">设置</div>
    <div class="vh-sb__mini">反馈</div>
  </div>

</aside>

<style>
/* ===== Sidebar · 全屏固定（不随页面滚动） ===== */

/* 1) 侧栏：固定在视口，从导航栏下方开始 */
.vh-sb{
  width: 232px;
  position: fixed;
  top: 56px;  /* 从顶部导航栏下方开始 */
  bottom: 0;
  left: 0;

  display: flex;
  flex-direction: column;

  background: #fff;
  border-right: 1px solid rgba(0,0,0,.08);
  box-shadow: 1px 0 4px rgba(0,0,0,.04);

  /* 严禁侧栏滚动 */
  overflow: hidden;
  z-index: 1020;
  
  font-family: "Microsoft YaHei", "PingFang SC", "Segoe UI", sans-serif;
}

/* 2) 顶部：自适应高度 */
.vh-sb__top{
  flex: 0 0 auto;
  border-bottom: 1px solid rgba(0,0,0,.08);
  background: #fff;
}
.vh-sb__topInner{
  padding: 10px 14px;
  display: flex;
  align-items: center;
  gap: 0;
  min-height: 44px;
}
.vh-sb__titleWrap{
  flex: 1 1 auto;
  min-width: 0;
}
.vh-sb__title{
  font-weight: 700;
  font-size: 14px;
  line-height: 1.0;
  color: var(--vh-text, #1F2937);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 2px;
}
.vh-sb__sub{
  font-size: 11px;
  color: var(--vh-text-muted, #6B7280);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.1;
}

/* 3) 中部：吃掉剩余高度，但依然禁止滚动 */
.vh-sb__nav{
  flex: 1 1 auto;
  overflow: hidden;
  padding: 6px 4px;
  min-height: 0;
}

/* group */
.vh-sb__group{
  margin-bottom: 8px;
}
.vh-sb__group:last-child{
  margin-bottom: 0;
}
.vh-sb__gtitle{
  font-size: 11px;
  font-weight: 700;
  color: var(--vh-text-muted, #6B7280);
  padding: 6px 10px 4px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  margin-bottom: 1px;
}

/* item */
.vh-sb__item{
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 10px;
  border-radius: 10px;
  color: var(--vh-text, #1F2937);
  font-size: 13px;
  line-height: 1.0;
  user-select: none;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 1px;
}
.vh-sb__item:hover{ 
  background: rgba(0,0,0,.04);
  color: var(--vh-primary, #1F2A57);
}
.vh-sb__item.is-active{
  background: rgba(31, 42, 87, 0.08);
  color: var(--vh-primary, #1F2A57);
  font-weight: 600;
}
.vh-sb__item.is-active .vh-sb__icon{
  color: var(--vh-primary, #1F2A57);
}

.vh-sb__icon{
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: var(--vh-text-muted, #6B7280);
  flex: 0 0 auto;
  transition: color 0.2s ease;
}
.vh-sb__label{
  flex: 1 1 auto;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.vh-sb__badge{
  font-size: 11px;
  font-weight: 700;
  color: var(--vh-text, #1F2937);
  background: rgba(0,0,0,.06);
  border-radius: 10px;
  padding: 2px 7px;
  margin-left: auto;
  flex: 0 0 auto;
  line-height: 1.0;
  min-width: 18px;
  text-align: center;
}
.vh-sb__badge--dot{
  padding: 2px 7px;
  background: rgba(226, 61, 61, 0.1);
  color: var(--vh-error, #E23D3D);
}

.vh-sb__chev{
  color: var(--vh-text-muted, #6B7280);
  font-size: 12px;
  margin-left: auto;
  flex: 0 0 auto;
  transition: transform 0.2s ease;
}
.vh-sb__parent.is-open .vh-sb__chev{
  transform: rotate(180deg);
}

.vh-sb__parent .vh-sb__item--parent{
  width: 100%;
  background: transparent;
  border: none;
  cursor: pointer;
  text-align: left;
  padding: 6px 10px;
}

.vh-sb__children{
  padding: 2px 0 1px 38px;
  display: none;
}
.vh-sb__parent.is-open .vh-sb__children{ 
  display: block;
}

.vh-sb__child{
  display: block;
  padding: 5px 10px;
  border-radius: 8px;
  font-size: 12px;
  color: var(--vh-text, #1F2937);
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 1px;
  line-height: 1.2;
}
.vh-sb__child:hover{ 
  background: rgba(0,0,0,.03);
  color: var(--vh-primary, #1F2A57);
}
.vh-sb__child.is-active{
  background: rgba(31, 42, 87, 0.06);
  color: var(--vh-primary, #1F2A57);
  font-weight: 600;
}

/* 4) 底部：永远贴住屏幕底边 */
.vh-sb__bottom{
  flex: 0 0 auto;
  margin-top: auto;
  padding: 10px 12px;
  border-top: 1px solid rgba(0,0,0,.08);
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  background: rgba(0,0,0,.01);
}
.vh-sb__mini{
  font-size: 11px;
  color: var(--vh-text-muted, #6B7280);
  padding: 5px 8px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.02);
  cursor: pointer;
  transition: all 0.2s ease;
  line-height: 1.3;
}
.vh-sb__mini:hover{ 
  background: rgba(0,0,0,.04);
  color: var(--vh-text, #1F2937);
  border-color: rgba(0,0,0,.12);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.vh-sb__item--parent').forEach(function(btn) {
    btn.addEventListener('click', function() {
      const parent = this.closest('.vh-sb__parent');
      if (parent) {
        parent.classList.toggle('is-open');
        const expanded = parent.classList.contains('is-open');
        this.setAttribute('aria-expanded', expanded);
      }
    });
  });
});
</script>
