{% extends "delivery_customer/base.html" %}
{% load static %}

{% block title %}æ”¶æ–‡è¯¦æƒ… - ç»´æµ·ç§‘æŠ€ä¿¡æ¯åŒ–ç®¡ç†å¹³å°{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'delivery_pages:report_delivery' %}">æ”¶å‘ç®¡ç†</a></li>
<li class="breadcrumb-item"><a href="{% url 'delivery_pages:incoming_document_list' %}">æ”¶æ–‡åˆ—è¡¨</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ document.document_number }}</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">ğŸ“¥ æ”¶æ–‡è¯¦æƒ…</h2>
            <p class="text-muted mb-0">æ”¶æ–‡ç¼–å·ï¼š{{ document.document_number }}</p>
        </div>
        <div>
            <a href="{% url 'delivery_pages:incoming_document_list' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> è¿”å›åˆ—è¡¨
            </a>
            {% if can_edit %}
            <a href="{% url 'delivery_pages:incoming_document_edit' document.id %}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> ç¼–è¾‘
            </a>
            {% endif %}
        </div>
    </div>

    <div class="info-card info-card-fade-in mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">åŸºæœ¬ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid info-grid-2">
                <div class="info-item">
                    <span class="info-label">æ”¶æ–‡ç¼–å·</span>
                    <span class="info-value"><code>{{ document.document_number }}</code></span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ–‡ä»¶æ ‡é¢˜</span>
                    <span class="info-value"><strong>{{ document.title }}</strong></span>
                </div>
                <div class="info-item">
                    <span class="info-label">å‘æ–‡å•ä½</span>
                    <span class="info-value">{{ document.sender }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">è”ç³»äºº</span>
                    <span class="info-value">{{ document.sender_contact|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">è”ç³»ç”µè¯</span>
                    <span class="info-value">{{ document.sender_phone|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ–‡ä»¶ç±»å‹</span>
                    <span class="info-value">{{ document.document_type|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ–‡ä»¶æ—¥æœŸ</span>
                    <span class="info-value">{{ document.document_date|date:"Y-m-d"|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ”¶æ–‡æ—¥æœŸ</span>
                    <span class="info-value">{{ document.receive_date|date:"Y-m-d"|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">çŠ¶æ€</span>
                    <span class="info-value">
                        {% if document.status == 'draft' %}
                            <span class="badge bg-secondary">è‰ç¨¿</span>
                        {% elif document.status == 'registered' %}
                            <span class="badge bg-info">å·²ç™»è®°</span>
                        {% elif document.status == 'processing' %}
                            <span class="badge bg-warning">å¤„ç†ä¸­</span>
                        {% elif document.status == 'completed' %}
                            <span class="badge bg-success">å·²å®Œæˆ</span>
                        {% elif document.status == 'archived' %}
                            <span class="badge bg-dark">å·²å½’æ¡£</span>
                        {% endif %}
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">ä¼˜å…ˆçº§</span>
                    <span class="info-value">
                        {% if document.priority == 'urgent' %}
                            <span class="badge bg-danger">ç´§æ€¥</span>
                        {% elif document.priority == 'high' %}
                            <span class="badge bg-warning">é«˜</span>
                        {% elif document.priority == 'normal' %}
                            <span class="badge bg-info">æ™®é€š</span>
                        {% else %}
                            <span class="badge bg-secondary">ä½</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    {% if document.summary or document.content %}
    <div class="info-card info-card-fade-in mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">å†…å®¹</h5>
        </div>
        <div class="info-card-body">
            {% if document.summary %}
            <div class="mb-3">
                <strong>æ‘˜è¦ï¼š</strong>
                <p>{{ document.summary|linebreaks }}</p>
            </div>
            {% endif %}
            {% if document.content %}
            <div>
                <strong>æ–‡ä»¶å†…å®¹ï¼š</strong>
                <p>{{ document.content|linebreaks }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if document.handler or document.handle_notes %}
    <div class="info-card info-card-fade-in mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">å¤„ç†ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid info-grid-2">
                {% if document.handler %}
                <div class="info-item">
                    <span class="info-label">å¤„ç†äºº</span>
                    <span class="info-value">{{ document.handler.get_full_name|default:document.handler.username }}</span>
                </div>
                {% endif %}
                {% if document.completed_at %}
                <div class="info-item">
                    <span class="info-label">å®Œæˆæ—¶é—´</span>
                    <span class="info-value">{{ document.completed_at|date:"Y-m-d H:i:s" }}</span>
                </div>
                {% endif %}
                {% if document.handle_notes %}
                <div class="info-item info-item-full-width">
                    <span class="info-label">å¤„ç†æ„è§</span>
                    <span class="info-value">{{ document.handle_notes|linebreaks }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if document.attachment %}
    <div class="info-card info-card-fade-in mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">é™„ä»¶</h5>
        </div>
        <div class="info-card-body">
            <a href="{{ document.attachment.url }}" target="_blank" class="btn btn-outline-primary">
                <i class="bi bi-download"></i> ä¸‹è½½é™„ä»¶
            </a>
        </div>
    </div>
    {% endif %}

    {% if document.notes %}
    <div class="info-card info-card-fade-in mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">å¤‡æ³¨</h5>
        </div>
        <div class="info-card-body">
            <p>{{ document.notes|linebreaks }}</p>
        </div>
    </div>
    {% endif %}

    <div class="info-card info-card-fade-in">
        <div class="info-card-header">
            <h5 class="info-card-title">æ—¶é—´ä¿¡æ¯</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid info-grid-2">
                <div class="info-item">
                    <span class="info-label">åˆ›å»ºæ—¶é—´</span>
                    <span class="info-value">{{ document.created_at|date:"Y-m-d H:i:s" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ›´æ–°æ—¶é—´</span>
                    <span class="info-value">{{ document.updated_at|date:"Y-m-d H:i:s" }}</span>
                </div>
                {% if document.created_by %}
                <div class="info-item">
                    <span class="info-label">åˆ›å»ºäºº</span>
                    <span class="info-value">{{ document.created_by.get_full_name|default:document.created_by.username }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
