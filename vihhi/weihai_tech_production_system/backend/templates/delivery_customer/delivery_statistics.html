{% extends "delivery_customer/base.html" %}
{% load static %}

{% block title %}äº¤ä»˜ç»Ÿè®¡ - ç»´æµ·ç§‘æŠ€ä¿¡æ¯åŒ–ç®¡ç†å¹³å°{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'delivery_pages:report_delivery' %}">æ”¶å‘ç®¡ç†</a></li>
<li class="breadcrumb-item active">äº¤ä»˜ç»Ÿè®¡</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">ğŸ“ˆ äº¤ä»˜ç»Ÿè®¡</h2>
            <p class="text-muted mb-0">äº¤ä»˜æ•ˆç‡ä¸åŠæ—¶ç‡åˆ†æ</p>
        </div>
        <div>
            <a href="{% url 'delivery_pages:delivery_list' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> è¿”å›åˆ—è¡¨
            </a>
        </div>
    </div>

    <!-- æ€»ä½“ç»Ÿè®¡ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="info-card info-card-info">
                <div class="info-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="info-label">äº¤ä»˜æ€»æ•°</div>
                            <div class="info-value info-value-large">{{ total_count }}</div>
                        </div>
                        <div class="text-info" style="font-size: 2rem;">
                            <i class="bi bi-files"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="info-card info-card-success">
                <div class="info-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="info-label">ä»Šæ—¥äº¤ä»˜</div>
                            <div class="info-value info-value-large">{{ time_statistics.today_count }}</div>
                        </div>
                        <div class="text-success" style="font-size: 2rem;">
                            <i class="bi bi-calendar-day"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="info-card info-card-warning">
                <div class="info-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="info-label">æœ¬å‘¨äº¤ä»˜</div>
                            <div class="info-value info-value-large">{{ time_statistics.week_count }}</div>
                        </div>
                        <div class="text-warning" style="font-size: 2rem;">
                            <i class="bi bi-calendar-week"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="info-card info-card-danger">
                <div class="info-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="info-label">å·²é€¾æœŸ</div>
                            <div class="info-value info-value-large">{{ overdue_count }}</div>
                        </div>
                        <div class="text-danger" style="font-size: 2rem;">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€åˆ†å¸ƒç»Ÿè®¡ -->
    <div class="info-card mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">äº¤ä»˜çŠ¶æ€åˆ†å¸ƒ</h5>
        </div>
        <div class="info-card-body">
            <div class="row">
                {% for status_code, status_data in status_distribution.items %}
                <div class="col-md-3 mb-3">
                    <div class="info-card info-card-flat">
                        <div class="info-card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="info-label">{{ status_data.label }}</div>
                                    <div class="info-value info-value-large">{{ status_data.count }}</div>
                                </div>
                                <span class="status-badge {{ status_code }}">{{ status_data.label }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- äº¤ä»˜æ–¹å¼ç»Ÿè®¡ -->
    <div class="info-card mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">äº¤ä»˜æ–¹å¼ç»Ÿè®¡</h5>
        </div>
        <div class="info-card-body">
            <div class="row">
                {% for method_code, method_data in method_distribution.items %}
                <div class="col-md-4 mb-3">
                    <div class="info-card info-card-flat">
                        <div class="info-card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="info-label">{{ method_data.label }}</div>
                                    <div class="info-value info-value-large">{{ method_data.count }}</div>
                                </div>
                                <div style="font-size: 2rem;">
                                    {% if method_code == 'email' %}
                                    <i class="bi bi-envelope text-primary"></i>
                                    {% elif method_code == 'express' %}
                                    <i class="bi bi-box-seam text-info"></i>
                                    {% elif method_code == 'hand_delivery' %}
                                    <i class="bi bi-person-walking text-success"></i>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶ç»Ÿè®¡ -->
    <div class="info-card mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">æ–‡ä»¶ç»Ÿè®¡</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid info-grid-2">
                <div class="info-item">
                    <span class="info-label">æ–‡ä»¶æ€»æ•°</span>
                    <span class="info-value info-value-large">{{ file_statistics.total_files }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æ–‡ä»¶æ€»å¤§å°</span>
                    <span class="info-value info-value-large">
                        {% if file_statistics.total_size %}
                            {% widthratio file_statistics.total_size 1048576 1 %} MB
                        {% else %}
                            0 MB
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¶é—´ç»Ÿè®¡ -->
    <div class="info-card mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">æ—¶é—´ç»Ÿè®¡</h5>
        </div>
        <div class="info-card-body">
            <div class="info-grid info-grid-3">
                <div class="info-item">
                    <span class="info-label">ä»Šæ—¥äº¤ä»˜</span>
                    <span class="info-value info-value-large">{{ time_statistics.today_count }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æœ¬å‘¨äº¤ä»˜</span>
                    <span class="info-value info-value-large">{{ time_statistics.week_count }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">æœ¬æœˆäº¤ä»˜</span>
                    <span class="info-value info-value-large">{{ time_statistics.month_count }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- é£é™©ç­‰çº§åˆ†å¸ƒ -->
    {% if risk_distribution %}
    <div class="info-card mb-4">
        <div class="info-card-header">
            <h5 class="info-card-title">é£é™©ç­‰çº§åˆ†å¸ƒ</h5>
        </div>
        <div class="info-card-body">
            <div class="row">
                {% for risk_code, risk_data in risk_distribution.items %}
                <div class="col-md-3 mb-3">
                    <div class="info-card info-card-flat">
                        <div class="info-card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="info-label">{{ risk_data.label }}</div>
                                    <div class="info-value info-value-large">{{ risk_data.count }}</div>
                                </div>
                                <div>
                                    {% if risk_code == 'low' %}
                                    <span class="badge bg-success">ä½é£é™©</span>
                                    {% elif risk_code == 'medium' %}
                                    <span class="badge bg-warning">ä¸­é£é™©</span>
                                    {% elif risk_code == 'high' %}
                                    <span class="badge bg-danger">é«˜é£é™©</span>
                                    {% elif risk_code == 'critical' %}
                                    <span class="badge bg-dark">ä¸¥é‡é£é™©</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
