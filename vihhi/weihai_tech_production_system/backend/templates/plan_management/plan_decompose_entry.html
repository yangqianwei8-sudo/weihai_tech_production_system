{% extends "shared/list_page_base.html" %}
{% load static %}

{% block page_title %}è®¡åˆ’åˆ†è§£{% endblock page_title %}
{% block page_subtitle %}é€‰æ‹©è¦åˆ†è§£çš„è®¡åˆ’{% endblock page_subtitle %}

{% block module_styles %}
  {{ block.super }}
  <style>
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
    }
    .status-draft { background: #e9ecef; color: #495057; }
    .status-pending_approval { background: #cfe2ff; color: #084298; }
    .status-approving { background: #fff3cd; color: #856404; }
    .status-approved { background: #d1e7dd; color: #0f5132; }
    .status-in_progress { background: #fff3cd; color: #856404; }
    .status-completed { background: #d1e7dd; color: #0f5132; }
    .status-cancelled { background: #f8d7da; color: #842029; }
  </style>
{% endblock %}

{% block list_stats_content %}
  <div class="row g-3">
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å¯åˆ†è§£è®¡åˆ’æ€»æ•°</div>
        <div class="list-stat-value">{{ total_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">æ‰§è¡Œä¸­</div>
        <div class="list-stat-value">{{ in_progress_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">è‰ç¨¿</div>
        <div class="list-stat-value">{{ draft_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å·²å®Œæˆ</div>
        <div class="list-stat-value">{{ completed_count|default:0 }}</div>
      </div>
    </div>
  </div>
{% endblock list_stats_content %}

{% block list_filters_content %}
  <div class="col-md-3">
    <label class="form-label">æœç´¢</label>
    <input type="text" name="search" class="form-control" value="{{ search }}" placeholder="è®¡åˆ’ç¼–å·ã€åç§°ã€è´Ÿè´£äºº">
  </div>
  <div class="col-md-2">
    <label class="form-label">çŠ¶æ€</label>
    <select name="status" class="form-select">
      <option value="">å…¨éƒ¨çŠ¶æ€</option>
      {% for value, label in status_options %}
      <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">è®¡åˆ’å±‚çº§</label>
    <select name="level" class="form-select">
      <option value="">å…¨éƒ¨å±‚çº§</option>
      {% for value, label in level_choices %}
      <option value="{{ value }}" {% if level_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">è®¡åˆ’å‘¨æœŸ</label>
    <select name="plan_period" class="form-select">
      <option value="">å…¨éƒ¨å‘¨æœŸ</option>
      {% for value, label in plan_period_choices %}
      <option value="{{ value }}" {% if plan_period_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">è´Ÿè´£äºº</label>
    <select name="responsible_person" class="form-select">
      <option value="">å…¨éƒ¨è´Ÿè´£äºº</option>
      {% for u in all_users %}
      <option value="{{ u.id }}" {% if responsible_filter|stringformat:"s" == u.id|stringformat:"s" %}selected{% endif %}>
        {{ u.get_full_name|default:u.username }}
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">å…³è”ç›®æ ‡</label>
    <select name="related_goal" class="form-select">
      <option value="">å…¨éƒ¨ç›®æ ‡</option>
      {% for goal in all_goals %}
      <option value="{{ goal.id }}" {% if related_goal_filter|stringformat:"s" == goal.id|stringformat:"s" %}selected{% endif %}>
        {{ goal.name|truncatewords:5 }}
      </option>
      {% endfor %}
    </select>
  </div>
{% endblock list_filters_content %}

{% block list_table_headers %}
  <th>è®¡åˆ’ç¼–å·</th>
  <th>è®¡åˆ’åç§°</th>
  <th>è®¡åˆ’å±‚çº§</th>
  <th>è®¡åˆ’å‘¨æœŸ</th>
  <th>å…³è”ç›®æ ‡</th>
  <th>è´Ÿè´£äºº</th>
  <th>æ—¶é—´èŒƒå›´</th>
  <th>çŠ¶æ€</th>
  <th>æ“ä½œ</th>
{% endblock list_table_headers %}

{% block list_table_rows %}
  {% for plan in page_obj %}
  <tr>
    <td><code>{{ plan.plan_number }}</code></td>
    <td>
      <a href="{% url 'plan_pages:plan_detail' plan.id %}" class="text-dark text-decoration-none fw-medium">
        {{ plan.name }}
      </a>
    </td>
    <td>{{ plan.get_level_display }}</td>
    <td>{{ plan.get_plan_period_display }}</td>
    <td>
      {% if plan.related_goal %}
      <a href="{% url 'plan_pages:strategic_goal_detail' plan.related_goal.id %}" class="text-dark text-decoration-none">
        {{ plan.related_goal.name|truncatewords:5 }}
      </a>
      {% else %}
      <span style="color: #999999;">-</span>
      {% endif %}
    </td>
    <td>{{ plan.responsible_person.get_full_name|default:plan.responsible_person.username }}</td>
    <td>
      <div style="font-size: 12px; color: #666666;">
        {{ plan.start_time|date:"Y-m-d" }} ~ {{ plan.end_time|date:"Y-m-d" }}
      </div>
    </td>
    <td>
      <span class="status-badge status-{{ plan.status }}">
        {{ plan.get_status_display }}
      </span>
    </td>
    <td>
      <div class="btn-group btn-group-sm">
        <a href="{% url 'plan_pages:plan_decompose' plan.id %}" class="btn btn-sm" title="å¼€å§‹åˆ†è§£">åˆ†è§£</a>
      </div>
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="9" class="list-empty-state">
      <div class="list-empty-state-icon">ğŸ“‹</div>
      <div class="list-empty-state-text">æš‚æ— å¯åˆ†è§£çš„è®¡åˆ’</div>
      <div class="list-empty-state-hint">è¯·å…ˆåˆ›å»ºè®¡åˆ’æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</div>
    </td>
  </tr>
  {% endfor %}
{% endblock list_table_rows %}
