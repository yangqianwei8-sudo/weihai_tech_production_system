<div class="list-table-container">
  <table class="list-table">
    <thead>
      <tr>
        <th>计划编号</th>
        <th>计划名称</th>
        <th>请求类型</th>
        <th>请求人</th>
        <th>请求时间</th>
        <th>计划状态</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for d in pending_decisions %}
      <tr>
        <td><code>{{ d.plan.plan_number }}</code></td>
        <td>
          <a href="{% url 'plan_pages:plan_detail' d.plan.id %}">
            {{ d.plan.name|default:"(未命名计划)" }}
          </a>
          {% if d.plan.description %}
          <div style="font-size: 11px; color: #999999; margin-top: 4px;">
            {{ d.plan.description|truncatewords:10 }}
          </div>
          {% endif %}
        </td>
        <td>
          <span class="list-badge {% if d.request_type == 'start' %}list-badge-published{% else %}list-badge-in_progress{% endif %}">
            {% if d.request_type == 'start' %}启动{% else %}取消{% endif %}
          </span>
        </td>
        <td>
          <div style="font-size: 12px;">
            {{ d.requested_by.get_full_name|default:d.requested_by.username|default:"-" }}
          </div>
          {% if d.plan.responsible_person %}
          <div style="font-size: 11px; color: #999999; margin-top: 2px;">
            负责人：{{ d.plan.responsible_person.get_full_name|default:d.plan.responsible_person.username }}
          </div>
          {% endif %}
        </td>
        <td>
          <div style="font-size: 11px; color: #666666;">
            {{ d.requested_at|date:"Y-m-d" }}<br>
            {{ d.requested_at|date:"H:i" }}
          </div>
        </td>
        <td>
          <span class="list-badge list-badge-{{ d.plan.status }}">
            {{ d.plan.get_status_display }}
          </span>
        </td>
        <td>
          <div class="list-actions">
            <a href="{% url 'plan_pages:plan_detail' d.plan.id %}" class="list-btn" title="查看详情">查看</a>
            {% if can_approve %}
            <button class="list-btn" title="通过" onclick="decidePlanDecision({{ d.id }}, true)">通过</button>
            <button class="list-btn" title="驳回" onclick="decidePlanDecision({{ d.id }}, false)">驳回</button>
            {% endif %}
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="list-empty">
          <div class="list-empty-icon">▢</div>
          <div class="list-empty-text">当前没有待裁决的请求</div>
          <div class="list-empty-hint">所有计划请求已处理完毕</div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if can_approve %}
<div style="background: #FAFAFA; border: 1px solid #E0E0E0; border-radius: 0; padding: 16px; margin-top: 16px;">
  <div style="font-size: 13px; color: #666666; margin-bottom: 8px; font-weight: 600;">审批说明：</div>
  <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: #666666; line-height: 1.8;">
    <li>点击"通过"通过请求，计划将进入下一状态</li>
    <li>点击"驳回"驳回请求，计划将保持当前状态</li>
    <li>审批前建议先查看计划详情，了解计划的完整信息</li>
  </ul>
</div>
{% endif %}
