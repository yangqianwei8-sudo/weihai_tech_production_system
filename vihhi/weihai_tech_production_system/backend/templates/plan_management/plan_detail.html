{% extends "plan_management/_base.html" %}

{% block pm_title %}计划详情{% endblock %}
{% block pm_subtitle %}{{ plan.name }}{% endblock %}

{% block pm_actions %}
<a class="btn btn-secondary btn-sm" href="{% url 'plan_pages:plan_list' %}">返回列表</a>
<a class="btn btn-danger btn-sm" href="{% url 'plan_pages:plan_edit' plan.id %}">编辑</a>
{% endblock %}

{% block pm_content %}
<div class="card"><div class="card-body">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">

    <div>
      <div style="color:#666;font-size:12px;">计划名称</div>
      <div style="font-weight:700;">{{ plan.name }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">状态</div>
      {% with s=plan.status %}
        <span class="badge-status
          {% if s == 'draft' %}badge-draft
          {% elif s == 'in_progress' %}badge-in_progress
          {% elif s == 'completed' %}badge-completed
          {% elif s == 'cancelled' %}badge-cancelled
          {% else %}badge-draft{% endif %}">
          {{ plan.get_status_display|default:plan.status }}
        </span>
      {% endwith %}
    </div>

    {% if progress_percent is not None %}
    <div style="grid-column:1 / -1;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
        <div style="color:#666;font-size:12px;">时间进度</div>
        <div style="font-weight:700;">{{ progress_percent }}%</div>
      </div>
      <div style="height:10px;background:#eef2f7;border-radius:999px;overflow:hidden;margin-top:6px;">
        <div style="height:10px;width:{{ progress_percent }}%;background:#c41c1c;"></div>
      </div>
      <div style="color:#666;font-size:12px;margin-top:6px;">
        {{ plan.start_time|date:"Y-m-d" }} → {{ plan.end_time|date:"Y-m-d" }}
      </div>
    </div>
    {% endif %}

    <div>
      <div style="color:#666;font-size:12px;">计划类型</div>
      <div>{{ plan.get_plan_type_display|default:plan.plan_type }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">计划周期</div>
      <div>{{ plan.get_plan_period_display|default:plan.plan_period }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">开始时间</div>
      <div>{{ plan.start_time|date:"Y-m-d H:i" }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">结束时间</div>
      <div>{{ plan.end_time|date:"Y-m-d H:i" }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">负责人</div>
      <div>{{ plan.responsible_person.get_full_name|default:plan.responsible_person.username }}</div>
    </div>

    <div>
      <div style="color:#666;font-size:12px;">关联目标</div>
      <div>{% if plan.related_goal %}{{ plan.related_goal.name }}{% else %}-{% endif %}</div>
    </div>

    {% if plan.content %}
    <div style="grid-column:1 / -1;">
      <div style="color:#666;font-size:12px;">内容</div>
      <div style="white-space:pre-wrap;">{{ plan.content }}</div>
    </div>
    {% endif %}

    {% if plan.plan_objective %}
    <div style="grid-column:1 / -1;">
      <div style="color:#666;font-size:12px;">计划目标</div>
      <div style="white-space:pre-wrap;">{{ plan.plan_objective }}</div>
    </div>
    {% endif %}

  </div>
  </div>
</div>
{% endblock %}
