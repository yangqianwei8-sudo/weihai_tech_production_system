{% extends "shared/module_base.html" %}
{% load static %}

{% block pm_title %}å®¡æ‰¹è°ƒæ•´ç”³è¯·{% endblock %}
{% block pm_subtitle %}<span class="pm-subtitle">{{ goal.name }}</span>{% endblock %}

{% block pm_actions %}
<a href="{% url 'plan_pages:goal_adjustment_list' %}" class="list-btn">
  è¿”å›åˆ—è¡¨
</a>
{% endblock %}

{% block module_styles %}
<link rel="stylesheet" href="{% static 'css/layouts/list-layout.css' %}">
{% endblock %}

{% block pm_content %}
<div class="detail-card">
  <div class="detail-card-title">ğŸ“‹ è°ƒæ•´ç”³è¯·ä¿¡æ¯</div>
  <div class="detail-info-grid">
    <div class="detail-info-item">
      <div class="detail-info-label">ç›®æ ‡ç¼–å·</div>
      <div class="detail-info-value">{{ goal.goal_number }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">ç›®æ ‡åç§°</div>
      <div class="detail-info-value">{{ goal.name }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">è°ƒæ•´ç±»å‹</div>
      <div class="detail-info-value">{{ adjustment.get_adjustment_type_display }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">ç”³è¯·äºº</div>
      <div class="detail-info-value">{% if adjustment.created_by %}{{ adjustment.created_by.get_full_name|default:adjustment.created_by.username }}{% else %}-{% endif %}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">ç”³è¯·æ—¶é—´</div>
      <div class="detail-info-value">{{ adjustment.created_time|date:"Y-m-d H:i" }}</div>
    </div>
  </div>
</div>

{% if adjustment.adjustment_type == 'time' %}
<div class="detail-card" style="margin-top: 20px;">
  <div class="detail-card-title">â° æ—¶é—´è°ƒæ•´è¯¦æƒ…</div>
  <div class="detail-info-grid">
    <div class="detail-info-item">
      <div class="detail-info-label">åŸå¼€å§‹æ—¥æœŸ</div>
      <div class="detail-info-value">{{ goal.start_date|date:"Y-m-d" }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">æ–°å¼€å§‹æ—¥æœŸ</div>
      <div class="detail-info-value"><strong>{% if adjustment.new_start_date %}{{ adjustment.new_start_date|date:"Y-m-d" }}{% else %}-{% endif %}</strong></div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">åŸç»“æŸæ—¥æœŸ</div>
      <div class="detail-info-value">{{ goal.end_date|date:"Y-m-d" }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">æ–°ç»“æŸæ—¥æœŸ</div>
      <div class="detail-info-value"><strong>{% if adjustment.new_end_date %}{{ adjustment.new_end_date|date:"Y-m-d" }}{% else %}-{% endif %}</strong></div>
    </div>
  </div>
</div>
{% elif adjustment.adjustment_type == 'responsible' %}
<div class="detail-card" style="margin-top: 20px;">
  <div class="detail-card-title">ğŸ‘¤ è´Ÿè´£äººè°ƒæ•´è¯¦æƒ…</div>
  <div class="detail-info-grid">
    <div class="detail-info-item">
      <div class="detail-info-label">åŸè´Ÿè´£äºº</div>
      <div class="detail-info-value">{{ goal.responsible_person.get_full_name|default:goal.responsible_person.username }}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">æ–°è´Ÿè´£äºº</div>
      <div class="detail-info-value"><strong>{% if adjustment.new_responsible_person %}{{ adjustment.new_responsible_person.get_full_name|default:adjustment.new_responsible_person.username }}{% else %}-{% endif %}</strong></div>
    </div>
  </div>
</div>
{% elif adjustment.adjustment_type == 'target_value' %}
<div class="detail-card" style="margin-top: 20px;">
  <div class="detail-card-title">ğŸ¯ ç›®æ ‡å€¼è°ƒæ•´è¯¦æƒ…</div>
  <div class="detail-info-grid">
    <div class="detail-info-item">
      <div class="detail-info-label">åŸç›®æ ‡å€¼</div>
      <div class="detail-info-value">{{ goal.target_value|floatformat:2 }}{% if goal.indicator_unit %} {{ goal.indicator_unit }}{% endif %}</div>
    </div>
    <div class="detail-info-item">
      <div class="detail-info-label">æ–°ç›®æ ‡å€¼</div>
      <div class="detail-info-value"><strong>{% if adjustment.new_target_value %}{{ adjustment.new_target_value|floatformat:2 }}{% if goal.indicator_unit %} {{ goal.indicator_unit }}{% endif %}{% else %}-{% endif %}</strong></div>
    </div>
  </div>
</div>
{% endif %}

<div class="detail-card" style="margin-top: 20px;">
  <div class="detail-card-title">ğŸ“ è°ƒæ•´åŸå› </div>
  <div style="padding: 16px; font-size: 12px; color: #333333; line-height: 1.6;">
    {{ adjustment.adjustment_reason|linebreaks }}
  </div>
</div>

{% if adjustment.adjustment_content %}
<div class="detail-card" style="margin-top: 20px;">
  <div class="detail-card-title">ğŸ“„ è°ƒæ•´å†…å®¹</div>
  <div style="padding: 16px; font-size: 12px; color: #333333; line-height: 1.6;">
    {{ adjustment.adjustment_content|linebreaks }}
  </div>
</div>
{% endif %}

<form method="post" style="margin-top: 20px;">
  {% csrf_token %}
  <div class="detail-card">
    <div class="detail-card-title">âœ… å®¡æ‰¹æ„è§</div>
    <div style="padding: 16px;">
      <textarea name="approval_notes" rows="4" class="form-control" placeholder="è¯·è¾“å…¥å®¡æ‰¹æ„è§ï¼ˆå¯é€‰ï¼‰"></textarea>
    </div>
  </div>

  <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 12px;">
    <a href="{% url 'plan_pages:goal_adjustment_list' %}" class="list-btn">å–æ¶ˆ</a>
    <button type="submit" class="list-btn list-btn-primary">æ‰¹å‡†ç”³è¯·</button>
  </div>
</form>
{% endblock %}
