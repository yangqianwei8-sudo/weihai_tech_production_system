{% extends "shared/list_page_base.html" %}
{% load static %}

{% block page_title %}è®¡åˆ’è°ƒæ•´åˆ—è¡¨{% endblock page_title %}
{% block page_subtitle %}æŸ¥çœ‹å’Œç®¡ç†è®¡åˆ’è°ƒæ•´ç”³è¯·{% endblock page_subtitle %}

{% block module_styles %}
  {{ block.super }}
<style>
  .list-badge-pending { background: #FFF3CD; color: #856404; border-color: #FFE69C; }
  .list-badge-approved { background: #D1E7DD; color: #0F5132; border-color: #A3CFBB; }
  .list-badge-rejected { background: #F8D7DA; color: #842029; border-color: #F1AEB5; }
</style>
{% endblock %}

{% block list_stats_content %}
  <div class="row g-3">
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">æ€»è®¡</div>
        <div class="list-stat-value">{{ total_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å¾…å®¡æ‰¹</div>
        <div class="list-stat-value">{{ pending_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å·²æ‰¹å‡†</div>
        <div class="list-stat-value">{{ approved_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å·²æ‹’ç»</div>
        <div class="list-stat-value">{{ rejected_count|default:0 }}</div>
      </div>
    </div>
  </div>
{% endblock list_stats_content %}

{% block list_filters_content %}
  <div class="col-md-4">
    <label class="form-label">çŠ¶æ€</label>
    <select name="status" class="form-select">
      <option value="">å…¨éƒ¨çŠ¶æ€</option>
      <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>å¾…å®¡æ‰¹</option>
      <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>å·²æ‰¹å‡†</option>
      <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>å·²æ‹’ç»</option>
    </select>
</div>
{% endblock list_filters_content %}

{% block list_table_headers %}
  <th>è®¡åˆ’ç¼–å·</th>
  <th>è®¡åˆ’åç§°</th>
  <th>ç”³è¯·äºº</th>
  <th>ç”³è¯·æ—¶é—´</th>
  <th>çŠ¶æ€</th>
  <th>æ“ä½œ</th>
{% endblock list_table_headers %}

{% block list_table_rows %}
        {% for adjustment in page_obj %}
  <tr>
    <td>
      <code>{% if adjustment.plan %}{{ adjustment.plan.plan_number|default:"-" }}{% else %}-{% endif %}</code>
    </td>
    <td>
      {% if adjustment.plan %}
        <a href="{% url 'plan_pages:plan_detail' adjustment.plan.id %}" class="text-dark text-decoration-none fw-medium">
          {{ adjustment.plan.name|default:"-" }}
        </a>
      {% else %}
        <span style="color: #999999;">è®¡åˆ’å·²åˆ é™¤</span>
      {% endif %}
    </td>
    <td>
      {% if adjustment.created_by %}
        {{ adjustment.created_by.get_full_name|default:adjustment.created_by.username }}
      {% else %}
        <span style="color: #999999;">-</span>
      {% endif %}
    </td>
    <td>{{ adjustment.created_time|date:"Y-m-d H:i" }}</td>
    <td>
            <span class="list-badge list-badge-{{ adjustment.status }}">
              {{ adjustment.get_status_display }}
            </span>
          </td>
    <td>
            {% if adjustment.status == 'pending' and can_approve %}
        <a href="{% url 'plan_pages:plan_adjustment_approve' adjustment.id %}" class="btn btn-sm btn-primary" style="margin-right: 8px;">å®¡æ‰¹</a>
      {% endif %}
      {% if adjustment.plan %}
        <a href="{% url 'plan_pages:plan_detail' adjustment.plan.id %}" class="btn btn-sm btn-secondary">æŸ¥çœ‹è®¡åˆ’</a>
      {% else %}
        <span style="color: #999999; font-size: 12px;">è®¡åˆ’å·²åˆ é™¤</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
    <td colspan="6" class="list-empty-state">
      <div class="list-empty-state-icon">ğŸ“‹</div>
      <div class="list-empty-state-text">æš‚æ— è°ƒæ•´ç”³è¯·</div>
      <div class="list-empty-state-hint">è¯·å…ˆåˆ›å»ºè®¡åˆ’è°ƒæ•´ç”³è¯·</div>
    </td>
        </tr>
        {% endfor %}
{% endblock list_table_rows %}
