{% extends "shared/list_page_base.html" %}

{% block module_styles %}
<style>
  /* 计划列表页移动端优化 */
  @media (max-width: 768px) {
    .list-page-filter-row .col-md-3 {
      flex: 0 0 100%;
      max-width: 100%;
      margin-bottom: 12px;
    }

    .list-page-actions-bar {
      flex-direction: column;
      align-items: stretch;
      gap: 8px;
    }

    .list-page-action-buttons {
      width: 100%;
      flex-direction: column;
    }

    .list-page-action-buttons .btn {
      width: 100%;
      margin-bottom: 8px;
    }

    .table-responsive {
      -webkit-overflow-scrolling: touch;
    }

    .table th,
    .table td {
      padding: 8px 4px;
      font-size: 13px;
      white-space: nowrap;
    }

    .table th:nth-child(3),
    .table td:nth-child(3),
    .table th:nth-child(4),
    .table td:nth-child(4) {
      display: none;
    }

    .btn-group-sm .btn {
      padding: 4px 8px;
      font-size: 12px;
    }

    .list-stat-card {
      margin-bottom: 12px;
    }
  }

  @media (max-width: 576px) {
    .table th,
    .table td {
      padding: 6px 3px;
      font-size: 12px;
    }

    .table th:nth-child(5),
    .table td:nth-child(5),
    .table th:nth-child(7),
    .table td:nth-child(7) {
      display: none;
    }

    .list-stat-value {
      font-size: 20px;
    }

    .list-stat-label {
      font-size: 12px;
    }
  }
</style>
{% endblock %}
{% load static %}


{% block page_title %}计划列表{% endblock page_title %}
{% block page_subtitle %}查看和管理所有计划{% endblock page_subtitle %}





{% block list_stats_content %}
<div class="row g-3">
    <div class="col-md-2">
      <div class="list-stat-card">
        <div class="list-stat-label">计划总数</div>
        <div class="list-stat-value">{{ total_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="list-stat-card">
        <div class="list-stat-label">草稿</div>
        <div class="list-stat-value">{{ draft_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="list-stat-card">
        <div class="list-stat-label">执行中</div>
        <div class="list-stat-value">{{ in_progress_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="list-stat-card">
        <div class="list-stat-label">已完成</div>
        <div class="list-stat-value">{{ completed_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="list-stat-card">
        <div class="list-stat-label">已取消</div>
        <div class="list-stat-value">{{ cancelled_count|default:0 }}</div>
      </div>
    </div>
</div>
{% endblock list_stats_content %}
{% block list_filters_content %}
  <div class="col-md-3">
    <label class="form-label">状态</label>
    <select name="status" class="form-select">
        <option value="">全部状态</option>
        {% for value, label in status_options %}
        <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">计划类型</label>
    <select name="plan_type" class="form-select">
        <option value="">全部类型</option>
        <option value="personal" {% if plan_type_filter == 'personal' %}selected{% endif %}>个人计划</option>
        <option value="department" {% if plan_type_filter == 'department' %}selected{% endif %}>部门计划</option>
        <option value="company" {% if plan_type_filter == 'company' %}selected{% endif %}>公司计划</option>
        <option value="project" {% if plan_type_filter == 'project' %}selected{% endif %}>项目计划</option>
      </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">计划周期</label>
    <select name="plan_period" class="form-select">
        <option value="">全部周期</option>
        <option value="daily" {% if plan_period_filter == 'daily' %}selected{% endif %}>日计划</option>
        <option value="weekly" {% if plan_period_filter == 'weekly' %}selected{% endif %}>周计划</option>
        <option value="monthly" {% if plan_period_filter == 'monthly' %}selected{% endif %}>月计划</option>
        <option value="quarterly" {% if plan_period_filter == 'quarterly' %}selected{% endif %}>季度计划</option>
        <option value="yearly" {% if plan_period_filter == 'yearly' %}selected{% endif %}>年计划</option>
      </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">负责人</label>
    <select name="responsible_person" class="form-select">
        <option value="">全部负责人</option>
        {% for u in responsible_options %}
        <option value="{{ u.id }}" {% if responsible_filter|stringformat:"s" == u.id|stringformat:"s" %}selected{% endif %}>
          {{ u.get_full_name|default:u.username }}
        </option>
        {% endfor %}
      </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">关联目标</label>
    <select name="related_goal" class="form-select">
        <option value="">全部目标</option>
        {% for goal in all_goals %}
        <option value="{{ goal.id }}" {% if related_goal_filter|stringformat:"s" == goal.id|stringformat:"s" %}selected{% endif %}>
          {{ goal.name|truncatewords:5 }}
        </option>
        {% endfor %}
      </select>
  </div>
{% endblock list_filters_content %}
{% block list_table_headers %}
<th>计划编号</th>
        <th>计划名称</th>
        <th>计划类型</th>
        <th>计划周期</th>
        <th>关联目标</th>
        <th>负责人</th>
        <th>时间范围</th>
        <th>进度</th>
        <th>状态</th>
        <th>操作</th>
{% endblock list_table_headers %}
{% block list_table_rows %}
{% for plan in page_obj %}
      <tr>
        <td><code>{{ plan.plan_number }}</code></td>
        <td>
          <a href="{% url 'plan_pages:plan_detail' plan.id %}" class="text-dark text-decoration-none fw-medium">
            {{ plan.name }}
          </a>
        </td>
        <td>{{ plan.get_level_display }}</td>
        <td>{{ plan.get_plan_period_display }}</td>
        <td>
          {% if plan.related_goal %}
          <a href="{% url 'plan_pages:strategic_goal_detail' plan.related_goal.id %}" class="text-dark text-decoration-none">
            {{ plan.related_goal.name|truncatewords:5 }}
          </a>
          {% else %}
          <span style="color: #999999;">-</span>
          {% endif %}
        </td>
        <td>{{ plan.responsible_person.get_full_name|default:plan.responsible_person.username }}</td>
        <td>
          <div style="font-size: 12px; color: #666666;">
            {{ plan.start_time|date:"Y-m-d" }} ~ {{ plan.end_time|date:"Y-m-d" }}
          </div>
        </td>
        <td>
          <span>{{ plan.progress }}%</span>
        </td>
        <td>
          {% with s=plan.status %}
          <span class="badge bg-secondary">
            {{ plan.get_status_display|default:plan.status }}
          </span>
          {% endwith %}
        </td>
        <td>
          <div class="btn-group btn-group-sm">
            <a href="{% url 'plan_pages:plan_detail' plan.id %}" class="btn btn-sm" title="查看">查看</a>
            {% if plan.can_edit %}
            <a href="{% url 'plan_pages:plan_edit' plan.id %}" class="btn btn-sm" title="编辑">编辑</a>
            {% endif %}
            {% if plan.can_delete %}
            <a href="{% url 'plan_pages:plan_delete' plan.id %}" class="btn btn-sm" title="删除" >删除</a>
            {% endif %}
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="10" class="list-empty-state">
          <div class="list-empty-state-text">暂无计划数据</div>
          <div class="list-empty-state-hint">请创建第一个计划开始使用</div>
        </td>
      </tr>
      {% endfor %}
{% endblock list_table_rows %}