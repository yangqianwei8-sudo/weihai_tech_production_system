{% extends "shared/list_page_base.html" %}
{% load static %}

{% block page_title %}ç›®æ ‡åˆ†è§£åˆ—è¡¨{% endblock page_title %}
{% block page_subtitle %}é€‰æ‹©è¦åˆ†è§£çš„ç›®æ ‡{% endblock page_subtitle %}

{% block module_styles %}
  {{ block.super }}
  <style>
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
    }
    .status-draft { background: #e9ecef; color: #495057; }
    .status-published { background: #d1e7dd; color: #0f5132; }
    .status-in_progress { background: #fff3cd; color: #856404; }
    .status-completed { background: #d1e7dd; color: #0f5132; }
    .status-cancelled { background: #f8d7da; color: #842029; }
  </style>
{% endblock %}

{% block list_stats_content %}
  <div class="row g-3">
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å¯åˆ†è§£ç›®æ ‡æ€»æ•°</div>
        <div class="list-stat-value">{{ total_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å·²å‘å¸ƒ</div>
        <div class="list-stat-value">{{ published_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">æ‰§è¡Œä¸­</div>
        <div class="list-stat-value">{{ in_progress_count|default:0 }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="list-stat-card">
        <div class="list-stat-label">å·²å®Œæˆ</div>
        <div class="list-stat-value">{{ completed_count|default:0 }}</div>
      </div>
    </div>
  </div>
{% endblock list_stats_content %}

{% block list_filters_content %}
  <div class="col-md-3">
    <label class="form-label">æœç´¢</label>
    <input type="text" name="search" class="form-control" value="{{ search }}" placeholder="ç›®æ ‡ç¼–å·ã€åç§°ã€è´Ÿè´£äºº">
  </div>
  <div class="col-md-2">
    <label class="form-label">çŠ¶æ€</label>
    <select name="status" class="form-select">
      <option value="">å…¨éƒ¨çŠ¶æ€</option>
      {% for value, label in status_options %}
      <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">ç›®æ ‡å±‚çº§</label>
    <select name="level" class="form-select">
      <option value="">å…¨éƒ¨å±‚çº§</option>
      {% for value, label in level_choices %}
      <option value="{{ value }}" {% if level_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">ç›®æ ‡ç±»å‹</label>
    <select name="goal_type" class="form-select">
      <option value="">å…¨éƒ¨ç±»å‹</option>
      {% for value, label in goal_type_choices %}
      <option value="{{ value }}" {% if goal_type_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">ç›®æ ‡å‘¨æœŸ</label>
    <select name="goal_period" class="form-select">
      <option value="">å…¨éƒ¨å‘¨æœŸ</option>
      {% for value, label in goal_period_choices %}
      <option value="{{ value }}" {% if goal_period_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">è´Ÿè´£äºº</label>
    <select name="responsible" class="form-select">
      <option value="">å…¨éƒ¨è´Ÿè´£äºº</option>
      {% for u in all_users %}
      <option value="{{ u.id }}" {% if responsible_filter|stringformat:"s" == u.id|stringformat:"s" %}selected{% endif %}>
        {{ u.get_full_name|default:u.username }}
      </option>
      {% endfor %}
    </select>
  </div>
{% endblock list_filters_content %}

{% block list_table_headers %}
  <th>ç›®æ ‡ç¼–å·</th>
  <th>ç›®æ ‡åç§°</th>
  <th>ç›®æ ‡å±‚çº§</th>
  <th>ç›®æ ‡ç±»å‹</th>
  <th>ç›®æ ‡å‘¨æœŸ</th>
  <th>è´Ÿè´£äºº</th>
  <th>æ—¶é—´èŒƒå›´</th>
  <th>çŠ¶æ€</th>
  <th>æ“ä½œ</th>
{% endblock list_table_headers %}

{% block list_table_rows %}
  {% for goal in page_obj %}
  <tr>
    <td><code>{{ goal.goal_number }}</code></td>
    <td>
      <a href="{% url 'plan_pages:strategic_goal_detail' goal.id %}" class="text-dark text-decoration-none fw-medium">
        {{ goal.name }}
      </a>
    </td>
    <td>{{ goal.get_level_display }}</td>
    <td>{{ goal.get_goal_type_display }}</td>
    <td>{{ goal.get_goal_period_display }}</td>
    <td>{{ goal.responsible_person.get_full_name|default:goal.responsible_person.username }}</td>
    <td>
      <div style="font-size: 12px; color: #666666;">
        {% if goal.start_date and goal.end_date %}
        {{ goal.start_date|date:"Y-m-d" }} ~ {{ goal.end_date|date:"Y-m-d" }}
        {% else %}
        <span style="color: #999999;">-</span>
        {% endif %}
      </div>
    </td>
    <td>
      <span class="status-badge status-{{ goal.status }}">
        {{ goal.get_status_display }}
      </span>
    </td>
    <td>
      <div class="btn-group btn-group-sm">
        <a href="{% url 'plan_pages:strategic_goal_decompose' goal.id %}" class="btn btn-sm" title="å¼€å§‹åˆ†è§£">åˆ†è§£</a>
      </div>
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="9" class="list-empty-state">
      <div class="list-empty-state-icon">ğŸ¯</div>
      <div class="list-empty-state-text">æš‚æ— å¯åˆ†è§£çš„ç›®æ ‡</div>
      <div class="list-empty-state-hint">è¯·å…ˆåˆ›å»ºç›®æ ‡æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</div>
    </td>
  </tr>
  {% endfor %}
{% endblock list_table_rows %}
