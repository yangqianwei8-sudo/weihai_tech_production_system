{% extends "archive_management/base.html" %}
{% load static %}

{% block title %}æ¡£æ¡ˆæŸ¥è¯¢ - æ¡£æ¡ˆç®¡ç†{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">æ¡£æ¡ˆæŸ¥è¯¢</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h3>ğŸ” æ¡£æ¡ˆæŸ¥è¯¢</h3>
            <div>
                <a href="{% url 'archive_management:project_archive_list' %}" class="btn btn-light btn-sm">è¿”å›é¦–é¡µ</a>
            </div>
        </div>
        <div class="card-body">
            <!-- æœç´¢è¡¨å• -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <form method="get" class="d-flex gap-2">
                        <select name="type" class="form-select" style="max-width: 150px;">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="project" {% if archive_type == 'project' %}selected{% endif %}>é¡¹ç›®æ¡£æ¡ˆ</option>
                            <option value="administrative" {% if archive_type == 'administrative' %}selected{% endif %}>è¡Œæ”¿æ¡£æ¡ˆ</option>
                        </select>
                        <input type="text" name="search" class="form-control" placeholder="æœç´¢æ¡£æ¡ˆç¼–å·ã€åç§°ã€é¡¹ç›®åç§°..." value="{{ search }}" style="max-width: 400px;">
                        <button type="submit" class="btn btn-primary">æœç´¢</button>
                        <a href="{% url 'archive_management:archive_search' %}" class="btn btn-secondary">é‡ç½®</a>
                    </form>
                </div>
            </div>

            <!-- é¡¹ç›®æ¡£æ¡ˆç»“æœ -->
            {% if archive_type == 'project' or not archive_type %}
            {% if project_documents %}
            <div class="mb-4">
                <h5 class="mb-3">é¡¹ç›®æ¡£æ¡ˆæ–‡æ¡£</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>æ–‡æ¡£ç¼–å·</th>
                                <th>æ–‡æ¡£åç§°</th>
                                <th>é¡¹ç›®</th>
                                <th>æ–‡æ¡£ç±»å‹</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for doc in project_documents %}
                            <tr>
                                <td>{{ doc.document_number }}</td>
                                <td>{{ doc.document_name }}</td>
                                <td>{{ doc.project.project_name|default:"-" }}</td>
                                <td>{{ doc.get_document_type_display }}</td>
                                <td>
                                    <span class="status-badge status-{{ doc.status }}">
                                        {{ doc.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'archive_management:project_document_detail' doc.pk %}" class="btn btn-sm btn-outline-primary">æŸ¥çœ‹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            {% endif %}

            <!-- è¡Œæ”¿æ¡£æ¡ˆç»“æœ -->
            {% if archive_type == 'administrative' or not archive_type %}
            {% if administrative_archives %}
            <div class="mb-4">
                <h5 class="mb-3">è¡Œæ”¿æ¡£æ¡ˆ</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>æ¡£æ¡ˆç¼–å·</th>
                                <th>æ¡£æ¡ˆåç§°</th>
                                <th>åˆ†ç±»</th>
                                <th>å½’æ¡£æ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for archive in administrative_archives %}
                            <tr>
                                <td>{{ archive.archive_number }}</td>
                                <td>{{ archive.archive_name }}</td>
                                <td>{{ archive.category.name|default:"-" }}</td>
                                <td>{{ archive.archive_date|date:"Y-m-d" }}</td>
                                <td>
                                    <span class="status-badge status-{{ archive.status }}">
                                        {{ archive.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'archive_management:administrative_archive_detail' archive.pk %}" class="btn btn-sm btn-outline-primary">æŸ¥çœ‹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            {% endif %}

            <!-- æ— ç»“æœæç¤º -->
            {% if not project_documents and not administrative_archives %}
            <div class="text-center text-muted py-5">
                <p>æš‚æ— æŸ¥è¯¢ç»“æœ</p>
                <p class="small">è¯·å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

