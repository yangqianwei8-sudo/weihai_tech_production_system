BEGIN;
--
-- Create model BiddingQuotation
--
CREATE TABLE "business_bidding_quotation" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "bidding_number" varchar(100) NOT NULL, "bidding_date" date NOT NULL, "submission_deadline" date NOT NULL, "status" varchar(20) NOT NULL, "tender_requirements" text NOT NULL, "technical_proposal" jsonb NOT NULL, "commercial_proposal" jsonb NOT NULL, "personnel_certificates" jsonb NOT NULL, "company_certificates" jsonb NOT NULL, "bidding_documents" jsonb NOT NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model BusinessNegotiation
--
CREATE TABLE "business_negotiation" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "negotiation_date" date NOT NULL, "negotiation_type" varchar(20) NOT NULL, "participants" varchar(500) NOT NULL, "content" text NOT NULL, "client_feedback" text NOT NULL, "next_plan" text NOT NULL, "discussed_amount" numeric(15, 2) NULL, "payment_terms" text NOT NULL, "contract_terms" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model ContactCooperation
--
CREATE TABLE "customer_contact_cooperation" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "cooperation_type" varchar(20) NOT NULL, "cooperation_start_date" date NOT NULL, "cooperation_end_date" date NULL, "cooperation_status" varchar(20) NOT NULL, "cooperation_amount" numeric(15, 2) NULL, "cooperation_description" text NOT NULL, "satisfaction_score" integer NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model ContactEducation
--
CREATE TABLE "customer_contact_education" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "degree" varchar(20) NOT NULL, "school_name" varchar(200) NOT NULL, "major" varchar(100) NOT NULL, "enrollment_date" date NOT NULL, "graduation_date" date NOT NULL, "is_full_time" boolean NOT NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model ContactJobChange
--
CREATE TABLE "customer_contact_job_change" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "change_type" varchar(20) NOT NULL, "from_company" varchar(200) NOT NULL, "to_company" varchar(200) NOT NULL, "from_position" varchar(100) NOT NULL, "to_position" varchar(100) NOT NULL, "from_department" varchar(100) NOT NULL, "to_department" varchar(100) NOT NULL, "change_date" date NOT NULL, "change_reason" varchar(500) NOT NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model ContactTracking
--
CREATE TABLE "customer_contact_tracking" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "tracking_type" varchar(20) NOT NULL, "tracking_date" timestamp with time zone NOT NULL, "tracking_content" text NOT NULL, "tracking_result" varchar(20) NOT NULL, "next_tracking_date" date NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model ContactWorkExperience
--
CREATE TABLE "customer_contact_work_experience" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "company_name" varchar(200) NOT NULL, "position" varchar(100) NOT NULL, "department" varchar(100) NOT NULL, "start_date" date NOT NULL, "end_date" date NULL, "office_address" varchar(500) NOT NULL, "job_description" text NOT NULL, "notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Create model CustomerRelationshipUpgrade
--
CREATE TABLE "customer_relationship_upgrade" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "from_level" varchar(30) NOT NULL, "to_level" varchar(30) NOT NULL, "upgrade_reason" text NOT NULL, "approval_status" varchar(20) NOT NULL, "created_time" timestamp with time zone NOT NULL, "approved_time" timestamp with time zone NULL);
--
-- Create model OpportunityFiling
--
CREATE TABLE "business_opportunity_filing" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "filing_date" date NOT NULL, "filing_type" varchar(20) NOT NULL, "filing_number" varchar(100) NOT NULL, "filing_content" text NOT NULL, "filing_purpose" text NOT NULL, "filing_notes" text NOT NULL, "created_time" timestamp with time zone NOT NULL, "updated_time" timestamp with time zone NOT NULL);
--
-- Remove field approved_by from businesscontract
--
SET CONSTRAINTS "business_contract_approved_by_id_0fb9d53b_fk_system_user_id" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_approved_by_id_0fb9d53b_fk_system_user_id";
ALTER TABLE "business_contract" DROP COLUMN "approved_by_id" CASCADE;
--
-- Remove field client from businesscontract
--
SET CONSTRAINTS "business_contract_client_id_a1c9537a_fk_customer_client_id" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_client_id_a1c9537a_fk_customer_client_id";
ALTER TABLE "business_contract" DROP COLUMN "client_id" CASCADE;
--
-- Remove field created_by from businesscontract
--
SET CONSTRAINTS "business_contract_created_by_id_c74b40d5_fk_system_user_id" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_created_by_id_c74b40d5_fk_system_user_id";
ALTER TABLE "business_contract" DROP COLUMN "created_by_id" CASCADE;
--
-- Remove field parent_contract from businesscontract
--
SET CONSTRAINTS "business_contract_parent_contract_id_92977349_fk_business_" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_parent_contract_id_92977349_fk_business_";
ALTER TABLE "business_contract" DROP COLUMN "parent_contract_id" CASCADE;
--
-- Remove field project from businesscontract
--
SET CONSTRAINTS "business_contract_project_id_7961d5e5_fk_project_c" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_project_id_7961d5e5_fk_project_c";
ALTER TABLE "business_contract" DROP COLUMN "project_id" CASCADE;
--
-- Remove field signed_by from businesscontract
--
SET CONSTRAINTS "business_contract_signed_by_id_8e4a00fc_fk_system_user_id" IMMEDIATE; ALTER TABLE "business_contract" DROP CONSTRAINT "business_contract_signed_by_id_8e4a00fc_fk_system_user_id";
ALTER TABLE "business_contract" DROP COLUMN "signed_by_id" CASCADE;
--
-- Remove field contract from businesspaymentplan
--
SET CONSTRAINTS "business_payment_pla_contract_id_c2d90ea0_fk_business_" IMMEDIATE; ALTER TABLE "business_payment_plan" DROP CONSTRAINT "business_payment_pla_contract_id_c2d90ea0_fk_business_";
ALTER TABLE "business_payment_plan" DROP COLUMN "contract_id" CASCADE;
--
-- Remove field converted_client from customerlead
--
SET CONSTRAINTS "customer_lead_converted_client_id_1061422c_fk" IMMEDIATE; ALTER TABLE "customer_lead" DROP CONSTRAINT "customer_lead_converted_client_id_1061422c_fk";
ALTER TABLE "customer_lead" DROP COLUMN "converted_client_id" CASCADE;
--
-- Remove field created_by from customerlead
--
SET CONSTRAINTS "customer_lead_created_by_id_94b40c50_fk" IMMEDIATE; ALTER TABLE "customer_lead" DROP CONSTRAINT "customer_lead_created_by_id_94b40c50_fk";
ALTER TABLE "customer_lead" DROP COLUMN "created_by_id" CASCADE;
--
-- Remove field responsible_user from customerlead
--
SET CONSTRAINTS "customer_lead_responsible_user_id_fb0f5890_fk" IMMEDIATE; ALTER TABLE "customer_lead" DROP CONSTRAINT "customer_lead_responsible_user_id_fb0f5890_fk";
ALTER TABLE "customer_lead" DROP COLUMN "responsible_user_id" CASCADE;
--
-- Change Meta options on clientcontact
--
-- (no-op)
--
-- Change Meta options on customerrelationship
--
-- (no-op)
--
-- Remove index customer_re_client__b399b1_idx from customerrelationship
--
DROP INDEX IF EXISTS "customer_re_client__b399b1_idx";
--
-- Remove field location from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "location" CASCADE;
--
-- Remove field next_action from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "next_action" CASCADE;
--
-- Remove field next_action_date from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "next_action_date" CASCADE;
--
-- Remove field participants from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "participants" CASCADE;
--
-- Remove field related_opportunity from customerrelationship
--
SET CONSTRAINTS "customer_relationshi_related_opportunity__674a21d6_fk" IMMEDIATE; ALTER TABLE "customer_relationship" DROP CONSTRAINT "customer_relationshi_related_opportunity__674a21d6_fk";
ALTER TABLE "customer_relationship" DROP COLUMN "related_opportunity_id" CASCADE;
--
-- Remove field relationship_date from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "relationship_date" CASCADE;
--
-- Remove field relationship_type from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "relationship_type" CASCADE;
--
-- Remove field title from customerrelationship
--
ALTER TABLE "customer_relationship" DROP COLUMN "title" CASCADE;
--
-- Add field public_sea_entry_time to client
--
ALTER TABLE "customer_client" ADD COLUMN "public_sea_entry_time" timestamp with time zone NULL;
--
-- Add field public_sea_reason to client
--
ALTER TABLE "customer_client" ADD COLUMN "public_sea_reason" varchar(20) DEFAULT '' NOT NULL;
ALTER TABLE "customer_client" ALTER COLUMN "public_sea_reason" DROP DEFAULT;
--
-- Add field responsible_user to client
--
ALTER TABLE "customer_client" ADD COLUMN "responsible_user_id" bigint NULL CONSTRAINT "customer_client_responsible_user_id_9bb10f4a_fk_system_user_id" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_client_responsible_user_id_9bb10f4a_fk_system_user_id" IMMEDIATE;
--
-- Add field best_contact_time to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "best_contact_time" varchar(200) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "best_contact_time" DROP DEFAULT;
--
-- Add field birthday to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "birthday" date NULL;
--
-- Add field birthplace to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "birthplace" varchar(100) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "birthplace" DROP DEFAULT;
--
-- Add field contact_frequency to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "contact_frequency" varchar(20) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "contact_frequency" DROP DEFAULT;
--
-- Add field created_by to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "created_by_id" bigint NULL CONSTRAINT "customer_contact_created_by_id_e8ce907a_fk_system_user_id" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_created_by_id_e8ce907a_fk_system_user_id" IMMEDIATE;
--
-- Add field decision_influence to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "decision_influence" varchar(10) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "decision_influence" DROP DEFAULT;
--
-- Add field first_contact_time to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "first_contact_time" timestamp with time zone NULL;
--
-- Add field focus_areas to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "focus_areas" text DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "focus_areas" DROP DEFAULT;
--
-- Add field gender to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "gender" varchar(10) DEFAULT 'unknown' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "gender" DROP DEFAULT;
--
-- Add field home_address to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "home_address" varchar(500) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "home_address" DROP DEFAULT;
--
-- Add field interests to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "interests" text DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "interests" DROP DEFAULT;
--
-- Add field join_date to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "join_date" date NULL;
--
-- Add field last_contact_time to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "last_contact_time" timestamp with time zone NULL;
--
-- Add field office_address to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "office_address" varchar(500) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "office_address" DROP DEFAULT;
--
-- Add field position_level to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "position_level" varchar(20) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "position_level" DROP DEFAULT;
--
-- Add field preferred_contact_methods to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "preferred_contact_methods" jsonb DEFAULT '[]' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "preferred_contact_methods" DROP DEFAULT;
--
-- Add field relationship_level to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "relationship_level" varchar(30) DEFAULT 'requirement_communication' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "relationship_level" DROP DEFAULT;
--
-- Add field relationship_score to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "relationship_score" integer DEFAULT 0 NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "relationship_score" DROP DEFAULT;
--
-- Add field resume_file to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "resume_file" varchar(100) NULL;
--
-- Add field resume_source to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "resume_source" varchar(20) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "resume_source" DROP DEFAULT;
--
-- Add field resume_upload_time to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "resume_upload_time" timestamp with time zone NULL;
--
-- Add field role to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "role" varchar(20) DEFAULT '' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "role" DROP DEFAULT;
--
-- Add field tags to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "tags" jsonb DEFAULT '[]' NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "tags" DROP DEFAULT;
--
-- Add field updated_time to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "updated_time" timestamp with time zone DEFAULT '2025-12-01T06:32:38.774547+00:00'::timestamptz NOT NULL;
ALTER TABLE "customer_contact" ALTER COLUMN "updated_time" DROP DEFAULT;
--
-- Add field work_years to clientcontact
--
ALTER TABLE "customer_contact" ADD COLUMN "work_years" integer NULL;
--
-- Add field followup_method to customerrelationship
--
ALTER TABLE "customer_relationship" ADD COLUMN "followup_method" varchar(20) DEFAULT 'phone' NOT NULL;
ALTER TABLE "customer_relationship" ALTER COLUMN "followup_method" DROP DEFAULT;
--
-- Add field followup_person to customerrelationship
--
ALTER TABLE "customer_relationship" ADD COLUMN "followup_person_id" bigint NULL CONSTRAINT "customer_relationshi_followup_person_id_4311eff6_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_relationshi_followup_person_id_4311eff6_fk_system_us" IMMEDIATE;
--
-- Add field followup_time to customerrelationship
--
ALTER TABLE "customer_relationship" ADD COLUMN "followup_time" timestamp with time zone DEFAULT '2025-12-01T06:32:39.092044+00:00'::timestamptz NOT NULL;
ALTER TABLE "customer_relationship" ALTER COLUMN "followup_time" DROP DEFAULT;
--
-- Add field record_type to customerrelationship
--
ALTER TABLE "customer_relationship" ADD COLUMN "record_type" varchar(20) DEFAULT 'followup' NOT NULL;
ALTER TABLE "customer_relationship" ALTER COLUMN "record_type" DROP DEFAULT;
--
-- Add field related_contacts to customerrelationship
--
CREATE TABLE "customer_relationship_related_contacts" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "customerrelationship_id" bigint NOT NULL, "clientcontact_id" bigint NOT NULL);
--
-- Add field relationship_level to customerrelationship
--
ALTER TABLE "customer_relationship" ADD COLUMN "relationship_level" varchar(30) DEFAULT 'requirement_communication' NOT NULL;
ALTER TABLE "customer_relationship" ALTER COLUMN "relationship_level" DROP DEFAULT;
--
-- Alter field created_by on client
--
-- (no-op)
--
-- Alter field email on clientcontact
--
ALTER TABLE "customer_contact" ALTER COLUMN "email" TYPE varchar(254);
--
-- Alter field position on clientcontact
--
-- (no-op)
--
-- Alter field telephone on clientcontact
--
-- (no-op)
--
-- Alter field wechat on clientcontact
--
ALTER TABLE "customer_contact" ALTER COLUMN "wechat" TYPE varchar(200);
--
-- Alter field client on clientproject
--
-- (no-op)
--
-- Alter field contract_amount on clientproject
--
-- (no-op)
--
-- Alter field end_date on clientproject
--
ALTER TABLE "customer_client_project" ALTER COLUMN "end_date" DROP NOT NULL;
--
-- Alter field service_type on clientproject
--
-- (no-op)
--
-- Alter field start_date on clientproject
--
ALTER TABLE "customer_client_project" ALTER COLUMN "start_date" DROP NOT NULL;
--
-- Alter field status on clientproject
--
-- (no-op)
--
-- Alter field contract on contractapproval
--
SET CONSTRAINTS "business_contract_ap_contract_id_ba9f64f9_fk_business_" IMMEDIATE; ALTER TABLE "business_contract_approval" DROP CONSTRAINT "business_contract_ap_contract_id_ba9f64f9_fk_business_";
ALTER TABLE "business_contract_approval" ADD CONSTRAINT "business_contract_ap_contract_id_ba9f64f9_fk_business_" FOREIGN KEY ("contract_id") REFERENCES "business_contract" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field contract on contractchange
--
SET CONSTRAINTS "business_contract_ch_contract_id_b8cd5b49_fk_business_" IMMEDIATE; ALTER TABLE "business_contract_change" DROP CONSTRAINT "business_contract_ch_contract_id_b8cd5b49_fk_business_";
ALTER TABLE "business_contract_change" ADD CONSTRAINT "business_contract_ch_contract_id_b8cd5b49_fk_business_" FOREIGN KEY ("contract_id") REFERENCES "business_contract" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field contract on contractfile
--
SET CONSTRAINTS "business_contract_fi_contract_id_2acb35aa_fk_business_" IMMEDIATE; ALTER TABLE "business_contract_file" DROP CONSTRAINT "business_contract_fi_contract_id_2acb35aa_fk_business_";
ALTER TABLE "business_contract_file" ADD CONSTRAINT "business_contract_fi_contract_id_2acb35aa_fk_business_" FOREIGN KEY ("contract_id") REFERENCES "business_contract" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field contract on contractstatuslog
--
SET CONSTRAINTS "business_contract_st_contract_id_94a7af85_fk_business_" IMMEDIATE; ALTER TABLE "business_contract_status_log" DROP CONSTRAINT "business_contract_st_contract_id_94a7af85_fk_business_";
ALTER TABLE "business_contract_status_log" ADD CONSTRAINT "business_contract_st_contract_id_94a7af85_fk_business_" FOREIGN KEY ("contract_id") REFERENCES "business_contract" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter field from_status on contractstatuslog
--
-- (no-op)
--
-- Alter field to_status on contractstatuslog
--
-- (no-op)
--
-- Alter field content on customerrelationship
--
-- (no-op)
--
-- Alter field created_by on customerrelationship
--
SET CONSTRAINTS "customer_relationship_created_by_id_8cb0b54b_fk" IMMEDIATE; ALTER TABLE "customer_relationship" DROP CONSTRAINT "customer_relationship_created_by_id_8cb0b54b_fk";
ALTER TABLE "customer_relationship" ALTER COLUMN "created_by_id" DROP NOT NULL;
ALTER TABLE "customer_relationship" ADD CONSTRAINT "customer_relationship_created_by_id_8cb0b54b_fk_system_user_id" FOREIGN KEY ("created_by_id") REFERENCES "system_user" ("id") DEFERRABLE INITIALLY DEFERRED;
--
-- Alter unique_together for clientproject (1 constraint(s))
--
ALTER TABLE "customer_client_project" ADD CONSTRAINT "customer_client_project_client_id_project_id_17a97c89_uniq" UNIQUE ("client_id", "project_id");
--
-- Create index customer_cl_name_fa39ad_idx on field(s) name of model client
--
CREATE INDEX "customer_cl_name_fa39ad_idx" ON "customer_client" ("name");
--
-- Create index customer_cl_unified_ef90c3_idx on field(s) unified_credit_code of model client
--
CREATE INDEX "customer_cl_unified_ef90c3_idx" ON "customer_client" ("unified_credit_code");
--
-- Create index customer_cl_respons_e74a91_idx on field(s) responsible_user, is_active of model client
--
CREATE INDEX "customer_cl_respons_e74a91_idx" ON "customer_client" ("responsible_user_id", "is_active");
--
-- Create index customer_cl_public__13c229_idx on field(s) public_sea_entry_time of model client
--
CREATE INDEX "customer_cl_public__13c229_idx" ON "customer_client" ("public_sea_entry_time");
--
-- Create index customer_co_client__8428bc_idx on field(s) client, role of model clientcontact
--
CREATE INDEX "customer_co_client__8428bc_idx" ON "customer_contact" ("client_id", "role");
--
-- Create index customer_co_relatio_29ec0d_idx on field(s) relationship_level of model clientcontact
--
CREATE INDEX "customer_co_relatio_29ec0d_idx" ON "customer_contact" ("relationship_level");
--
-- Create index customer_co_last_co_d731c3_idx on field(s) last_contact_time of model clientcontact
--
CREATE INDEX "customer_co_last_co_d731c3_idx" ON "customer_contact" ("last_contact_time");
--
-- Create index customer_re_client__b7d7b3_idx on field(s) client, followup_time of model customerrelationship
--
CREATE INDEX "customer_re_client__b7d7b3_idx" ON "customer_relationship" ("client_id", "followup_time");
--
-- Create index customer_re_record__fa6ce2_idx on field(s) record_type, followup_time of model customerrelationship
--
CREATE INDEX "customer_re_record__fa6ce2_idx" ON "customer_relationship" ("record_type", "followup_time");
--
-- Delete model BusinessContract
--
DROP TABLE "business_contract" CASCADE;
--
-- Delete model BusinessPaymentPlan
--
DROP TABLE "business_payment_plan" CASCADE;
--
-- Delete model CustomerLead
--
DROP TABLE "customer_lead" CASCADE;
--
-- Add field created_by to opportunityfiling
--
ALTER TABLE "business_opportunity_filing" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "business_opportunity_created_by_id_397c6753_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_opportunity_created_by_id_397c6753_fk_system_us" IMMEDIATE;
--
-- Add field opportunity to opportunityfiling
--
ALTER TABLE "business_opportunity_filing" ADD COLUMN "opportunity_id" bigint NOT NULL CONSTRAINT "business_opportunity_opportunity_id_307552a2_fk_business_" REFERENCES "business_opportunity"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_opportunity_opportunity_id_307552a2_fk_business_" IMMEDIATE;
--
-- Add field approval_instance to customerrelationshipupgrade
--
ALTER TABLE "customer_relationship_upgrade" ADD COLUMN "approval_instance_id" bigint NULL CONSTRAINT "customer_relationshi_approval_instance_id_7ae651a4_fk_workflow_" REFERENCES "workflow_approval_instance"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_relationshi_approval_instance_id_7ae651a4_fk_workflow_" IMMEDIATE;
--
-- Add field client to customerrelationshipupgrade
--
ALTER TABLE "customer_relationship_upgrade" ADD COLUMN "client_id" bigint NOT NULL CONSTRAINT "customer_relationshi_client_id_436be20b_fk_customer_" REFERENCES "customer_client"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_relationshi_client_id_436be20b_fk_customer_" IMMEDIATE;
--
-- Add field created_by to customerrelationshipupgrade
--
ALTER TABLE "customer_relationship_upgrade" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "customer_relationshi_created_by_id_796e6ee9_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_relationshi_created_by_id_796e6ee9_fk_system_us" IMMEDIATE;
--
-- Add field related_contacts to customerrelationshipupgrade
--
CREATE TABLE "customer_relationship_upgrade_related_contacts" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "customerrelationshipupgrade_id" bigint NOT NULL, "clientcontact_id" bigint NOT NULL);
--
-- Add field contact to contactworkexperience
--
ALTER TABLE "customer_contact_work_experience" ADD COLUMN "contact_id" bigint NOT NULL CONSTRAINT "customer_contact_wor_contact_id_55cf5f18_fk_customer_" REFERENCES "customer_contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_wor_contact_id_55cf5f18_fk_customer_" IMMEDIATE;
--
-- Add field contact to contacttracking
--
ALTER TABLE "customer_contact_tracking" ADD COLUMN "contact_id" bigint NOT NULL CONSTRAINT "customer_contact_tra_contact_id_df500eaf_fk_customer_" REFERENCES "customer_contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_tra_contact_id_df500eaf_fk_customer_" IMMEDIATE;
--
-- Add field created_by to contacttracking
--
ALTER TABLE "customer_contact_tracking" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "customer_contact_tra_created_by_id_b0f79321_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_tra_created_by_id_b0f79321_fk_system_us" IMMEDIATE;
--
-- Add field related_opportunity to contacttracking
--
ALTER TABLE "customer_contact_tracking" ADD COLUMN "related_opportunity_id" bigint NULL CONSTRAINT "customer_contact_tra_related_opportunity__7d0b6880_fk_business_" REFERENCES "business_opportunity"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_tra_related_opportunity__7d0b6880_fk_business_" IMMEDIATE;
--
-- Add field related_project to contacttracking
--
ALTER TABLE "customer_contact_tracking" ADD COLUMN "related_project_id" bigint NULL CONSTRAINT "customer_contact_tra_related_project_id_ab694995_fk_productio" REFERENCES "production_management_project"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_tra_related_project_id_ab694995_fk_productio" IMMEDIATE;
--
-- Add field tracking_person to contacttracking
--
ALTER TABLE "customer_contact_tracking" ADD COLUMN "tracking_person_id" bigint NOT NULL CONSTRAINT "customer_contact_tra_tracking_person_id_f59f4c86_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_tra_tracking_person_id_f59f4c86_fk_system_us" IMMEDIATE;
--
-- Add field contact to contactjobchange
--
ALTER TABLE "customer_contact_job_change" ADD COLUMN "contact_id" bigint NOT NULL CONSTRAINT "customer_contact_job_contact_id_28270f08_fk_customer_" REFERENCES "customer_contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_job_contact_id_28270f08_fk_customer_" IMMEDIATE;
--
-- Add field created_by to contactjobchange
--
ALTER TABLE "customer_contact_job_change" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "customer_contact_job_created_by_id_507526b6_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_job_created_by_id_507526b6_fk_system_us" IMMEDIATE;
--
-- Add field related_client to contactjobchange
--
ALTER TABLE "customer_contact_job_change" ADD COLUMN "related_client_id" bigint NULL CONSTRAINT "customer_contact_job_related_client_id_1739403d_fk_customer_" REFERENCES "customer_client"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_job_related_client_id_1739403d_fk_customer_" IMMEDIATE;
--
-- Add field contact to contacteducation
--
ALTER TABLE "customer_contact_education" ADD COLUMN "contact_id" bigint NOT NULL CONSTRAINT "customer_contact_edu_contact_id_b09e1133_fk_customer_" REFERENCES "customer_contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_edu_contact_id_b09e1133_fk_customer_" IMMEDIATE;
--
-- Add field contact to contactcooperation
--
ALTER TABLE "customer_contact_cooperation" ADD COLUMN "contact_id" bigint NOT NULL CONSTRAINT "customer_contact_coo_contact_id_58afa747_fk_customer_" REFERENCES "customer_contact"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_coo_contact_id_58afa747_fk_customer_" IMMEDIATE;
--
-- Add field created_by to contactcooperation
--
ALTER TABLE "customer_contact_cooperation" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "customer_contact_coo_created_by_id_a3d2a273_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_coo_created_by_id_a3d2a273_fk_system_us" IMMEDIATE;
--
-- Add field our_contact_person to contactcooperation
--
ALTER TABLE "customer_contact_cooperation" ADD COLUMN "our_contact_person_id" bigint NULL CONSTRAINT "customer_contact_coo_our_contact_person_i_2c38f12b_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_coo_our_contact_person_i_2c38f12b_fk_system_us" IMMEDIATE;
--
-- Add field project to contactcooperation
--
ALTER TABLE "customer_contact_cooperation" ADD COLUMN "project_id" bigint NULL CONSTRAINT "customer_contact_coo_project_id_cba7b557_fk_productio" REFERENCES "production_management_project"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "customer_contact_coo_project_id_cba7b557_fk_productio" IMMEDIATE;
--
-- Add field created_by to businessnegotiation
--
ALTER TABLE "business_negotiation" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "business_negotiation_created_by_id_2854fd94_fk_system_user_id" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_negotiation_created_by_id_2854fd94_fk_system_user_id" IMMEDIATE;
--
-- Add field opportunity to businessnegotiation
--
ALTER TABLE "business_negotiation" ADD COLUMN "opportunity_id" bigint NOT NULL CONSTRAINT "business_negotiation_opportunity_id_3a6bfabe_fk_business_" REFERENCES "business_opportunity"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_negotiation_opportunity_id_3a6bfabe_fk_business_" IMMEDIATE;
--
-- Add field created_by to biddingquotation
--
ALTER TABLE "business_bidding_quotation" ADD COLUMN "created_by_id" bigint NOT NULL CONSTRAINT "business_bidding_quo_created_by_id_eac203c6_fk_system_us" REFERENCES "system_user"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_bidding_quo_created_by_id_eac203c6_fk_system_us" IMMEDIATE;
--
-- Add field opportunity to biddingquotation
--
ALTER TABLE "business_bidding_quotation" ADD COLUMN "opportunity_id" bigint NOT NULL CONSTRAINT "business_bidding_quo_opportunity_id_854a1a5b_fk_business_" REFERENCES "business_opportunity"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "business_bidding_quo_opportunity_id_854a1a5b_fk_business_" IMMEDIATE;
--
-- Add field similar_projects to biddingquotation
--
CREATE TABLE "business_bidding_quotation_similar_projects" ("id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "biddingquotation_id" bigint NOT NULL, "project_id" bigint NOT NULL);
--
-- Create index customer_re_client__49d942_idx on field(s) client, approval_status of model customerrelationshipupgrade
--
CREATE INDEX "customer_re_client__49d942_idx" ON "customer_relationship_upgrade" ("client_id", "approval_status");
--
-- Create index customer_re_to_leve_85d7a9_idx on field(s) to_level, approval_status of model customerrelationshipupgrade
--
CREATE INDEX "customer_re_to_leve_85d7a9_idx" ON "customer_relationship_upgrade" ("to_level", "approval_status");
--
-- Create index customer_co_company_29ac1f_idx on field(s) company_name, start_date of model contactworkexperience
--
CREATE INDEX "customer_co_company_29ac1f_idx" ON "customer_contact_work_experience" ("company_name", "start_date");
--
-- Create index customer_co_contact_a1d403_idx on field(s) contact, tracking_date of model contacttracking
--
CREATE INDEX "customer_co_contact_a1d403_idx" ON "customer_contact_tracking" ("contact_id", "tracking_date");
--
-- Create index customer_co_next_tr_f7ce11_idx on field(s) next_tracking_date of model contacttracking
--
CREATE INDEX "customer_co_next_tr_f7ce11_idx" ON "customer_contact_tracking" ("next_tracking_date");
CREATE INDEX "customer_client_responsible_user_id_9bb10f4a" ON "customer_client" ("responsible_user_id");
CREATE INDEX "customer_contact_created_by_id_e8ce907a" ON "customer_contact" ("created_by_id");
CREATE INDEX "customer_relationship_followup_person_id_4311eff6" ON "customer_relationship" ("followup_person_id");
ALTER TABLE "customer_relationship_related_contacts" ADD CONSTRAINT "customer_relationship_re_customerrelationship_id__11648d38_uniq" UNIQUE ("customerrelationship_id", "clientcontact_id");
ALTER TABLE "customer_relationship_related_contacts" ADD CONSTRAINT "customer_relationshi_customerrelationship_b22c47ab_fk_customer_" FOREIGN KEY ("customerrelationship_id") REFERENCES "customer_relationship" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "customer_relationship_related_contacts" ADD CONSTRAINT "customer_relationshi_clientcontact_id_55e5b717_fk_customer_" FOREIGN KEY ("clientcontact_id") REFERENCES "customer_contact" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "customer_relationship_rela_customerrelationship_id_b22c47ab" ON "customer_relationship_related_contacts" ("customerrelationship_id");
CREATE INDEX "customer_relationship_rela_clientcontact_id_55e5b717" ON "customer_relationship_related_contacts" ("clientcontact_id");
CREATE INDEX "business_opportunity_filing_created_by_id_397c6753" ON "business_opportunity_filing" ("created_by_id");
CREATE INDEX "business_opportunity_filing_opportunity_id_307552a2" ON "business_opportunity_filing" ("opportunity_id");
CREATE INDEX "customer_relationship_upgrade_approval_instance_id_7ae651a4" ON "customer_relationship_upgrade" ("approval_instance_id");
CREATE INDEX "customer_relationship_upgrade_client_id_436be20b" ON "customer_relationship_upgrade" ("client_id");
CREATE INDEX "customer_relationship_upgrade_created_by_id_796e6ee9" ON "customer_relationship_upgrade" ("created_by_id");
ALTER TABLE "customer_relationship_upgrade_related_contacts" ADD CONSTRAINT "customer_relationship_up_customerrelationshipupgr_940bd929_uniq" UNIQUE ("customerrelationshipupgrade_id", "clientcontact_id");
ALTER TABLE "customer_relationship_upgrade_related_contacts" ADD CONSTRAINT "customer_relationshi_customerrelationship_9abe44e2_fk_customer_" FOREIGN KEY ("customerrelationshipupgrade_id") REFERENCES "customer_relationship_upgrade" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "customer_relationship_upgrade_related_contacts" ADD CONSTRAINT "customer_relationshi_clientcontact_id_86e675c5_fk_customer_" FOREIGN KEY ("clientcontact_id") REFERENCES "customer_contact" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "customer_relationship_upgr_customerrelationshipupgrad_9abe44e2" ON "customer_relationship_upgrade_related_contacts" ("customerrelationshipupgrade_id");
CREATE INDEX "customer_relationship_upgr_clientcontact_id_86e675c5" ON "customer_relationship_upgrade_related_contacts" ("clientcontact_id");
CREATE INDEX "customer_contact_work_experience_contact_id_55cf5f18" ON "customer_contact_work_experience" ("contact_id");
CREATE INDEX "customer_contact_tracking_contact_id_df500eaf" ON "customer_contact_tracking" ("contact_id");
CREATE INDEX "customer_contact_tracking_created_by_id_b0f79321" ON "customer_contact_tracking" ("created_by_id");
CREATE INDEX "customer_contact_tracking_related_opportunity_id_7d0b6880" ON "customer_contact_tracking" ("related_opportunity_id");
CREATE INDEX "customer_contact_tracking_related_project_id_ab694995" ON "customer_contact_tracking" ("related_project_id");
CREATE INDEX "customer_contact_tracking_tracking_person_id_f59f4c86" ON "customer_contact_tracking" ("tracking_person_id");
CREATE INDEX "customer_contact_job_change_contact_id_28270f08" ON "customer_contact_job_change" ("contact_id");
CREATE INDEX "customer_contact_job_change_created_by_id_507526b6" ON "customer_contact_job_change" ("created_by_id");
CREATE INDEX "customer_contact_job_change_related_client_id_1739403d" ON "customer_contact_job_change" ("related_client_id");
CREATE INDEX "customer_contact_education_contact_id_b09e1133" ON "customer_contact_education" ("contact_id");
CREATE INDEX "customer_contact_cooperation_contact_id_58afa747" ON "customer_contact_cooperation" ("contact_id");
CREATE INDEX "customer_contact_cooperation_created_by_id_a3d2a273" ON "customer_contact_cooperation" ("created_by_id");
CREATE INDEX "customer_contact_cooperation_our_contact_person_id_2c38f12b" ON "customer_contact_cooperation" ("our_contact_person_id");
CREATE INDEX "customer_contact_cooperation_project_id_cba7b557" ON "customer_contact_cooperation" ("project_id");
CREATE INDEX "business_negotiation_created_by_id_2854fd94" ON "business_negotiation" ("created_by_id");
CREATE INDEX "business_negotiation_opportunity_id_3a6bfabe" ON "business_negotiation" ("opportunity_id");
CREATE INDEX "business_bidding_quotation_created_by_id_eac203c6" ON "business_bidding_quotation" ("created_by_id");
CREATE INDEX "business_bidding_quotation_opportunity_id_854a1a5b" ON "business_bidding_quotation" ("opportunity_id");
ALTER TABLE "business_bidding_quotation_similar_projects" ADD CONSTRAINT "business_bidding_quotati_biddingquotation_id_proj_1ea182f1_uniq" UNIQUE ("biddingquotation_id", "project_id");
ALTER TABLE "business_bidding_quotation_similar_projects" ADD CONSTRAINT "business_bidding_quo_biddingquotation_id_138a3c9c_fk_business_" FOREIGN KEY ("biddingquotation_id") REFERENCES "business_bidding_quotation" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "business_bidding_quotation_similar_projects" ADD CONSTRAINT "business_bidding_quo_project_id_06efd789_fk_productio" FOREIGN KEY ("project_id") REFERENCES "production_management_project" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "business_bidding_quotation_biddingquotation_id_138a3c9c" ON "business_bidding_quotation_similar_projects" ("biddingquotation_id");
CREATE INDEX "business_bidding_quotation_similar_projects_project_id_06efd789" ON "business_bidding_quotation_similar_projects" ("project_id");
COMMIT;
