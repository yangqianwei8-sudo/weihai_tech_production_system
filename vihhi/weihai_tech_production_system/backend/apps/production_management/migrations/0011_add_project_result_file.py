# Generated by Django 4.2.7 on 2025-12-09 09:53

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


def result_file_path(instance, filename):
    """成果文件上传路径（迁移中使用的临时函数）"""
    return f"result_files/{instance.service_category}/{filename}"


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('production_management', '0010_remove_settlement_method_from_contract'),
    ]

    operations = [
        migrations.CreateModel(
            name='ProjectResultFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('service_category', models.CharField(choices=[('result_optimization', '结果优化'), ('process_optimization', '过程优化'), ('full_process_consulting', '全过程咨询')], max_length=50, verbose_name='服务类别')),
                ('file_type', models.CharField(max_length=100, verbose_name='文件类型')),
                ('file', models.FileField(upload_to=result_file_path, verbose_name='文件')),
                ('file_name', models.CharField(max_length=255, verbose_name='文件名')),
                ('file_size', models.BigIntegerField(blank=True, null=True, verbose_name='文件大小（字节）')),
                ('description', models.TextField(blank=True, verbose_name='文件描述')),
                ('uploaded_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='上传时间')),
            ],
            options={
                'verbose_name': '项目成果文件',
                'verbose_name_plural': '项目成果文件',
                'db_table': 'production_management_result_file',
                'ordering': ['-uploaded_time', 'service_category', 'file_type'],
            },
        ),
        migrations.RenameIndex(
            model_name='contractparty',
            new_name='contract_pa_contrac_c954c1_idx',
            old_name='contract_pa_contract_idx',
        ),
        migrations.AlterField(
            model_name='businesscontract',
            name='status',
            field=models.CharField(choices=[('draft', '合同草稿'), ('dispute', '合同争议'), ('finalized', '合同定稿'), ('party_b_signed', '我方签章'), ('signed', '对方签章'), ('effective', '已生效'), ('executing', '执行中'), ('completed', '已完成'), ('terminated', '已终止'), ('cancelled', '已取消')], default='draft', max_length=20, verbose_name='合同状态'),
        ),
        migrations.AddField(
            model_name='projectresultfile',
            name='project',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='result_files', to='production_management.project', verbose_name='项目'),
        ),
        migrations.AddField(
            model_name='projectresultfile',
            name='uploaded_by',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='uploaded_result_files', to=settings.AUTH_USER_MODEL, verbose_name='上传人'),
        ),
        migrations.AddIndex(
            model_name='projectresultfile',
            index=models.Index(fields=['project', 'service_category'], name='production__project_7991b1_idx'),
        ),
        migrations.AddIndex(
            model_name='projectresultfile',
            index=models.Index(fields=['project', 'file_type'], name='production__project_1987c3_idx'),
        ),
    ]
