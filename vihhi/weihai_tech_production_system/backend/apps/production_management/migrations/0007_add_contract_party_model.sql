-- Migration: 0007_add_contract_party_model
-- 创建contract_party表用于存储多个签约主体

BEGIN;

-- Create table contract_party
CREATE TABLE IF NOT EXISTS "contract_party" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "party_type" varchar(20) NOT NULL DEFAULT 'party_a',
    "party_name" varchar(200) NOT NULL,
    "party_contact" varchar(100) NOT NULL DEFAULT '',
    "contact_phone" varchar(20) NOT NULL DEFAULT '',
    "contact_email" varchar(254) NOT NULL DEFAULT '',
    "address" varchar(500) NOT NULL DEFAULT '',
    "order" integer NOT NULL DEFAULT 0,
    "is_active" boolean NOT NULL DEFAULT true,
    "created_time" timestamp with time zone NOT NULL,
    "updated_time" timestamp with time zone NOT NULL,
    "contract_id" bigint NOT NULL
);

-- Add foreign key constraint
ALTER TABLE "contract_party" ADD CONSTRAINT "contract_party_contract_id_fk" 
    FOREIGN KEY ("contract_id") REFERENCES "business_contract" ("id") ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED;

-- Create index
CREATE INDEX IF NOT EXISTS "contract_pa_contract_idx" ON "contract_party" ("contract_id", "is_active");

COMMIT;

