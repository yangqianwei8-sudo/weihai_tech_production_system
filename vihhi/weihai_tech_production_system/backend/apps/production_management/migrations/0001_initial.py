# Generated by Django 4.2.7 on 2025-11-30 10:11

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        # ('production_quality', '0005_add_production_startup_models'),  # 已删除production_quality模块
        ('customer_management', '0001_initial_squashed_0015_remove_client_blacklist_details_remove_client_code_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='BusinessContract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_number', models.CharField(blank=True, help_text='唯一标识，留空将自动生成（格式：VIH-CON-YYYY-NNNN）', max_length=100, null=True, unique=True, verbose_name='合同编号')),
                ('contract_name', models.CharField(blank=True, help_text='如未填写，将使用合同编号', max_length=200, verbose_name='合同名称')),
                ('contract_type', models.CharField(choices=[('framework', '框架合同'), ('project', '项目合同'), ('supplement', '补充协议'), ('change', '变更协议'), ('termination', '终止协议'), ('other', '其他')], default='project', max_length=20, verbose_name='合同类型')),
                ('status', models.CharField(choices=[('draft', '草稿'), ('pending_review', '待审核'), ('reviewing', '审核中'), ('signed', '已签订'), ('effective', '已生效'), ('executing', '执行中'), ('completed', '已完成'), ('terminated', '已终止'), ('cancelled', '已取消')], default='draft', max_length=20, verbose_name='合同状态')),
                ('contract_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='合同金额（含税）')),
                ('contract_amount_tax', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='合同税额')),
                ('contract_amount_excl_tax', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='合同金额（不含税）')),
                ('tax_rate', models.DecimalField(decimal_places=2, default=6.0, help_text='默认6%，可调整', max_digits=5, verbose_name='税率(%)')),
                ('settlement_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='已结算金额')),
                ('payment_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='已回款金额')),
                ('unpaid_amount', models.DecimalField(blank=True, decimal_places=2, help_text='自动计算：合同金额-已回款金额', max_digits=12, null=True, verbose_name='未回款金额')),
                ('contract_date', models.DateField(blank=True, null=True, verbose_name='合同签订日期')),
                ('effective_date', models.DateField(blank=True, null=True, verbose_name='合同生效日期')),
                ('start_date', models.DateField(blank=True, null=True, verbose_name='合同开始日期')),
                ('end_date', models.DateField(blank=True, null=True, verbose_name='合同结束日期')),
                ('contract_period', models.IntegerField(blank=True, help_text='自动计算：结束日期-开始日期', null=True, verbose_name='合同期限（天）')),
                ('party_a_name', models.CharField(blank=True, max_length=200, verbose_name='甲方名称')),
                ('party_a_contact', models.CharField(blank=True, max_length=100, verbose_name='甲方联系人')),
                ('party_b_name', models.CharField(blank=True, default='四川维海科技有限公司', max_length=200, verbose_name='乙方名称')),
                ('party_b_contact', models.CharField(blank=True, max_length=100, verbose_name='乙方联系人')),
                ('description', models.TextField(blank=True, verbose_name='合同描述')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否启用')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_production_contracts', to=settings.AUTH_USER_MODEL, verbose_name='合同审批人')),
                ('client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='production_contracts', to='customer_management.client', verbose_name='客户')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='created_production_contracts', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('parent_contract', models.ForeignKey(blank=True, help_text='用于补充协议、变更协议关联主合同', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sub_contracts', to='production_management.businesscontract', verbose_name='主合同')),
            ],
            options={
                'verbose_name': '商务合同',
                'verbose_name_plural': '商务合同',
                'db_table': 'business_contract',
                'ordering': ['-created_time'],
            },
        ),
        migrations.CreateModel(
            name='Project',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('subsidiary', models.CharField(choices=[('sichuan', '四川维海科技有限公司'), ('chongqing', '重庆维海科技有限公司'), ('xian', '西安维海科技有限公司'), ('hejian_chengdu', '禾间成都建筑设计咨询有限公司'), ('hongtian', '成都宏天升荣科技有限公司')], default='sichuan', max_length=50, verbose_name='子公司')),
                ('project_number', models.CharField(blank=True, max_length=50, null=True, unique=True, verbose_name='项目编号')),
                ('name', models.CharField(max_length=200, verbose_name='项目名称')),
                ('alias', models.CharField(blank=True, max_length=200, verbose_name='项目别名')),
                ('description', models.TextField(blank=True, verbose_name='项目描述')),
                ('business_type', models.CharField(blank=True, choices=[('residential', '住宅'), ('complex', '综合体'), ('commercial', '商业'), ('office', '写字楼'), ('school', '学校'), ('hospital', '医院'), ('industrial', '工业厂房'), ('municipal', '市政'), ('other', '其他')], max_length=50, null=True, verbose_name='项目业态')),
                ('design_stage', models.CharField(blank=True, choices=[('construction_drawing_unreviewed', '施工图（未审图）'), ('construction_drawing_reviewed', '施工图（已审图）'), ('preliminary_design', '初设阶段'), ('extended_preliminary', '扩初阶段'), ('detailed_planning', '详规阶段'), ('construction_phase', '施工阶段')], max_length=50, null=True, verbose_name='图纸阶段')),
                ('client_company_name', models.CharField(blank=True, max_length=200, verbose_name='委托单位名称')),
                ('client_credit_code', models.CharField(blank=True, max_length=50, verbose_name='统一社会信用代码')),
                ('client_registered_capital', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, verbose_name='注册资本（万元）')),
                ('client_registered_address', models.CharField(blank=True, max_length=500, verbose_name='注册地址')),
                ('client_company_type', models.CharField(blank=True, choices=[('project_company', '项目公司'), ('regional_company', '区域公司'), ('group_company', '集团公司')], max_length=50, null=True, verbose_name='企业类型')),
                ('client_ownership_type', models.CharField(blank=True, choices=[('central_enterprise', '中央企业'), ('state_owned', '国有企业'), ('platform_company', '平台公司'), ('listed_company', '上市公司'), ('private_enterprise', '民营企业')], max_length=50, null=True, verbose_name='企业所有')),
                ('client_established_date', models.DateField(blank=True, null=True, verbose_name='成立日期')),
                ('client_contact_person', models.CharField(blank=True, max_length=100, verbose_name='项目负责人')),
                ('client_phone', models.CharField(blank=True, max_length=20, verbose_name='项目负责人联系电话')),
                ('client_litigation_count', models.IntegerField(blank=True, null=True, verbose_name='司法案件数量（启信宝公开数量）')),
                ('client_enforcement_count', models.IntegerField(blank=True, null=True, verbose_name='被执行人数量（启信宝公开数量）')),
                ('client_final_case_count', models.IntegerField(blank=True, null=True, verbose_name='终本案件数量（启信宝公开数量）')),
                ('client_restriction_count', models.IntegerField(blank=True, null=True, verbose_name='限制高消费数量（启信宝公开数量）')),
                ('client_email', models.EmailField(blank=True, max_length=254, verbose_name='电子邮箱')),
                ('client_address', models.CharField(blank=True, max_length=500, verbose_name='通讯地址')),
                ('design_company', models.CharField(blank=True, max_length=200, verbose_name='设计单位名称')),
                ('design_credit_code', models.CharField(blank=True, max_length=50, verbose_name='统一社会信用代码')),
                ('design_contact_person', models.CharField(blank=True, max_length=100, verbose_name='项目负责人')),
                ('design_phone', models.CharField(blank=True, max_length=20, verbose_name='项目负责人联系电话')),
                ('our_company_name', models.CharField(blank=True, max_length=200, verbose_name='我方单位名称')),
                ('design_email', models.EmailField(blank=True, max_length=254, verbose_name='设计方电子邮箱')),
                ('project_address', models.CharField(blank=True, max_length=500, verbose_name='项目地址')),
                ('building_area', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='建筑面积(㎡)')),
                ('underground_area', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='地下面积(㎡)')),
                ('aboveground_area', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='地上面积(㎡)')),
                ('building_height', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='建筑高度(米)')),
                ('aboveground_floors', models.IntegerField(blank=True, null=True, verbose_name='地上层数')),
                ('underground_floors', models.IntegerField(blank=True, null=True, verbose_name='地下层数')),
                ('structure_type', models.CharField(blank=True, choices=[('shear_wall', '剪力墙结构'), ('frame', '框架结构'), ('steel', '钢结构'), ('other', '其他')], max_length=50, null=True, verbose_name='结构形式')),
                ('project_batches', models.JSONField(blank=True, default=list, verbose_name='项目规模（分批次）')),
                ('service_scope', models.CharField(blank=True, max_length=500, verbose_name='服务范围')),
                ('client_special_requirements', models.TextField(blank=True, verbose_name='甲方特殊要求')),
                ('technical_difficulties', models.TextField(blank=True, verbose_name='技术难点说明')),
                ('risk_assessment', models.TextField(blank=True, verbose_name='项目风险预判')),
                ('start_date', models.DateField(blank=True, null=True, verbose_name='开始日期')),
                ('end_date', models.DateField(blank=True, null=True, verbose_name='结束日期')),
                ('actual_start_date', models.DateField(blank=True, null=True, verbose_name='实际开始日期')),
                ('actual_end_date', models.DateField(blank=True, null=True, verbose_name='实际结束日期')),
                ('billing_method', models.CharField(blank=True, choices=[('pure_rate', '纯费率计费'), ('base_fee_rate', '基本费+费率取费'), ('unit_price', '综合单价包干')], max_length=50, null=True, verbose_name='服务费取费方式')),
                ('project_region', models.CharField(blank=True, choices=[('provincial_capital', '省会城市'), ('non_provincial_city', '非省会市级城市'), ('county_city', '县级城市'), ('tier1_city', '北京、上海、广州、深圳')], max_length=50, null=True, verbose_name='项目区域')),
                ('base_fee', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='基本费（元）')),
                ('unit_price', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='包干单价（元/平方米）')),
                ('fee_rate_coefficient', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True, verbose_name='取费系数（%）')),
                ('status', models.CharField(choices=[('draft', '草稿'), ('waiting_receive', '待接收'), ('configuring', '配置中'), ('waiting_start', '待开工'), ('in_progress', '进行中'), ('suspended', '暂停'), ('completed', '已完工'), ('archived', '已归档'), ('cancelled', '已取消')], default='draft', max_length=30, verbose_name='项目状态')),
                ('contract_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='合同金额（元）')),
                ('estimated_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='预估成本')),
                ('estimated_savings', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='预计节省金额')),
                ('launch_status', models.CharField(choices=[('handover_pending', '待商务移交'), ('awaiting_drawings', '待图纸上传'), ('precheck_in_progress', '预审中'), ('changes_requested', '待补充资料'), ('ready_to_start', '待开工通知'), ('started', '已开工')], default='handover_pending', max_length=30, verbose_name='项目启动状态')),
                ('launch_status_updated_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='启动状态更新时间')),
                ('handover_submitted_time', models.DateTimeField(blank=True, null=True, verbose_name='商务移交时间')),
                ('drawing_precheck_completed_time', models.DateTimeField(blank=True, null=True, verbose_name='图纸预审完成时间')),
                ('start_notice_sent_time', models.DateTimeField(blank=True, null=True, verbose_name='开工通知时间')),
                ('flow_step', models.CharField(choices=[('pending_documents', '等待资料上传'), ('precheck', '资料预审'), ('start_notice', '开工通知'), ('opinions', '意见编制'), ('internal_review', '内部审核'), ('ready_to_push', '待推送'), ('pushed', '报告已推送')], default='pending_documents', max_length=40, verbose_name='当前流程步骤')),
                ('flow_step_started_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='步骤开始时间')),
                ('flow_deadline', models.DateTimeField(blank=True, null=True, verbose_name='当前步骤截止时间')),
                ('flow_payload', models.JSONField(blank=True, default=dict, verbose_name='流程上下文')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('business_manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='business_managed_projects', to=settings.AUTH_USER_MODEL, verbose_name='商务经理')),
                ('client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='customer_management.client', verbose_name='客户')),
                ('client_leader', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='client_projects', to=settings.AUTH_USER_MODEL, verbose_name='甲方负责人账号')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='created_projects', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('design_leader', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='design_projects', to=settings.AUTH_USER_MODEL, verbose_name='设计方负责人账号')),
                ('project_manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='managed_projects', to=settings.AUTH_USER_MODEL, verbose_name='项目负责人')),
            ],
            options={
                'verbose_name': '项目',
                'verbose_name_plural': '项目',
                'db_table': 'production_management_project',
                'ordering': ['-created_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectDrawingReview',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('result', models.CharField(choices=[('pending', '待处理'), ('approved', '通过'), ('changes_requested', '需修改')], default='pending', max_length=30, verbose_name='预审结果')),
                ('comment', models.TextField(blank=True, verbose_name='预审意见')),
                ('reviewed_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='预审时间')),
                ('attachments', models.JSONField(blank=True, default=list, verbose_name='附件列表')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('reviewer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='drawing_reviews', to=settings.AUTH_USER_MODEL, verbose_name='预审人')),
            ],
            options={
                'verbose_name': '项目图纸预审记录',
                'verbose_name_plural': '项目图纸预审记录',
                'db_table': 'production_management_drawing_review',
                'ordering': ['-reviewed_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectDrawingSubmission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200, verbose_name='提交标题')),
                ('version', models.CharField(blank=True, max_length=50, verbose_name='版本号')),
                ('description', models.TextField(blank=True, verbose_name='提交说明')),
                ('submitter_role', models.CharField(blank=True, max_length=100, verbose_name='提交人角色')),
                ('submitted_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='提交时间')),
                ('status', models.CharField(choices=[('submitted', '待预审'), ('in_review', '预审中'), ('changes_requested', '需补充资料'), ('approved', '预审通过'), ('cancelled', '已取消')], default='submitted', max_length=30, verbose_name='预审状态')),
                ('review_deadline', models.DateTimeField(blank=True, null=True, verbose_name='预审截止时间')),
                ('client_notified', models.BooleanField(default=False, verbose_name='是否已通知甲方')),
                ('client_notified_time', models.DateTimeField(blank=True, null=True, verbose_name='甲方通知时间')),
                ('client_notification_channel', models.CharField(blank=True, max_length=30, verbose_name='甲方通知渠道')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('latest_review', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to='production_management.projectdrawingreview', verbose_name='最新预审记录')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='drawing_submissions', to='production_management.project', verbose_name='项目')),
                ('submitter', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='drawing_submissions', to=settings.AUTH_USER_MODEL, verbose_name='提交人')),
            ],
            options={
                'verbose_name': '项目图纸提交',
                'verbose_name_plural': '项目图纸提交',
                'db_table': 'production_management_drawing_submission',
                'ordering': ['-submitted_time'],
            },
        ),
        migrations.CreateModel(
            name='ServiceType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='服务类型编码')),
                ('name', models.CharField(max_length=100, verbose_name='服务类型名称')),
                ('order', models.PositiveIntegerField(default=0, verbose_name='排序')),
            ],
            options={
                'verbose_name': '服务类型',
                'verbose_name_plural': '服务类型',
                'db_table': 'production_management_service_type',
                'ordering': ['order', 'id'],
            },
        ),
        migrations.CreateModel(
            name='ServiceProfession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=50, verbose_name='服务专业编码')),
                ('name', models.CharField(max_length=100, verbose_name='服务专业名称')),
                ('order', models.PositiveIntegerField(default=0, verbose_name='排序')),
                ('service_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='professions', to='production_management.servicetype', verbose_name='所属服务类型')),
            ],
            options={
                'verbose_name': '服务专业',
                'verbose_name_plural': '服务专业',
                'db_table': 'production_management_service_profession',
                'ordering': ['service_type__order', 'order', 'id'],
                'unique_together': {('service_type', 'code')},
            },
        ),
        migrations.CreateModel(
            name='ProjectTeamNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200, verbose_name='标题')),
                ('message', models.TextField(verbose_name='内容')),
                ('category', models.CharField(choices=[('team_change', '团队变更'), ('quality_alert', '质量提醒'), ('approval', '审批通知')], default='team_change', max_length=50, verbose_name='通知分类')),
                ('action_url', models.CharField(blank=True, max_length=300, verbose_name='跳转链接')),
                ('is_read', models.BooleanField(default=False, verbose_name='是否已读')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('read_time', models.DateTimeField(blank=True, null=True, verbose_name='读取时间')),
                ('context', models.JSONField(blank=True, default=dict, verbose_name='上下文信息')),
                ('operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='team_notifications_sent', to=settings.AUTH_USER_MODEL, verbose_name='操作人')),
                ('project', models.ForeignKey(blank=True, help_text='关联项目（可选，用于非项目相关通知时可为空）', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='team_notifications', to='production_management.project', verbose_name='项目')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='team_notifications', to=settings.AUTH_USER_MODEL, verbose_name='接收人')),
            ],
            options={
                'verbose_name': '项目团队通知',
                'verbose_name_plural': '项目团队通知',
                'db_table': 'production_management_team_notification',
                'ordering': ['-created_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectTeamChangeLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(max_length=50, verbose_name='角色')),
                ('unit', models.CharField(choices=[('management', '管理团队'), ('business', '商务团队'), ('internal_tech', '内部技术团队'), ('external_tech', '外部技术团队'), ('internal_cost', '内部结算团队'), ('external_cost', '外部结算团队'), ('client_side', '甲方团队'), ('design_side', '设计团队')], default='management', max_length=32, verbose_name='所属团队')),
                ('is_external', models.BooleanField(default=False, verbose_name='是否外部成员')),
                ('action', models.CharField(choices=[('added', '新增'), ('removed', '移除')], max_length=20, verbose_name='操作类型')),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now, verbose_name='操作时间')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('member', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='team_change_logs', to=settings.AUTH_USER_MODEL, verbose_name='成员')),
                ('operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='team_change_operations', to=settings.AUTH_USER_MODEL, verbose_name='操作人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='team_change_logs', to='production_management.project', verbose_name='项目')),
                ('service_profession', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='production_management.serviceprofession', verbose_name='所属专业')),
            ],
            options={
                'verbose_name': '项目团队变更日志',
                'verbose_name_plural': '项目团队变更日志',
                'db_table': 'production_management_team_log',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='ProjectStartNotice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('subject', models.CharField(max_length=200, verbose_name='通知主题')),
                ('message', models.TextField(verbose_name='通知内容')),
                ('channel', models.CharField(choices=[('system', '系统通知'), ('email', '邮件'), ('sms', '短信'), ('manual', '线下确认')], default='system', max_length=30, verbose_name='通知渠道')),
                ('status', models.CharField(choices=[('pending', '待发送'), ('sent', '已发送'), ('failed', '发送失败'), ('acknowledged', '已确认')], default='pending', max_length=30, verbose_name='通知状态')),
                ('recipient_name', models.CharField(blank=True, max_length=100, verbose_name='接收人姓名')),
                ('recipient_phone', models.CharField(blank=True, max_length=20, verbose_name='接收人电话')),
                ('recipient_email', models.EmailField(blank=True, max_length=254, verbose_name='接收人邮箱')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('sent_time', models.DateTimeField(blank=True, null=True, verbose_name='发送时间')),
                ('acknowledged_time', models.DateTimeField(blank=True, null=True, verbose_name='确认时间')),
                ('failure_reason', models.TextField(blank=True, verbose_name='失败原因')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='start_notices_created', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='start_notices', to='production_management.project', verbose_name='项目')),
                ('recipient_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='received_start_notices', to=settings.AUTH_USER_MODEL, verbose_name='接收人')),
                ('submission', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='start_notices', to='production_management.projectdrawingsubmission', verbose_name='关联图纸提交')),
            ],
            options={
                'verbose_name': '项目开工通知',
                'verbose_name_plural': '项目开工通知',
                'db_table': 'production_management_start_notice',
                'ordering': ['-created_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectMilestone',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='里程碑名称')),
                ('description', models.TextField(blank=True, verbose_name='里程碑描述')),
                ('planned_date', models.DateField(verbose_name='计划日期')),
                ('actual_date', models.DateField(blank=True, null=True, verbose_name='实际日期')),
                ('completion_rate', models.IntegerField(default=0, verbose_name='完成率')),
                ('is_completed', models.BooleanField(default=False, verbose_name='是否完成')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='milestones', to='production_management.project', verbose_name='项目')),
            ],
            options={
                'verbose_name': '项目里程碑',
                'verbose_name_plural': '项目里程碑',
                'db_table': 'production_management_milestone',
                'ordering': ['planned_date'],
            },
        ),
        migrations.CreateModel(
            name='ProjectMeetingRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('meeting_date', models.DateField(default=django.utils.timezone.now, verbose_name='会议日期')),
                ('topic', models.CharField(max_length=200, verbose_name='会议主题')),
                ('client_decision', models.TextField(blank=True, verbose_name='甲方意见')),
                ('design_decision', models.TextField(blank=True, verbose_name='设计方意见')),
                ('consultant_decision', models.TextField(blank=True, verbose_name='我方意见')),
                ('conclusions', models.TextField(blank=True, verbose_name='结论 / 待办')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='meeting_records', to=settings.AUTH_USER_MODEL, verbose_name='记录人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='meeting_records', to='production_management.project', verbose_name='项目')),
            ],
            options={
                'verbose_name': '三方会议记录',
                'verbose_name_plural': '三方会议记录',
                'db_table': 'production_management_meeting_record',
                'ordering': ['-meeting_date', '-created_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectFlowLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('advance', '流程流转'), ('note', '备注')], default='advance', max_length=30, verbose_name='动作类型')),
                ('from_step', models.CharField(blank=True, max_length=40, verbose_name='原步骤')),
                ('to_step', models.CharField(blank=True, max_length=40, verbose_name='目标步骤')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('actor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='project_flow_actions', to=settings.AUTH_USER_MODEL, verbose_name='操作人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='flow_logs', to='production_management.project', verbose_name='项目')),
            ],
            options={
                'verbose_name': '项目流程日志',
                'verbose_name_plural': '项目流程日志',
                'db_table': 'production_management_flow_log',
                'ordering': ['-created_time'],
            },
        ),
        migrations.AddField(
            model_name='projectdrawingreview',
            name='submission',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reviews', to='production_management.projectdrawingsubmission', verbose_name='图纸提交'),
        ),
        migrations.CreateModel(
            name='ProjectDrawingFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='文件名称')),
                ('category', models.CharField(choices=[('general', '通用资料'), ('architecture', '建筑'), ('structure', '结构'), ('mep', '机电'), ('civil', '土建'), ('other', '其他')], default='general', max_length=30, verbose_name='文件分类')),
                ('file', models.FileField(upload_to='project_drawings/%Y/%m/', verbose_name='文件')),
                ('uploaded_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='上传时间')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('submission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='files', to='production_management.projectdrawingsubmission', verbose_name='图纸提交')),
                ('uploaded_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='drawing_files', to=settings.AUTH_USER_MODEL, verbose_name='上传人')),
            ],
            options={
                'verbose_name': '项目图纸文件',
                'verbose_name_plural': '项目图纸文件',
                'db_table': 'production_management_drawing_file',
                'ordering': ['-uploaded_time'],
            },
        ),
        migrations.CreateModel(
            name='ProjectDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='文档名称')),
                ('document_type', models.CharField(choices=[('contract', '合同文件'), ('design', '设计文件'), ('report', '报告文件'), ('meeting', '会议纪要'), ('other', '其他文件')], max_length=50, verbose_name='文档类型')),
                ('file', models.FileField(upload_to='project_documents/%Y/%m/', verbose_name='文档文件')),
                ('description', models.TextField(blank=True, verbose_name='文档描述')),
                ('uploaded_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='上传时间')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='production_management.project', verbose_name='项目')),
                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='上传人')),
            ],
            options={
                'verbose_name': '项目文档',
                'verbose_name_plural': '项目文档',
                'db_table': 'production_management_document',
                'ordering': ['-uploaded_time'],
            },
        ),
        migrations.AddField(
            model_name='project',
            name='service_professions',
            field=models.ManyToManyField(blank=True, related_name='projects', to='production_management.serviceprofession', verbose_name='服务专业'),
        ),
        migrations.AddField(
            model_name='project',
            name='service_type',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='projects', to='production_management.servicetype', verbose_name='服务类型'),
        ),
        migrations.CreateModel(
            name='BusinessPaymentPlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('phase_name', models.CharField(max_length=100, verbose_name='回款阶段')),
                ('phase_description', models.TextField(blank=True, verbose_name='阶段描述')),
                ('planned_amount', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='计划金额')),
                ('planned_date', models.DateField(verbose_name='计划日期')),
                ('actual_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='实际金额')),
                ('actual_date', models.DateField(blank=True, null=True, verbose_name='实际日期')),
                ('status', models.CharField(choices=[('pending', '待回款'), ('partial', '部分回款'), ('completed', '已完成'), ('overdue', '已逾期'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='状态')),
                ('trigger_condition', models.CharField(blank=True, max_length=100, verbose_name='触发条件')),
                ('condition_detail', models.CharField(blank=True, max_length=200, verbose_name='付款条件详情')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_plans', to='production_management.businesscontract', verbose_name='合同')),
            ],
            options={
                'verbose_name': '商务回款计划',
                'verbose_name_plural': '商务回款计划',
                'db_table': 'business_payment_plan',
                'ordering': ['planned_date'],
            },
        ),
        migrations.AddField(
            model_name='businesscontract',
            name='project',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='contracts', to='production_management.project', verbose_name='关联项目'),
        ),
        migrations.AddField(
            model_name='businesscontract',
            name='signed_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signed_production_contracts', to=settings.AUTH_USER_MODEL, verbose_name='合同签订人'),
        ),
        migrations.CreateModel(
            name='ProjectTeam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('business_manager', '商务经理'), ('project_manager', '项目经理'), ('professional_leader', '内部专业负责人'), ('engineer', '内部专业工程师'), ('technical_assistant', '技术助理'), ('external_leader', '外部专业负责人'), ('external_engineer', '外部专业工程师'), ('cost_reviewer_civil', '内部土建审核人'), ('cost_reviewer_installation', '内部安装审核人'), ('cost_engineer_civil', '内部土建造价师'), ('cost_engineer_installation', '内部安装造价师'), ('external_cost_reviewer_civil', '外部土建审核人'), ('external_cost_reviewer_installation', '外部安装审核人'), ('external_cost_engineer_civil', '外部土建造价师'), ('external_cost_engineer_installation', '外部安装造价师'), ('client_lead', '甲方项目负责人'), ('client_engineer', '甲方专业工程师'), ('design_lead', '设计方项目负责人'), ('design_engineer', '设计方专业工程师')], max_length=50, verbose_name='角色')),
                ('unit', models.CharField(choices=[('management', '管理团队'), ('business', '商务团队'), ('internal_tech', '内部技术团队'), ('external_tech', '外部技术团队'), ('internal_cost', '内部结算团队'), ('external_cost', '外部结算团队'), ('client_side', '甲方团队'), ('design_side', '设计团队')], default='management', max_length=32, verbose_name='所属团队')),
                ('is_external', models.BooleanField(default=False, verbose_name='是否外部成员')),
                ('join_date', models.DateField(default=django.utils.timezone.now, verbose_name='加入日期')),
                ('leave_date', models.DateField(blank=True, null=True, verbose_name='离开日期')),
                ('responsibility', models.TextField(blank=True, verbose_name='职责描述')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否有效')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='team_members', to='production_management.project', verbose_name='项目')),
                ('service_profession', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='production_management.serviceprofession', verbose_name='所属专业')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL, verbose_name='成员')),
            ],
            options={
                'verbose_name': '项目团队',
                'verbose_name_plural': '项目团队',
                'db_table': 'production_management_team',
                'unique_together': {('project', 'user', 'role', 'service_profession')},
            },
        ),
        migrations.CreateModel(
            name='ProjectTask',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200, verbose_name='任务标题')),
                ('task_type', models.CharField(choices=[('project_complete_info', '完善项目信息'), ('configure_team', '配置项目团队'), ('client_upload_pre_docs', '甲方上传优化前资料'), ('client_resubmit_pre_docs', '甲方补充/重传资料'), ('internal_precheck_docs', '我方预审优化前资料'), ('client_issue_start_notice', '甲方发布开工通知')], max_length=64, verbose_name='任务类型')),
                ('description', models.TextField(blank=True, verbose_name='任务说明')),
                ('status', models.CharField(choices=[('pending', '待处理'), ('in_progress', '进行中'), ('completed', '已完成'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='状态')),
                ('assigned_role', models.CharField(blank=True, max_length=50, verbose_name='指派角色')),
                ('target_unit', models.CharField(blank=True, max_length=32, verbose_name='目标团队')),
                ('due_time', models.DateTimeField(blank=True, null=True, verbose_name='截止时间')),
                ('completed_time', models.DateTimeField(blank=True, null=True, verbose_name='完成时间')),
                ('cancelled_time', models.DateTimeField(blank=True, null=True, verbose_name='取消时间')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('metadata', models.JSONField(blank=True, default=dict, verbose_name='扩展信息')),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='project_tasks', to=settings.AUTH_USER_MODEL, verbose_name='指派给')),
                ('cancelled_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='project_tasks_cancelled', to=settings.AUTH_USER_MODEL, verbose_name='取消操作人')),
                ('completed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='project_tasks_completed', to=settings.AUTH_USER_MODEL, verbose_name='完成操作人')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='project_tasks_created', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='production_management.project', verbose_name='项目')),
            ],
            options={
                'verbose_name': '项目任务',
                'verbose_name_plural': '项目任务',
                'db_table': 'production_management_task',
                'ordering': ['due_time', 'created_time'],
                'indexes': [models.Index(fields=['project', 'task_type'], name='production__project_acd3fe_idx'), models.Index(fields=['project', 'status'], name='production__project_512aa4_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProjectMeetingDecision',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('decision', models.CharField(choices=[('agree', '同意'), ('reject', '不同意'), ('partial', '部分同意'), ('pending', '待确认')], default='pending', max_length=20, verbose_name='会议结论')),
                ('client_comment', models.TextField(blank=True, verbose_name='甲方意见')),
                ('design_comment', models.TextField(blank=True, verbose_name='设计方意见')),
                ('consultant_comment', models.TextField(blank=True, verbose_name='我方意见')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('meeting', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='decisions', to='production_management.projectmeetingrecord', verbose_name='会议记录')),
                ('opinion_id', models.IntegerField(null=True, blank=True, verbose_name='关联意见ID', help_text='已删除生产质量模块，此字段保留用于历史数据')),
            ],
            options={
                'verbose_name': '三方会议结论',
                'verbose_name_plural': '三方会议结论',
                'db_table': 'production_management_meeting_decision',
                'ordering': ['-created_time'],
                'unique_together': {('meeting', 'opinion_id')},
            },
        ),
        migrations.CreateModel(
            name='ProjectDesignReply',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('issue_title', models.CharField(max_length=200, verbose_name='事项 / 问题')),
                ('status', models.CharField(choices=[('agree', '同意优化'), ('reject', '不同意优化'), ('partial', '部分同意')], default='agree', max_length=20, verbose_name='回复结果')),
                ('response_detail', models.TextField(blank=True, verbose_name='回复说明')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_time', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('opinion_id', models.IntegerField(null=True, blank=True, verbose_name='关联意见ID', help_text='已删除生产质量模块，此字段保留用于历史数据')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='design_replies', to='production_management.project', verbose_name='项目')),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='design_replies', to=settings.AUTH_USER_MODEL, verbose_name='提交人')),
            ],
            options={
                'verbose_name': '设计方回复',
                'verbose_name_plural': '设计方回复',
                'db_table': 'production_management_design_reply',
                'ordering': ['-created_time'],
                'indexes': [models.Index(fields=['project', 'opinion_id'], name='production__project_2a9822_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProjectArchive',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('archive_number', models.CharField(max_length=50, unique=True, verbose_name='归档编号')),
                ('archive_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='归档时间')),
                ('archive_version', models.IntegerField(default=1, verbose_name='归档版本')),
                ('archive_content', models.JSONField(default=dict, verbose_name='归档内容')),
                ('view_permissions', models.JSONField(blank=True, default=list, verbose_name='查看权限')),
                ('download_permissions', models.JSONField(blank=True, default=list, verbose_name='下载权限')),
                ('modify_permissions', models.JSONField(blank=True, default=list, verbose_name='修改权限')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('archived_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='归档人')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='archives', to='production_management.project', verbose_name='项目')),
            ],
            options={
                'verbose_name': '项目归档',
                'verbose_name_plural': '项目归档',
                'db_table': 'production_management_archive',
                'ordering': ['-archive_time'],
                'unique_together': {('project', 'archive_version')},
            },
        ),
        migrations.AddIndex(
            model_name='businesscontract',
            index=models.Index(fields=['contract_number'], name='business_co_contrac_e8523a_idx'),
        ),
        migrations.AddIndex(
            model_name='businesscontract',
            index=models.Index(fields=['status', 'contract_type'], name='business_co_status_a1c505_idx'),
        ),
        migrations.AddIndex(
            model_name='businesscontract',
            index=models.Index(fields=['contract_date'], name='business_co_contrac_dcd013_idx'),
        ),
    ]
