# Generated by Django 4.2.7 on 2025-12-09 10:14

from django.db import migrations


def seed_result_file_types(apps, schema_editor):
    """初始化成果文件类型数据"""
    ResultFileType = apps.get_model('production_management', 'ResultFileType')
    
    # 结果优化文件类型
    result_optimization_types = [
        ('pre_optimization_disc_application', '优化前刻盘申请', 1),
        ('pre_optimization_materials', '优化前资料', 2),
        ('optimization_opinion', '优化意见书', 3),
        ('opinion_reply', '意见书回复', 4),
        ('tripartite_meeting_minutes', '三方会议纪要', 5),
        ('tripartite_communication_results', '三方沟通成果', 6),
        ('review_opinion', '核图意见书', 7),
        ('post_optimization_disc_application', '优化后资料刻盘申请', 8),
        ('post_optimization_materials', '优化后资料', 9),
        ('result_confirmation', '成果确认函', 10),
    ]
    
    # 过程优化文件类型
    process_optimization_types = [
        ('quota_indicator_letter', '过程优化限额指标函', 1),
        ('process_optimization_drawings', '过程优化图纸', 2),
        ('process_optimization_report', '过程优化报告', 3),
        ('review_opinion', '核图意见书', 4),
        ('post_optimization_disc_application', '优化后资料刻盘申请', 5),
        ('post_optimization_materials', '优化后资料', 6),
        ('result_confirmation', '成果确认函', 7),
    ]
    
    # 全过程咨询文件类型
    full_process_consulting_types = [
        ('weekly_bulletin', '每周快报', 1),
        ('stage_drawings', '阶段图纸', 2),
        ('interim_report', '中间汇报文件', 3),
        ('final_report', '最终汇报文件', 4),
        ('review_opinion', '核图意见书', 5),
        ('post_consulting_drawings', '全过程咨询后图纸', 6),
        ('result_confirmation', '成果确认函', 7),
    ]
    
    # 创建结果优化文件类型
    for code, name, order in result_optimization_types:
        ResultFileType.objects.get_or_create(
            service_category='result_optimization',
            code=code,
            defaults={
                'name': name,
                'order': order,
                'is_active': True,
            }
        )
    
    # 创建过程优化文件类型
    for code, name, order in process_optimization_types:
        ResultFileType.objects.get_or_create(
            service_category='process_optimization',
            code=code,
            defaults={
                'name': name,
                'order': order,
                'is_active': True,
            }
        )
    
    # 创建全过程咨询文件类型
    for code, name, order in full_process_consulting_types:
        ResultFileType.objects.get_or_create(
            service_category='full_process_consulting',
            code=code,
            defaults={
                'name': name,
                'order': order,
                'is_active': True,
            }
        )


def reverse_seed_result_file_types(apps, schema_editor):
    """回滚：删除所有文件类型数据"""
    ResultFileType = apps.get_model('production_management', 'ResultFileType')
    ResultFileType.objects.all().delete()


class Migration(migrations.Migration):

    dependencies = [
        ('production_management', '0013_add_result_file_type_model'),
    ]

    operations = [
        migrations.RunPython(seed_result_file_types, reverse_seed_result_file_types),
    ]
