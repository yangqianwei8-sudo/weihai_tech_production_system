# P2-1ï¼šç»Ÿä¸€æ¨¡å‹ä¸çŠ¶æ€æœº - å®Œæˆæ€»ç»“

> **å®Œæˆæ—¶é—´**ï¼š2025-01-XX  
> **é˜¶æ®µ**ï¼šP2-1  
> **çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

## ğŸ“‹ å®Œæˆå†…å®¹

### 1. StrategicGoal æ¨¡å‹ç»Ÿä¸€ âœ…

#### æ–°å¢å­—æ®µï¼š
- `level`ï¼šç›®æ ‡å±‚çº§ï¼ˆcompany | personalï¼‰
- `owner`ï¼šç›®æ ‡æ‰€æœ‰è€…ï¼ˆUserï¼Œcompany çº§å¯ä¸ºç©ºï¼‰
- `published_at`ï¼šå‘å¸ƒæ—¶é—´æˆ³
- `accepted_at`ï¼šæ¥æ”¶æ—¶é—´æˆ³
- `completed_at`ï¼šå®Œæˆæ—¶é—´æˆ³

#### çŠ¶æ€æœºæ›´æ–°ï¼š
- æ–°å¢ `accepted` çŠ¶æ€ï¼ˆå·²æ¥æ”¶ï¼‰
- çŠ¶æ€æœºè§„åˆ™ï¼š`draft â†’ published â†’ accepted â†’ in_progress â†’ completed`
- æ”¯æŒä» `draft` æˆ– `published` å–æ¶ˆï¼ˆ`cancelled`ï¼‰

#### çŠ¶æ€è½¬æ¢æ–¹æ³•ï¼š
- `transition_to()` æ–¹æ³•è‡ªåŠ¨è®°å½•æ—¶é—´æˆ³
- çŠ¶æ€è½¬æ¢æ—¶è‡ªåŠ¨æ›´æ–° `published_at`ã€`accepted_at`ã€`completed_at`

---

### 2. Plan æ¨¡å‹ç»Ÿä¸€ âœ…

#### å­—æ®µå˜æ›´ï¼š
- `plan_type` â†’ `level`ï¼šè®¡åˆ’å±‚çº§ï¼ˆcompany | personalï¼‰
- æ–°å¢ `owner`ï¼šè®¡åˆ’æ‰€æœ‰è€…ï¼ˆUserï¼Œcompany çº§å¯ä¸ºç©ºï¼‰
- æ–°å¢ `published_at`ï¼šå‘å¸ƒæ—¶é—´æˆ³
- æ–°å¢ `accepted_at`ï¼šæ¥æ”¶æ—¶é—´æˆ³
- æ–°å¢ `completed_at`ï¼šå®Œæˆæ—¶é—´æˆ³

#### çŠ¶æ€æœºæ›´æ–°ï¼š
- æ–°å¢ `published` çŠ¶æ€ï¼ˆå·²å‘å¸ƒï¼‰
- æ–°å¢ `accepted` çŠ¶æ€ï¼ˆå·²æ¥æ”¶ï¼‰
- çŠ¶æ€æœºè§„åˆ™ï¼š`draft â†’ published â†’ accepted â†’ in_progress â†’ completed`
- æ”¯æŒä» `draft` æˆ– `published` å–æ¶ˆï¼ˆ`cancelled`ï¼‰

#### çŠ¶æ€è½¬æ¢æ–¹æ³•ï¼š
- `transition_to()` æ–¹æ³•è‡ªåŠ¨è®°å½•æ—¶é—´æˆ³
- çŠ¶æ€è½¬æ¢æ—¶è‡ªåŠ¨æ›´æ–° `published_at`ã€`accepted_at`ã€`completed_at`

---

### 3. çŠ¶æ€æœºè§„åˆ™ç»Ÿä¸€ âœ…

#### ç»Ÿä¸€çš„çŠ¶æ€æœºè§„åˆ™ï¼ˆç›®æ ‡å’Œè®¡åˆ’å…±ç”¨ï¼‰ï¼š

```
draft â†’ published â†’ accepted â†’ in_progress â†’ completed
              â†˜ cancelled
```

**çŠ¶æ€è¯´æ˜ï¼š**
- `draft`ï¼šåˆ¶å®šä¸­/è‰ç¨¿
- `published`ï¼šå·²å‘å¸ƒï¼ˆå·²ä¸‹è¾¾ï¼‰
- `accepted`ï¼šå·²æ¥æ”¶ï¼ˆå‘˜å·¥ç¡®è®¤ï¼‰
- `in_progress`ï¼šæ‰§è¡Œä¸­ï¼ˆè‡ªåŠ¨/äººå·¥è¿›å…¥ï¼‰
- `completed`ï¼šå·²å®Œæˆï¼ˆæ»¡è¶³å®Œæˆæ¡ä»¶ï¼‰
- `cancelled`ï¼šå·²å–æ¶ˆï¼ˆå¯ä» draft æˆ– published å–æ¶ˆï¼‰

**çŠ¶æ€è½¬æ¢è§„åˆ™ï¼š**
- `draft` â†’ `published`ï¼šå‘å¸ƒç›®æ ‡/è®¡åˆ’
- `published` â†’ `accepted`ï¼šå‘˜å·¥æ¥æ”¶
- `accepted` â†’ `in_progress`ï¼šå¼€å§‹æ‰§è¡Œ
- `in_progress` â†’ `completed`ï¼šå®Œæˆ
- `draft` â†’ `cancelled`ï¼šå–æ¶ˆ
- `published` â†’ `cancelled`ï¼šå–æ¶ˆ

---

### 4. æ•°æ®åº“è¿ç§» âœ…

**è¿ç§»æ–‡ä»¶ï¼š** `0023_p2_1_unify_models_and_state_machine.py`

**è¿ç§»å†…å®¹ï¼š**
1. StrategicGoal æ¨¡å‹ï¼š
   - æ·»åŠ  `level` å­—æ®µ
   - æ·»åŠ  `owner` å­—æ®µ
   - æ·»åŠ  `published_at`ã€`accepted_at`ã€`completed_at` æ—¶é—´æˆ³å­—æ®µ
   - æ›´æ–°çŠ¶æ€é€‰æ‹©ï¼ˆæ·»åŠ  `accepted`ï¼‰
   - æ·»åŠ ç´¢å¼•

2. Plan æ¨¡å‹ï¼š
   - æ·»åŠ  `level` å­—æ®µ
   - è¿ç§» `plan_type` æ•°æ®åˆ° `level`
   - æ·»åŠ  `owner` å­—æ®µ
   - æ·»åŠ  `published_at`ã€`accepted_at`ã€`completed_at` æ—¶é—´æˆ³å­—æ®µ
   - æ›´æ–°çŠ¶æ€é€‰æ‹©ï¼ˆæ·»åŠ  `published` å’Œ `accepted`ï¼‰
   - æ·»åŠ ç´¢å¼•

**æ•°æ®è¿ç§»ï¼š**
- `plan_type` â†’ `level` æ˜ å°„ï¼š
  - `company` â†’ `company`
  - `personal` â†’ `personal`
  - `department` â†’ `company`ï¼ˆéƒ¨é—¨è®¡åˆ’å½’ä¸ºå…¬å¸è®¡åˆ’ï¼‰
  - `project` â†’ `company`ï¼ˆé¡¹ç›®è®¡åˆ’å½’ä¸ºå…¬å¸è®¡åˆ’ï¼‰

---

## âœ… P2-1 å®Œæˆæ ‡å‡†æ£€æŸ¥

- [x] ç›®æ ‡å’Œè®¡åˆ’å­—æ®µé«˜åº¦ä¸€è‡´
- [x] ä»£ç ä¸­æ²¡æœ‰ if/else åœ°ç‹±ï¼ˆçŠ¶æ€æœºç»Ÿä¸€ï¼‰
- [x] çŠ¶æ€è¿ç§»è·¯å¾„æ¸…æ™°ï¼ˆæ–‡æ¡£åŒ–ï¼‰
- [x] çŠ¶æ€è½¬æ¢è‡ªåŠ¨è®°å½•æ—¶é—´æˆ³
- [x] æ•°æ®åº“è¿ç§»æ–‡ä»¶å·²åˆ›å»º

---

## ğŸ“ åç»­å·¥ä½œï¼ˆP2-2 åŠä»¥åï¼‰

### éœ€è¦æ›´æ–°çš„ä»£ç ä½ç½®ï¼š

1. **views_pages.py**ï¼š
   - å°† `plan_type` ç­›é€‰æ”¹ä¸º `level`
   - æ›´æ–°ç»Ÿè®¡æŸ¥è¯¢ä½¿ç”¨ `level`

2. **forms.py**ï¼š
   - æ›´æ–° PlanForm ä½¿ç”¨ `level` å­—æ®µ

3. **views.py**ï¼š
   - æ›´æ–° filterset_fields ä½¿ç”¨ `level`

4. **åºåˆ—åŒ–å™¨**ï¼š
   - æ›´æ–° PlanSerializer ä½¿ç”¨ `level`

5. **æµ‹è¯•ä»£ç **ï¼š
   - æ›´æ–°æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ `level`

### å…¼å®¹æ€§è¯´æ˜ï¼š

- `plan_type` å­—æ®µæš‚æ—¶ä¿ç•™ï¼Œé¿å…ç ´åç°æœ‰ä»£ç 
- å»ºè®®åœ¨ P2-2 é˜¶æ®µé€æ­¥è¿ç§»æ‰€æœ‰ä½¿ç”¨ `plan_type` çš„ä»£ç åˆ° `level`
- æœ€ç»ˆå¯ä»¥åˆ é™¤ `plan_type` å­—æ®µï¼ˆéœ€è¦åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶ï¼‰

---

## ğŸ¯ çŠ¶æ€æœºè§„åˆ™æ–‡æ¡£

### StrategicGoal çŠ¶æ€æœºï¼š

```python
STATUS_CHOICES = [
    ('draft', 'åˆ¶å®šä¸­'),
    ('published', 'å·²å‘å¸ƒ'),
    ('accepted', 'å·²æ¥æ”¶'),
    ('in_progress', 'æ‰§è¡Œä¸­'),
    ('completed', 'å·²å®Œæˆ'),
    ('cancelled', 'å·²å–æ¶ˆ'),
]

# çŠ¶æ€è½¬æ¢è§„åˆ™
transitions = {
    'draft': ['published', 'cancelled'],
    'published': ['accepted', 'cancelled'],
    'accepted': ['in_progress', 'cancelled'],
    'in_progress': ['completed', 'cancelled'],
    'completed': [],
    'cancelled': [],
}
```

### Plan çŠ¶æ€æœºï¼š

```python
STATUS_CHOICES = [
    ('draft', 'è‰ç¨¿'),
    ('published', 'å·²å‘å¸ƒ'),
    ('accepted', 'å·²æ¥æ”¶'),
    ('in_progress', 'æ‰§è¡Œä¸­'),
    ('completed', 'å·²å®Œæˆ'),
    ('cancelled', 'å·²å–æ¶ˆ'),
]

# çŠ¶æ€è½¬æ¢è§„åˆ™ï¼ˆä¸ StrategicGoal ä¸€è‡´ï¼‰
transitions = {
    'draft': ['published', 'cancelled'],
    'published': ['accepted', 'cancelled'],
    'accepted': ['in_progress', 'cancelled'],
    'in_progress': ['completed', 'cancelled'],
    'completed': [],
    'cancelled': [],
}
```

---

## ğŸ“Œ é‡è¦è¯´æ˜

1. **çŠ¶æ€è½¬æ¢æ—¶é—´æˆ³**ï¼š
   - `published_at`ï¼šçŠ¶æ€å˜ä¸º `published` æ—¶è‡ªåŠ¨è®°å½•
   - `accepted_at`ï¼šçŠ¶æ€å˜ä¸º `accepted` æ—¶è‡ªåŠ¨è®°å½•
   - `completed_at`ï¼šçŠ¶æ€å˜ä¸º `completed` æ—¶è‡ªåŠ¨è®°å½•

2. **owner å­—æ®µè§„åˆ™**ï¼š
   - ä¸ªäººç›®æ ‡/è®¡åˆ’ï¼š`owner` å¿…å¡«
   - å…¬å¸ç›®æ ‡/è®¡åˆ’ï¼š`owner` å¯ä¸ºç©º

3. **level å­—æ®µè§„åˆ™**ï¼š
   - `company`ï¼šå…¬å¸çº§ç›®æ ‡/è®¡åˆ’
   - `personal`ï¼šä¸ªäººçº§ç›®æ ‡/è®¡åˆ’

4. **çŠ¶æ€è½¬æ¢æ–¹æ³•**ï¼š
   - å¿…é¡»ä½¿ç”¨ `transition_to()` æ–¹æ³•è¿›è¡ŒçŠ¶æ€è½¬æ¢
   - ç¦æ­¢ç›´æ¥ä¿®æ”¹ `status` å­—æ®µ
   - çŠ¶æ€è½¬æ¢ä¼šè‡ªåŠ¨è®°å½•æ—¶é—´æˆ³å’Œæ—¥å¿—

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šP2-2 ç›®æ ‡ç®¡ç†é—­ç¯

P2-1 å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹ P2-2ï¼š
- å…¬å¸ç›®æ ‡åˆ›å»ºä¸å‘å¸ƒ
- ä¸ªäººç›®æ ‡åˆ›å»ºä¸æ¥æ”¶
- ç›®æ ‡è·Ÿè¸ªè§„åˆ™
- ç³»ç»Ÿé€šçŸ¥æœºåˆ¶

