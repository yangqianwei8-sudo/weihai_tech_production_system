# 计划审批列表检查报告

## 页面信息
**页面名称**：计划审批列表  
**URL**：`plan_pages:plan_approval_list`  
**模板文件**：`plan_management/plan_approval_list.html`

## 当前实现

### 视图代码
**文件**：`apps/plan_management/views_pages.py`  
**函数**：`plan_approval_list`（第1100-1135行）

**功能**：
- 展示所有待裁决的 `PlanDecision`（`decided_at is null`）
- 统计信息：
  - `pending_count`：启动请求数量（`request_type='start'`）
  - `cancel_count`：取消请求数量（`request_type='cancel'`）

### 统计卡片
**文件**：`templates/plan_management/_partials/_approval_stats.html`

**当前统计卡片**（2个）：
1. 启动请求（`pending_count`）
2. 取消请求（`cancel_count`）

### 模型分析

#### PlanDecision 模型
- **请求类型**（`request_type`）：
  - `start` - 启动计划
  - `cancel` - 取消计划
- **决策结果**（`decision`）：
  - `approve` - 通过
  - `reject` - 驳回
- **状态判断**：通过 `decided_at` 是否为 `null` 判断是否待处理

#### Plan 模型状态
- `draft` - 草稿
- `in_progress` - 执行中
- `completed` - 已完成
- `cancelled` - 已取消

## 检查结果

### ✅ 统计卡片与请求类型一致
- 统计卡片按照 `PlanDecision` 的请求类型（`request_type`）进行统计
- 显示"启动请求"和"取消请求"的数量
- **状态**：✅ 一致

### ✅ 页面功能正常
- 页面只显示待裁决的请求（`decided_at is null`）
- 统计卡片统计的是待裁决的请求数量
- **状态**：✅ 正常

### ⚠️ 可能的改进点
1. **可以添加总请求数统计**：
   - 当前只有"启动请求"和"取消请求"两个卡片
   - 可以添加"总请求数"卡片，显示所有待裁决请求的总数

2. **可以按计划状态统计**：
   - 表格中显示了计划状态（`d.plan.status`）
   - 可以添加统计卡片显示不同状态下的计划请求数量

## 建议

### 方案1：添加总请求数统计（推荐）
在现有统计卡片基础上，添加"总请求数"卡片：

```html
<div class="list-stats">
  <div class="list-stat-card">
    <div class="list-stat-label">总请求数</div>
    <div class="list-stat-value">{{ total_count|default:0 }}</div>
  </div>
  <div class="list-stat-card">
    <div class="list-stat-label">启动请求</div>
    <div class="list-stat-value">{{ pending_count|default:0 }}</div>
  </div>
  <div class="list-stat-card">
    <div class="list-stat-label">取消请求</div>
    <div class="list-stat-value">{{ cancel_count|default:0 }}</div>
  </div>
</div>
```

### 方案2：保持现状
当前实现已经符合页面功能需求：
- 页面只显示待裁决的请求
- 统计卡片按请求类型统计
- 功能清晰，符合用户需求

## 结论

**当前状态**：✅ **统计卡片与功能一致**

计划审批列表页面的统计卡片按照 `PlanDecision` 的请求类型进行统计，与页面功能（显示待裁决请求）完全一致。统计卡片显示的是"启动请求"和"取消请求"的数量，符合业务逻辑。

**建议**：可以添加"总请求数"统计卡片，但这不是必须的，当前实现已经满足需求。

---

**检查时间**：2026-01-15  
**检查人员**：AI Assistant
