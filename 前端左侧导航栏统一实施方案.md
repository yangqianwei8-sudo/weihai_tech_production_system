# 前端左侧导航栏统一实施方案

## 一、统一标准格式（以首页为准）

### 1. HTML 结构标准

```html
<aside class="workspace-nav">
    <nav class="sidenav">
        <div class="sidenav-section">
            <div class="sidenav-title">功能模块</div>  <!-- 可选，如果有标题的话 -->
            <div class="sidenav-links">
                {% for menu_item in sidebar_menu %}
                    {% if menu_item.children %}
                        <!-- 有子菜单的情况 -->
                        <div class="sidenav-item">
                            <a class="sidenav-link" 
                               href="{{ menu_item.url }}" 
                               {% if menu_item.active %}data-active="true"{% endif %}>
                                <span>{{ menu_item.icon }} {{ menu_item.label }}</span>
                            </a>
                            <div class="submenu">
                                {% for child in menu_item.children %}
                                    <a class="sidenav-link sidenav-sub-link" 
                                       href="{{ child.url }}" 
                                       {% if child.active %}data-active="true"{% endif %}>
                                        <span>{{ child.icon }} {{ child.label }}</span>
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <!-- 无子菜单的情况 -->
                        <a class="sidenav-link" 
                           href="{{ menu_item.url }}" 
                           {% if menu_item.active %}data-active="true"{% endif %}>
                            <span>{{ menu_item.icon }} {{ menu_item.label }}</span>
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </nav>
</aside>
```

### 2. CSS 类名标准

- **容器类**：`workspace-nav`（不允许添加额外类名，如 `delivery-sidebar`）
- **导航类**：`sidenav`（不允许添加额外类名）
- **分组容器**：`sidenav-section`（可选，用于多个分组）
- **标题**：`sidenav-title`（可选，用于分组标题）
- **链接容器**：`sidenav-links`
- **有子菜单的项**：`sidenav-item`（不是 `sidenav-group`）
- **子菜单容器**：`submenu`（不是 `sidenav-group-children`）
- **链接**：`sidenav-link`
- **子链接**：`sidenav-link sidenav-sub-link`

### 3. 激活状态标记标准

- **统一使用**：`data-active="true"` 属性（不使用 `active` 类名）
- **判断逻辑**：在模板中使用 `{% if menu_item.active %}data-active="true"{% endif %}`

### 4. 样式文件标准

- **统一使用**：`css/common.css`（已包含 `workspace.css`）
- **不允许**：在 base.html 中覆盖标准样式（如 `.delivery-sidebar .sidenav` 等）
- **允许**：模块特定的布局调整（如网格布局），但必须不影响导航栏的基础样式

---

## 二、需要修改的模块清单

### 1. 交付管理（delivery_customer）⭐⭐⭐ 优先级最高

**当前问题**：
- 使用 `sidenav-group` 结构（应改为 `sidenav-item` + `submenu`）
- 使用 `active` 类名（应改为 `data-active="true"`）
- 有大量自定义样式覆盖标准样式
- 添加了额外的类名 `delivery-sidebar`、`delivery-nav` 等

**需要修改的文件**：
- `backend/templates/delivery_customer/base.html`

### 2. 客户管理（customer_management）

**当前问题**：
- 可能需要检查是否符合标准格式

**需要检查的文件**：
- `backend/templates/customer_management/base.html`

### 3. 生产管理（production_management）

**当前问题**：
- 可能需要检查是否符合标准格式

**需要检查的文件**：
- `backend/templates/production_management/base.html`

### 4. 财务管理（financial_management）

**需要检查的文件**：
- `backend/templates/financial_management/base.html`

### 5. 人事管理（personnel_management）

**需要检查的文件**：
- `backend/templates/personnel_management/base.html`

### 6. 行政管理（administrative_management）

**需要检查的文件**：
- `backend/templates/administrative_management/base.html`

### 7. 其他模块

**需要检查的模块**：
- 计划管理（plan_management）
- 诉讼管理（litigation_management）
- 档案管理（archive_management）
- 生产质量（production_quality）
- 项目中心（project_center）
- 结算管理（settlement_center, settlement_management）

---

## 三、实施步骤

### 步骤 1：备份和准备阶段

```bash
# 1. 创建备份分支（如果使用 Git）
git checkout -b feature/unify-sidebar-navigation

# 2. 列出所有需要检查的模板文件
find backend/templates -name "base.html" -type f | grep -v ".deleted"
```

### 步骤 2：建立标准模板片段

创建一个可重用的模板片段文件：
- `backend/templates/shared/sidebar_nav.html`

这个文件包含标准的导航栏 HTML 结构，各模块可以 include 使用。

### 步骤 3：逐一修改各模块

对于每个模块，按以下顺序进行：

#### 3.1 检查当前实现

```bash
# 检查模板文件中的导航栏结构
grep -A 50 "workspace-nav\|sidenav-section" backend/templates/[模块名]/base.html
```

#### 3.2 检查后端菜单数据结构

确保后端的 `_build_*_sidebar_nav` 函数返回的数据结构包含：
- `id`: 菜单项ID
- `label`: 菜单标签
- `icon`: 图标（可选）
- `url`: 链接地址
- `active`: 是否激活（布尔值）
- `children`: 子菜单项列表（可选）

#### 3.3 修改模板文件

1. **替换 HTML 结构**：
   - 将 `sidenav-group` 改为 `sidenav-item`
   - 将 `sidenav-group-children` 改为 `submenu`
   - 将 `sidenav-group-header` 合并到父菜单项中

2. **统一激活标记**：
   - 将 `class="... active"` 改为 `{% if item.active %}data-active="true"{% endif %}`

3. **移除额外的类名**：
   - 移除 `delivery-sidebar`、`delivery-nav` 等模块特定的类名
   - 保持只使用标准类名

4. **清理自定义样式**：
   - 移除覆盖标准样式的 CSS 规则
   - 保留必要的布局调整（如果确实需要）

#### 3.4 测试验证

- [ ] 导航栏显示正常
- [ ] 子菜单展开/收起正常
- [ ] 激活状态显示正确（左侧指示条 + 主色文字）
- [ ] 响应式布局正常
- [ ] 权限控制正常

### 步骤 4：创建统一模板片段（可选但推荐）

创建 `backend/templates/shared/sidebar_nav.html`：

```django
{% comment %}
标准左侧导航栏模板片段
使用方式：{% include 'shared/sidebar_nav.html' with menu_items=sidebar_menu %}
{% endcomment %}

<aside class="workspace-nav">
    <nav class="sidenav">
        <div class="sidenav-section">
            {% if section_title %}
            <div class="sidenav-title">{{ section_title }}</div>
            {% endif %}
            <div class="sidenav-links">
                {% for menu_item in menu_items %}
                    {% if menu_item.children %}
                        <div class="sidenav-item">
                            <a class="sidenav-link" 
                               href="{{ menu_item.url }}" 
                               {% if menu_item.active %}data-active="true"{% endif %}>
                                {% if menu_item.icon %}<span>{{ menu_item.icon }}</span>{% endif %}
                                <span>{{ menu_item.label }}</span>
                            </a>
                            <div class="submenu">
                                {% for child in menu_item.children %}
                                    <a class="sidenav-link sidenav-sub-link" 
                                       href="{{ child.url }}" 
                                       {% if child.active %}data-active="true"{% endif %}>
                                        {% if child.icon %}<span>{{ child.icon }}</span>{% endif %}
                                        <span>{{ child.label }}</span>
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <a class="sidenav-link" 
                           href="{{ menu_item.url }}" 
                           {% if menu_item.active %}data-active="true"{% endif %}>
                            {% if menu_item.icon %}<span>{{ menu_item.icon }}</span>{% endif %}
                            <span>{{ menu_item.label }}</span>
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </nav>
</aside>
```

然后各模块的 base.html 可以简化为：
```django
{% include 'shared/sidebar_nav.html' with menu_items=delivery_sidebar_nav %}
```

### 步骤 5：验证和测试

#### 5.1 功能测试清单

对每个模块进行以下测试：
- [ ] 导航栏正常显示
- [ ] 菜单项链接正确
- [ ] 有子菜单的项能正常展开/收起（hover 触发）
- [ ] 激活状态的菜单项显示左侧指示条
- [ ] 激活状态的菜单项文字显示主色
- [ ] 权限控制正常（无权限的菜单项不显示）
- [ ] 响应式布局正常（移动端、平板端、桌面端）

#### 5.2 视觉一致性检查

- [ ] 所有模块的导航栏视觉样式完全一致
- [ ] 字体大小、间距、颜色统一
- [ ] hover 效果一致
- [ ] 激活状态样式一致

### 步骤 6：文档更新

更新相关文档：
- [ ] 更新开发规范文档，说明导航栏的标准格式
- [ ] 在 README 中说明如何使用标准导航栏模板

---

## 四、检查清单

### 代码检查清单

每个模块修改后，确认以下项目：

- [ ] HTML 结构使用标准类名（`workspace-nav`, `sidenav`, `sidenav-item`, `submenu` 等）
- [ ] 激活状态使用 `data-active="true"` 属性（不使用 `active` 类名）
- [ ] 没有添加模块特定的类名（如 `delivery-sidebar`, `customer-sidebar` 等）
- [ ] 没有自定义样式覆盖标准样式（除非确实需要且不影响标准样式）
- [ ] 后端菜单数据结构符合标准格式
- [ ] 模板中正确处理了有子菜单和无子菜单两种情况
- [ ] 图标正确显示（如果菜单项有图标）

### 功能检查清单

- [ ] 导航栏正常显示
- [ ] 菜单项链接正确跳转
- [ ] 子菜单正常展开/收起
- [ ] 激活状态正确显示
- [ ] 权限控制正常
- [ ] 响应式布局正常

---

## 五、参考文件

### 标准实现参考

- **首页模板**：`backend/templates/home.html`（第2143-2170行）
- **标准样式**：`backend/static/css/layouts/workspace.css`
- **统一样式入口**：`backend/static/css/common.css`

### 需要修改的文件

1. `backend/templates/delivery_customer/base.html` ⭐⭐⭐
2. `backend/templates/customer_management/base.html`
3. `backend/templates/production_management/base.html`
4. `backend/templates/financial_management/base.html`
5. `backend/templates/personnel_management/base.html`
6. `backend/templates/administrative_management/base.html`
7. 其他模块的 base.html 文件

---

## 六、注意事项

1. **不要破坏现有功能**：修改时要确保所有功能仍然正常工作
2. **保留必要的布局调整**：某些模块可能需要特定的布局（如网格布局），但要确保不影响导航栏的基础样式
3. **渐进式修改**：建议一个模块一个模块地修改和测试，不要一次性修改所有模块
4. **充分测试**：每个模块修改后都要进行完整的功能测试和视觉检查
5. **保持一致性**：所有模块修改完成后，确保完全一致

---

## 七、实施顺序建议

1. **第一阶段**：修改交付管理模块（问题最多，可作为试点）
2. **第二阶段**：修改客户管理、生产管理等主要模块
3. **第三阶段**：修改其他次要模块
4. **第四阶段**：创建统一的模板片段，简化代码维护
5. **第五阶段**：全面测试和文档更新

