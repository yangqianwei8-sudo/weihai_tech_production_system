# 表格翻页功能说明

## 功能概述

计划管理和目标管理模块的列表页面已经实现了完整的翻页功能。

## 实现情况

### ✅ 已实现的功能

1. **分页逻辑**（视图层）
   - 使用 Django 的 `Paginator` 进行分页
   - 每页显示 20 条记录
   - 支持页码参数 `?page=N`

2. **分页显示**（模板层）
   - 分页信息显示：显示当前页的记录范围和总记录数
   - 上一页/下一页按钮
   - 页码按钮（显示当前页前后3页）
   - 当前页高亮显示

3. **筛选条件保持**
   - 翻页时自动保留所有筛选条件
   - 包括：搜索关键词、状态、类型、周期、负责人、日期范围等

4. **样式支持**
   - 分页组件样式已定义在 `list_layout.css` 中
   - 包含：分页容器、信息显示、导航按钮、激活状态、禁用状态等样式

## 文件位置

### 视图函数
- **计划列表**：`vihhi/weihai_tech_production_system/backend/apps/plan_management/views_pages.py`
  - 函数：`plan_list()` (第489行)
  - 分页代码：第550-553行

- **目标列表**：`vihhi/weihai_tech_production_system/backend/apps/plan_management/views_pages.py`
  - 函数：`strategic_goal_list()` (第613行)
  - 分页代码：第666-669行

### 模板文件
- **计划列表模板**：`vihhi/weihai_tech_production_system/backend/templates/plan_management/_partials/_plan_table.html`
  - 分页代码：第80-105行（约）

- **目标列表模板**：`vihhi/weihai_tech_production_system/backend/templates/goal_management/_partials/_list_table.html`
  - 分页代码：第80-105行（约）

### 样式文件
- **CSS样式**：`vihhi/weihai_tech_production_system/backend/static/css/components/list_layout.css`
  - 分页样式：第355-402行

## 分页功能特性

### 1. 分页信息显示
```
显示第 1 - 20 条，共 45 条
```

### 2. 导航按钮
- **上一页**：跳转到上一页（如果存在）
- **页码按钮**：显示当前页前后3页的页码
- **下一页**：跳转到下一页（如果存在）

### 3. 状态显示
- **激活状态**：当前页按钮使用深色背景（`list-pagination-btn active`）
- **禁用状态**：第一页的"上一页"和最后一页的"下一页"显示为禁用状态

### 4. URL参数保持
翻页时会自动保留以下筛选条件：
- `search` - 搜索关键词
- `status` - 状态筛选
- `plan_type` / `goal_type` - 类型筛选
- `plan_period` / `goal_period` - 周期筛选
- `related_goal` - 关联目标（仅计划列表）
- `responsible` / `responsible_person` - 负责人筛选
- `date_from` / `date_to` - 日期范围筛选

## 使用说明

### 当数据超过20条时
- 表格底部会自动显示分页组件
- 用户可以通过点击页码或"上一页"/"下一页"按钮进行翻页
- 所有筛选条件在翻页时会自动保留

### 当数据少于20条时
- 不显示分页组件（因为 `has_other_pages` 为 `False`）
- 直接显示所有数据

## 样式说明

### 分页容器 (`.list-pagination`)
- 背景色：`#FAFAFA`
- 边框：顶部边框 `1px solid #E0E0E0`
- 布局：flex布局，左右分布

### 分页信息 (`.list-pagination-info`)
- 字体大小：`12px`
- 颜色：`#666666`

### 分页按钮 (`.list-pagination-btn`)
- 基础样式：白色背景，灰色边框
- 悬停效果：背景变为 `#F5F5F5`
- 激活状态：深色背景 `#1A1A1A`，白色文字
- 禁用状态：透明度 `0.5`，不可点击

## 技术实现

### 分页逻辑
```python
# 分页
paginator = Paginator(plans, 20)  # 每页20条
page_number = request.GET.get('page', 1)
page_obj = paginator.get_page(page_number)

# 传递给模板
context['plans'] = page_obj  # 或 context['goals'] = page_obj
```

### 模板判断
```django
{% if plans.has_other_pages %}
  <!-- 显示分页组件 -->
{% endif %}
```

## 注意事项

1. **数据量要求**：只有当数据超过每页显示数量（20条）时，才会显示分页组件
2. **筛选条件**：翻页时会保留所有URL参数，确保筛选状态不丢失
3. **性能考虑**：分页可以减少单次查询的数据量，提高页面加载速度

## 测试建议

1. ✅ 创建超过20条计划/目标数据
2. ✅ 验证分页组件是否正确显示
3. ✅ 测试翻页功能是否正常
4. ✅ 测试筛选后翻页，筛选条件是否保留
5. ✅ 测试边界情况（第一页、最后一页）

---

**状态**：✅ 功能已完整实现  
**最后更新**：2026-01-15
