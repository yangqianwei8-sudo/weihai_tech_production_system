# 总工作台首页配置说明

**配置时间**：2026-01-15  
**配置状态**：✅ 已完成

---

## 一、配置目标

将总工作台首页定义为 `http://localhost:8001/dashboard`，作为系统的主要工作台入口。

---

## 二、当前配置状态

### 2.1 URL路由配置

| 路径 | 视图函数 | 模板 | 用途 |
|------|---------|------|------|
| `/` | `home` | `home.html` | 系统首页 |
| `/dashboard/` | `dashboard` | `home.html` | 总工作台首页 |

### 2.2 视图函数关系

- **`dashboard` 视图**：调用 `home` 视图的逻辑
- **`home` 视图**：实现完整的工作台功能
- **两个视图共享相同的逻辑和模板**

---

## 三、功能特性

### 3.1 工作台功能

总工作台首页包含以下功能模块：

1. **顶部导航菜单**
   - 根据用户权限动态显示
   - 包含各个功能模块的快速入口

2. **统计数据卡片**
   - 进行中项目数
   - 本月完成项目数
   - 待审批任务
   - 待处理事项

3. **待办任务统计**
   - 个人待办任务数
   - 今日到期任务数
   - 逾期任务数

4. **任务看板**
   - 待处理任务列表
   - 进行中任务列表
   - 已完成任务列表

5. **审批统计**
   - 我的待审批数
   - 我提交的审批数

6. **交付统计**
   - 待处理交付报告数

---

## 四、代码修改说明

### 4.1 创建dashboard视图

**文件**：`backend/core/views.py`

**添加内容**：
```python
def dashboard(request):
    """总工作台首页 - 与home视图功能相同"""
    # 直接调用home视图的逻辑
    return home(request)
```

### 4.2 添加URL路由

**文件**：`backend/config/urls.py`

**修改内容**：
1. 导入dashboard视图：
   ```python
   from backend.core.views import home, dashboard, ...
   ```

2. 添加URL路由：
   ```python
   urlpatterns = [
       path('', home, name='home'),
       path('dashboard/', dashboard, name='dashboard'),
       ...
   ]
   ```

### 4.3 更新登录重定向

**文件**：`backend/core/views.py`

**修改内容**：
- 将未登录用户的重定向从 `/admin/login/` 改为 `/login/`
- 支持 `next` 参数，登录后返回原页面

---

## 五、访问方式

### 5.1 总工作台

**URL**：`http://localhost:8001/dashboard/`

**访问要求**：
- 需要登录
- 未登录用户会自动重定向到 `/login/`

**功能**：
- 显示工作台首页
- 包含统计数据、任务看板、待办事项等

### 5.2 系统首页

**URL**：`http://localhost:8001/`

**访问要求**：
- 需要登录
- 未登录用户会自动重定向到 `/login/`

**功能**：
- 与 `/dashboard/` 功能相同
- 两个URL指向相同的工作台页面

---

## 六、登录流程

### 6.1 未登录用户访问工作台

```
用户访问 /dashboard/ 或 /
    ↓
检查是否已登录
    ↓ (未登录)
重定向到 /login/?next=/dashboard/
    ↓
用户登录
    ↓
根据next参数重定向回 /dashboard/
```

### 6.2 已登录用户访问工作台

```
用户访问 /dashboard/ 或 /
    ↓
检查是否已登录
    ↓ (已登录)
显示工作台首页
```

---

## 七、相关文件

- **视图函数**：`backend/core/views.py` - `dashboard` 和 `home` 函数
- **URL配置**：`backend/config/urls.py`
- **工作台模板**：`backend/templates/home.html`
- **导航菜单配置**：`backend/core/views.py` - `HOME_NAV_STRUCTURE`

---

## 八、注意事项

1. **两个URL功能相同**：
   - `/` 和 `/dashboard/` 都指向相同的工作台页面
   - 可以根据需要选择使用哪个URL

2. **登录重定向**：
   - 未登录用户访问工作台会重定向到前端登录页面
   - 登录后会自动返回原访问的页面

3. **权限控制**：
   - 工作台根据用户权限显示不同的导航菜单
   - 没有权限的功能模块不会显示

4. **数据统计**：
   - 统计数据实时计算
   - 如果某些模块不存在或出错，不会影响整个页面显示

---

## 九、测试验证

### 9.1 验证URL配置

1. **访问总工作台**：
   ```
   http://localhost:8001/dashboard/
   ```
   应该显示工作台首页

2. **访问系统首页**：
   ```
   http://localhost:8001/
   ```
   应该显示相同的工作台首页

3. **未登录访问**：
   - 未登录用户访问 `/dashboard/` 应该重定向到 `/login/`
   - 登录后应该返回 `/dashboard/`

### 9.2 验证功能

1. **统计数据**：检查统计卡片是否正确显示
2. **任务看板**：检查任务列表是否正确显示
3. **导航菜单**：检查导航菜单是否根据权限正确显示

---

**配置完成时间**：2026-01-15  
**配置人员**：系统管理员  
**状态**：✅ 已完成并验证
