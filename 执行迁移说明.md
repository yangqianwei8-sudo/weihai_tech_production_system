# 执行迁移 0018_fix_pending_approval_status

## 迁移目的
修复战略目标中 `pending_approval` 状态的数据不一致问题，将所有 `pending_approval` 状态改为 `draft`（制定中）。

## 方法1：使用 Django migrate 命令（推荐）

```bash
cd /home/devbox/project/vihhi/weihai_tech_production_system

# 激活虚拟环境（根据实际情况调整路径）
source /path/to/venv/bin/activate

# 执行迁移
python manage.py migrate plan_management
```

## 方法2：直接执行 SQL（如果 Django 环境不可用）

连接到 PostgreSQL 数据库后执行：

```sql
-- 1. 查看需要修复的目标
SELECT goal_number, name, status, created_time
FROM plan_strategic_goal 
WHERE status = 'pending_approval';

-- 2. 执行修复
UPDATE plan_strategic_goal 
SET status = 'draft' 
WHERE status = 'pending_approval';

-- 3. 验证修复结果
SELECT status, COUNT(*) 
FROM plan_strategic_goal 
GROUP BY status 
ORDER BY status;
```

## 方法3：使用 psql 命令行工具

```bash
# 连接数据库（根据实际配置调整）
psql -h dbconn.sealosbja.site -p 38013 -U postgres -d postgres

# 在 psql 中执行 SQL
\c postgres
UPDATE plan_strategic_goal SET status = 'draft' WHERE status = 'pending_approval';
SELECT status, COUNT(*) FROM plan_strategic_goal GROUP BY status ORDER BY status;
\q
```

## 数据库连接信息

根据 `settings.py` 配置：
- 主机: dbconn.sealosbja.site
- 端口: 38013
- 数据库: postgres
- 用户: postgres
- 密码: zdg7xx28（开发环境默认）

## 迁移文件位置

`/home/devbox/project/vihhi/weihai_tech_production_system/backend/apps/plan_management/migrations/0018_fix_pending_approval_status.py`

## 验证迁移结果

迁移成功后，应该：
1. ✅ 所有目标的状态都在模型定义的有效状态范围内
2. ✅ `GOAL-20260108-0004` 的状态显示为"制定中"而不是"pending_approval"
3. ✅ 页面显示正常，不会出现未定义的状态
