# 目标跟踪统计卡片修复报告

## 问题描述
目标跟踪入口页面的统计卡片与状态不一致，需要修复。

## 问题分析

### 修复前
**页面**：`strategic_goal_track_entry.html`（目标跟踪入口页面）

**统计卡片**（3个）：
1. 目标总数
2. 可跟踪目标（status in ['published', 'in_progress']）
3. 不可跟踪（总数 - 可跟踪）

**问题**：
- ❌ 统计卡片没有按照模型定义的所有状态进行统计
- ❌ 缺少"制定中"、"已发布"、"执行中"、"已完成"、"已取消"的状态统计

### 模型状态定义
`StrategicGoal` 模型的状态选项：
- `draft` - 制定中
- `published` - 已发布
- `in_progress` - 执行中
- `completed` - 已完成
- `cancelled` - 已取消

## 修复内容

### 1. 视图代码修复
**文件**：`apps/plan_management/views_pages.py`
**函数**：`strategic_goal_track_entry`

**修改**：
- 添加了所有状态的统计：
  ```python
  total_count = all_goals.count()
  draft_count = all_goals.filter(status='draft').count()
  published_count = all_goals.filter(status='published').count()
  in_progress_count = all_goals.filter(status='in_progress').count()
  completed_count = all_goals.filter(status='completed').count()
  cancelled_count = all_goals.filter(status='cancelled').count()
  ```
- 将这些统计值添加到 context 中

### 2. 模板文件修复
**文件**：`templates/plan_management/strategic_goal_track_entry.html`

**修改**：
- 将统计卡片从3个改为6个
- 显示所有状态的统计：
  1. 目标总数
  2. 制定中（draft）
  3. 已发布（published）
  4. 执行中（in_progress）
  5. 已完成（completed）
  6. 已取消（cancelled）

## 修复后效果

### 统计卡片（6个）
1. ✅ **目标总数**：所有目标的数量
2. ✅ **制定中**：状态为 `draft` 的目标数量
3. ✅ **已发布**：状态为 `published` 的目标数量
4. ✅ **执行中**：状态为 `in_progress` 的目标数量
5. ✅ **已完成**：状态为 `completed` 的目标数量
6. ✅ **已取消**：状态为 `cancelled` 的目标数量

### 一致性检查
- ✅ 统计卡片与模型状态定义完全一致
- ✅ 与战略目标列表页的统计卡片保持一致
- ✅ 所有状态都有对应的统计卡片

## 验证

1. **视图代码**：✅ 已添加所有状态的统计
2. **模板文件**：✅ 已更新为显示所有状态的统计卡片
3. **状态一致性**：✅ 与模型定义的状态完全一致

## 相关文件

- **视图文件**：`vihhi/weihai_tech_production_system/backend/apps/plan_management/views_pages.py`（第1686-1705行）
- **模板文件**：`vihhi/weihai_tech_production_system/backend/templates/plan_management/strategic_goal_track_entry.html`
- **模型定义**：`vihhi/weihai_tech_production_system/backend/apps/plan_management/models.py`（第30-36行）

---

**修复时间**：2026-01-15  
**修复人员**：AI Assistant  
**状态**：✅ 已完成
